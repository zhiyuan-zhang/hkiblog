---
title: 权限设计
date: 2020/4/14
categories:
  - java
comments: true
abbrlink: 49197
img:
typora-copy-images-to: ../../public/img
typora-root-url: ../../public
---

## 设计核心

每个登录用户拥有各自的权限,由后端返回

### 后端

下文整个权限模式基于RBAC理论设计

后台验证角色的权限,前端根据后台返回的menuList, permissionList 来设计前端的页面Router

角色的作用其实只是用来管理分配权限的,真正的验证只验证**权限** 

### 数据库

数据库主要包含五张表，分别是
用户表 **sys_user** 、
角色表 **sys_role** 、
用户角色表 **sys_job** 、
权限表 **sys_permission** 、
角色权限表 **sys_role_permission** 。

关联关系如下图所示

![截屏2020-04-14上午11.27.05](/img/权限1.png)

### 数据库表内容及其含义



#### 运营后台用户表 

```sql
CREATE TABLE `sys_user` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(255) DEFAULT NULL COMMENT '用户名',
  `password` varchar(255) DEFAULT NULL COMMENT '密码',
  `nickname` varchar(255) DEFAULT NULL COMMENT '昵称',
  `role_id` varchar(64) DEFAULT '0' COMMENT '角色ID',
  `create_time` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  `delete_status` varchar(1) DEFAULT '1' COMMENT '是否有效  1有效  2无效',
  `phone` varchar(255) DEFAULT NULL COMMENT '管理员手机号',
  `type` varchar(64) DEFAULT '1' COMMENT '1:流程管理用户 2：管理员或者超级管理员',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=10089 DEFAULT CHARSET=utf8 COMMENT='运营后台用户表';

```



#### 用户的组织角色和岗位信息

```sql
CREATE TABLE `sys_job` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `org_id` int(11) NOT NULL DEFAULT '0' COMMENT '组织id',
  `job_name` varchar(255) NOT NULL DEFAULT '0' COMMENT '表单id',
  `create_time` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `delete_status` varchar(1) DEFAULT '1' COMMENT '是否有效 1有效     2无效',
  `user_id` int(11) NOT NULL COMMENT '用户id',
  `role_id` varchar(64) DEFAULT NULL COMMENT '用户关联组的角色',
  `claim_type` varchar(12) DEFAULT '1' COMMENT '认领类型 1：可以认领任务 2：不能认领任务',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=1084 DEFAULT CHARSET=utf8mb4 COMMENT='判断用户的组织和岗位';
```



#### 后台角色表

```sql
CREATE TABLE `sys_role` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `type` int(11) DEFAULT NULL COMMENT '角色类型',
  `name` varchar(20) DEFAULT NULL COMMENT '角色名',
  `flow_id` varchar(255) NOT NULL COMMENT '流程角色id',
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `delete_status` varchar(1) DEFAULT '1' COMMENT '是否有效  1有效  2无效',
  `note` varchar(255) DEFAULT NULL COMMENT '备注',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=47 DEFAULT CHARSET=utf8 ROW_FORMAT=COMPACT COMMENT='后台角色表';
```



#### 后台权限表

```sql
CREATE TABLE `sys_permission` (
  `id` int(11) NOT NULL DEFAULT '0' COMMENT '自定id,主要供前端展示权限列表分类排序使用.',
  `menu_code` varchar(255) DEFAULT '' COMMENT '归属菜单,前端判断并展示菜单使用,',
  `menu_name` varchar(255) DEFAULT '' COMMENT '菜单的中文释义',
  `permission_code` varchar(255) DEFAULT '' COMMENT '权限的代码/通配符,对应代码中@RequiresPermissions 的value',
  `permission_name` varchar(255) DEFAULT '' COMMENT '本权限的中文释义',
  `required_permission` tinyint(1) DEFAULT '2' COMMENT '是否本菜单必选权限, 1.必选 2非必选 通常是"列表"权限是必选',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='后台权限表';
```



#### 角色-权限关联表

```sql
CREATE TABLE `sys_role_permission` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `role_id` int(11) DEFAULT NULL COMMENT '角色id',
  `permission_id` int(11) DEFAULT NULL COMMENT '权限id',
  `create_time` timestamp NULL DEFAULT CURRENT_TIMESTAMP,
  `update_time` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `delete_status` varchar(1) DEFAULT '1' COMMENT '是否有效 1有效 2无效',
  PRIMARY KEY (`id`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=20 DEFAULT CHARSET=utf8 COMMENT='角色-权限关联表';
```



## 逻辑设计

### 用户配置岗位信息

举例: 固收分管领导及总裁 账号是 admin11 关联的岗位job信息是1015

岗位信息包含当前系统中所有的岗位

![image-20200414163259757](/img/image-20200414163259757.png)

### 岗位信息关联角色

当前系统所有的角色信息

固收分管领导及总裁 流程角色id是user88 角色id是 **39**

![image-20200414165633387](/img/image-20200414165633387.png)





### 给角色对应的权限

当前角色对应权限表中的某些权限

固收分管领导及总裁的角色id是39 所以需要给role_id配置不同的权限.

下面配置了4个权限,具体权限内容可以在权限表中查看

![image-20200414165858964](/img/image-20200414165858964.png)



### 配置所有的权限列表

存储系统中不同粒度的权限

包含但不止

![image-20200414162424318](/img/image-20200414162424318.png)

其中如果想要分配子权限必须拥有顶级权限



最后: 如何一个账号对应多个第三方系统的角色

有两种解决方案

1. 理论上来讲它也是当前系统中的一种权限,所以把它加到系统权限表中,之后配置角色的时候来添加不同的第三方角色

2. 如果你觉得第一种比较麻烦,可以在你当前系统的角色表中添加一个第三方系统角色的ID来标识,这样有一个缺点就是无法添加多个角色,不过也有解决办法,就是新建一张表来维护与第三方的角色关系.







RBAC参考文献

http://csrc.nist.gov/groups/SNS/rbac/index.html

http://csrc.nist.gov/groups/SNS/rbac/faq.html

 