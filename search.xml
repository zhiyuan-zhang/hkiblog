<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>浅析redis</title>
      <link href="/2020/06/19/Redis/"/>
      <url>/2020/06/19/Redis/</url>
      
        <content type="html"><![CDATA[<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="帮助文档"><a href="#帮助文档" class="headerlink" title="帮助文档"></a>帮助文档</h2><p> <a href="https://cloud.tencent.com/developer/section/1374167" target="_blank" rel="noopener">https://cloud.tencent.com/developer/section/1374167</a></p><p> redis.cn</p><h2 id="安装流程"><a href="#安装流程" class="headerlink" title="安装流程"></a>安装流程</h2><h3 id="1-yum-install-wget"><a href="#1-yum-install-wget" class="headerlink" title="1. yum install wget"></a>1. yum install wget</h3><h3 id="2-wget-www-redis-tar-gz-去github找最新的包"><a href="#2-wget-www-redis-tar-gz-去github找最新的包" class="headerlink" title="2. wget  www.***redis .tar.gz(去github找最新的包)"></a>2. wget  www.***redis .tar.gz(去github找最新的包)</h3><h3 id="3-tar-xf-redis-tar-gz"><a href="#3-tar-xf-redis-tar-gz" class="headerlink" title="3. tar xf    redis.tar.gz"></a>3. tar xf    redis.tar.gz</h3><h3 id="4-cd-redis-src"><a href="#4-cd-redis-src" class="headerlink" title="4. cd redis-src"></a>4. cd redis-src</h3><h3 id="5-README-md"><a href="#5-README-md" class="headerlink" title="5. README.md"></a>5. README.md</h3><h3 id="6-make"><a href="#6-make" class="headerlink" title="6. make"></a>6. make</h3><p>make yum install gcc<br>make distclean</p><h3 id="7-make"><a href="#7-make" class="headerlink" title="7. make"></a>7. make</h3><p>cd src  … 生成了可执行程序</p><h3 id="8-cd"><a href="#8-cd" class="headerlink" title="8. cd .."></a>8. cd ..</h3><h3 id="9-make-install-PREFIX-opt-xxxx-redis5"><a href="#9-make-install-PREFIX-opt-xxxx-redis5" class="headerlink" title="9. make install  PREFIX=/opt/xxxx/redis5"></a>9. make install  PREFIX=/opt/xxxx/redis5</h3><h3 id="10-vi-etc-profile"><a href="#10-vi-etc-profile" class="headerlink" title="10. vi /etc/profile"></a>10. vi /etc/profile</h3><h3 id="11-cd-utils"><a href="#11-cd-utils" class="headerlink" title="11. cd utils"></a>11. cd utils</h3><p>最后写入<br>… export REDIS_HOME =/opt/xxx/redis5<br>… export PATH=$PATH:$REDIS_HOME/bin<br>source /etc/profile</p><h3 id="12-install-server-sh"><a href="#12-install-server-sh" class="headerlink" title="12. ./install_server.sh"></a>12. ./install_server.sh</h3><ul><li>一个物理机中可以有多个redis实例. 通过port区分</li><li>可执行程序就有一份在目录, 但是内存中需要多个实例有各自的配置文件</li><li>批处理server redi_6379 start/stop/status &gt; linux /etc/init.d/***</li></ul><p>## </p><h2 id="存储类型"><a href="#存储类型" class="headerlink" title="存储类型"></a>存储类型</h2><h3 id="key"><a href="#key" class="headerlink" title="key"></a>key</h3><h3 id="value"><a href="#value" class="headerlink" title="value"></a>value</h3><ul><li><p>String(byte)</p><ul><li><p>字符类型</p><ul><li><p>set k1 test  nx</p><ul><li>nx 如果存在则不能插入成功, 只能用来新增</li></ul></li><li><p>set k1 test xx</p><ul><li>xx 如果不存在的话就失败, 只能用来更新</li></ul></li><li><p>append</p><ul><li>追加</li></ul></li><li><p>range</p><ul><li>setrange</li><li>getrange</li></ul></li><li><p>strlen</p></li><li><p>type</p><ul><li>命令是哪个分组的就是哪种类型</li></ul></li><li><p>getset</p><ul><li>更新值并且拿到老值</li></ul></li><li><p>MSETNX</p><ul><li>原子性批量操作  要么都成功 要么都失败</li></ul></li></ul></li><li><p>数值类型</p><ul><li>incr</li><li>incrby</li></ul></li><li><p>bitmap</p><ul><li><p>一个字节(bit)有8个二进制位</p><ul><li>1B=8 Bit<br>1KB＝1024B<br>1MB＝1024KB<br>1GB＝1024MB<br>1TB=1024GB</li></ul></li><li><p>SETBIT key offset value</p><ul><li>设置key 偏移量offset 的 0 或者1</li></ul></li><li><p>BITPOS key bit [start] [end]</p><ul><li><p>查找字符串中第一个设置为1或0的bit位 ,返回该位置</p><ul><li><p>bitpos k1 1 0 0 </p><ul><li>1</li></ul></li><li><p>bitpos k1 1 1 1 </p><ul><li>9</li></ul></li></ul></li></ul></li><li><p>BITCOUNT key [start end]</p><ul><li>返回是1的数量</li><li>start 和end是字节位置</li></ul></li><li><p>BITOP operation destkey key [key …]</p><ul><li><p>AND  </p><ul><li>按位与操作  全1是1  其余为0</li></ul></li><li><p>OR</p><ul><li>按位或操作  有1是1  其余为0</li></ul></li><li><p>XOR</p></li><li>NOT</li></ul></li></ul></li></ul></li><li><p>lists(双向链表)</p><ul><li><p>lpush</p><ul><li>左添加 进入队列在链表的左边依次开始添加</li></ul></li><li><p>lpop</p><ul><li>左弹出</li></ul></li><li><p>rpush</p><ul><li>右添加 进入队列在链表的最右边依次添加</li></ul></li><li><p>rpop </p><ul><li>右弹出</li></ul></li><li><p>lrange </p><ul><li>得到固定范围内的所有值</li></ul></li><li><p>lrem </p><ul><li>移除几个什么类型的元素</li></ul></li><li><p>linsert</p><ul><li><p>只在找到第一个值的地方</p><ul><li>after 后面插入</li><li>before 前面插入</li></ul></li></ul></li><li><p>blpop (阻塞,单播队列)</p><ul><li>拿到里面的第一个数据 拿不到则阻塞</li></ul></li></ul></li><li><p>Hashes ( 点赞,收藏,详情页)</p><ul><li>存储对象<br>name::age<br>name::sex<br>name::weight</li><li><p>hset key  field value </p><ul><li>添加一个对象的属性值</li></ul></li><li><p>hmset </p><ul><li>添加一个对象的多个属性值</li></ul></li><li><p>hmget</p><ul><li>获取一个对象的多个属性值</li></ul></li><li><p>hvals</p><ul><li>获取这个对象的所有属性值</li></ul></li><li><p>hgetall</p><ul><li>拿到这个对象的所有key value</li></ul></li><li><p>HINCRBYFLOAT key field increment</p><ul><li>对指定的一个属性进行 +1 -1</li></ul></li></ul></li><li><p>sets ( 去重)</p><ul><li><p>SADD key member [member …] </p><ul><li>添加元素</li></ul></li><li><p>smembers</p><ul><li>去重查看</li></ul></li><li><p>srem </p><ul><li>去除某个value</li></ul></li><li><p>sinter key…</p><ul><li>返回  多个key 的交集</li></ul></li><li><p>sinterstore  </p><ul><li>将交集结果 保存到指定key</li></ul></li><li><p>sunion</p><ul><li>去重并且打印出 并集</li></ul></li><li><p>sdiff (差集)</p><ul><li>前面的key 与后面的key 做差集</li></ul></li><li><p>Srandmember key count(随机事件)</p><ul><li>count 正数 得到一个去重的结果集</li><li>count 负数 得到一个带重复的结果集</li></ul></li><li><p>spop</p><ul><li>随机取出一个数据,并删除集合里面的该值</li></ul></li></ul></li><li><p>sorted sets(排序)</p><ul><li><p>zadd </p><ul><li>添加一个带数值的set</li></ul></li><li><p>ZRANGE key start stop [WITHSCORES]</p><ul><li>得到一个带有起始位置的排序组合 </li></ul></li><li><p>ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</p><ul><li>最小值和最大值的一个区间组合</li></ul></li><li><p>zrevrange</p><ul><li>逆序输出</li></ul></li><li><p>zscore  </p><ul><li>通过元素取到分值</li></ul></li><li><p>ZRANGE key start stop [WITHSCORES]</p><ul><li>通过元素取到排名</li></ul></li><li><p>ZINCRBY key increment member</p><ul><li>对指定key的分值进行加减</li></ul></li><li><p>ZUNIONSTORE destination numkeys key [key …] [WEIGHTS weight [weight …]] [AGGREGATE SUM|MIN|MAX]</p><ul><li>获取交集和并集 权重和集合指令</li></ul></li></ul></li></ul><h2 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h2><h3 id="http-redis-cn-topics-pipelining-html"><a href="#http-redis-cn-topics-pipelining-html" class="headerlink" title="http://redis.cn/topics/pipelining.html"></a><a href="http://redis.cn/topics/pipelining.html" target="_blank" rel="noopener">http://redis.cn/topics/pipelining.html</a></h3><h2 id="发布订阅"><a href="#发布订阅" class="headerlink" title="发布订阅"></a>发布订阅</h2><h3 id="client"><a href="#client" class="headerlink" title="client"></a>client</h3><ul><li><p>历史数据</p><ul><li>全量数据  – 数据库</li><li>短时间内  – sorted set </li></ul></li><li><p>实时数据</p><ul><li>PUBLISH key value 发布</li><li><p>SUBSCRIBE  key  监听</p><ul><li>先监听才能收到发布的消息</li></ul></li></ul></li></ul><h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><h3 id="mutil"><a href="#mutil" class="headerlink" title="mutil"></a>mutil</h3><ul><li>开始事务</li></ul><h3 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h3><ul><li>执行 哪个先到就执行哪个事务</li></ul><h3 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h3><ul><li>乐观锁 CAS 监控某个值是否发生了变更</li></ul><h2 id="布隆过滤器"><a href="#布隆过滤器" class="headerlink" title="布隆过滤器"></a>布隆过滤器</h2><h3 id="https-github-com-RedisBloom-RedisBloom"><a href="#https-github-com-RedisBloom-RedisBloom" class="headerlink" title="https://github.com/RedisBloom/RedisBloom"></a><a href="https://github.com/RedisBloom/RedisBloom" target="_blank" rel="noopener">https://github.com/RedisBloom/RedisBloom</a></h3><h3 id="redis-server-–loadmodule-path-to-redisbloom-so"><a href="#redis-server-–loadmodule-path-to-redisbloom-so" class="headerlink" title="redis-server –loadmodule /path/to/redisbloom.so"></a>redis-server –loadmodule /path/to/redisbloom.so</h3><h3 id="黑名单拦截"><a href="#黑名单拦截" class="headerlink" title="黑名单拦截"></a>黑名单拦截</h3><h3 id="垃圾邮箱拦截"><a href="#垃圾邮箱拦截" class="headerlink" title="垃圾邮箱拦截"></a>垃圾邮箱拦截</h3><h3 id="凡是某个值需要经过判断大量数据是否存在并且误报的影响较小的情况下可以使用"><a href="#凡是某个值需要经过判断大量数据是否存在并且误报的影响较小的情况下可以使用" class="headerlink" title="凡是某个值需要经过判断大量数据是否存在并且误报的影响较小的情况下可以使用"></a>凡是某个值需要经过判断大量数据是否存在并且误报的影响较小的情况下可以使用</h3><h3 id="一旦一个值必定不存在的话，我们可以不用进行后续昂贵的查询请求。会有误判就是可能存在但是不一定存在的情况"><a href="#一旦一个值必定不存在的话，我们可以不用进行后续昂贵的查询请求。会有误判就是可能存在但是不一定存在的情况" class="headerlink" title="一旦一个值必定不存在的话，我们可以不用进行后续昂贵的查询请求。会有误判就是可能存在但是不一定存在的情况,"></a>一旦一个值必定不存在的话，我们可以不用进行后续昂贵的查询请求。会有误判就是可能存在但是不一定存在的情况,</h3><h2 id="Redis使用"><a href="#Redis使用" class="headerlink" title="Redis使用"></a>Redis使用</h2><h3 id="安装使用"><a href="#安装使用" class="headerlink" title="安装使用"></a>安装使用</h3><ul><li><p>redis-cli</p><ul><li>进入redis</li><li>-p 指定端口</li><li>-d 指定DB</li><li>help 帮助文档</li></ul></li><li><p>在使用前 需要规定编码格式  因为是字节流 二进制安全, 不存在客户端解析问题, 所以需要统一加码解码</p></li><li><p>kernel内存响应时间是纳秒  如果在同一时间有十多万个并发来请求redis服务端 那么会有秒级的延迟</p><ul><li>所以内存寻址每个大约在纳秒级别响应</li></ul></li><li><p>install_server.sh</p><ul><li>创建指定端口的配置文件</li></ul></li></ul><h3 id="作为缓存使用"><a href="#作为缓存使用" class="headerlink" title="作为缓存使用"></a>作为缓存使用</h3><ul><li>maxmemory 配置内存尽量控制在1G-10G </li><li><p>设置内存满了之后的拒绝策略</p><ul><li>lfu 碰了多少次</li><li>lru 多久没碰</li></ul></li><li><p>key的有效期设置</p><ul><li><p>主动</p><ul><li>主动访问的时候发现过期删除</li></ul></li><li><p>被动</p><ul><li><p>随机抽查20个key</p></li><li><p>删除已经过期的</p></li><li><p>如果发现超过25%的key过期那么重复第一步骤</p></li></ul></li></ul></li></ul><h3 id="作为数据库使用"><a href="#作为数据库使用" class="headerlink" title="作为数据库使用"></a>作为数据库使用</h3><p>​    目前作为缓存的较多 ,作为数据库比较少 因为存在分布式情况下的数据一致性问题 以及备份问题不推荐使用redis做数据库</p><h2 id="缓存集群"><a href="#缓存集群" class="headerlink" title="缓存集群"></a>缓存集群</h2><h3 id="目前单节点的问题"><a href="#目前单节点的问题" class="headerlink" title="目前单节点的问题"></a>目前单节点的问题</h3><ul><li><p>单点故障</p><p>看集群搭建</p></li><li><p>压力有限</p><p>看集群搭建</p></li><li><p>容量有限</p><ul><li>业务节点拆分不同的redis</li><li><p>算法拆分 (sharding)</p><ul><li>hash+ 取模 (modula )</li><li><p>random</p><ul><li>消息队列 一边lpush  一边只需要去rpop</li></ul></li><li><p>kemata (一致性hash算法)</p><ul><li><ol><li>有一个首尾相连的环 在这个环上有你的物理节点</li></ol></li><li><ol start="2"><li>业务数据过来后通过hash算法最后会有一个结果落在这个环的某个位置,也就是虚拟点</li></ol></li><li><ol start="3"><li>虚拟点去找后面的物理节点然后保存到redis集群中</li></ol></li><li>优点 : 后续加节点 会分担其他节点的压力,并不会造成全局洗牌</li><li><p>缺点: 新增的节点有部分数据不能命中缓存 导致缓存击穿, 压到mysql数据库中</p><ul><li>解决方案 : 去寻找最近的两个节点的缓存数据</li></ul></li></ul></li></ul></li></ul></li></ul><h3 id="AKF"><a href="#AKF" class="headerlink" title="AKF"></a>AKF</h3><ul><li>X 轴 全量 镜像</li><li>Y 轴 业务 功能</li><li>Z轴 指定规则将指定的key放在不同的库里面</li></ul><h3 id="集群搭建"><a href="#集群搭建" class="headerlink" title="集群搭建"></a>集群搭建</h3><ul><li><p>主节点</p><ul><li>当子节点挂在主节点后 主节点会受到一个子节点的消息</li></ul></li><li><p>子节点</p><ul><li><p>启动的时候 添加配置  </p><ul><li>redis-server ./6380.conf  –REPLICAOF  IP  port –appendonly yes</li></ul></li></ul></li><li><p>redis 默认使用的是弱一致性</p></li><li><p>主从复制配置</p><ul><li><p>replica-serve-stale-data yes</p><ul><li>是否在同步期间提供给第三方数据</li></ul></li><li><p>replica-read-only yes </p></li><li><p>repl-backiog-size 1mb</p></li></ul></li></ul><h3 id="监控-Sentinel"><a href="#监控-Sentinel" class="headerlink" title="监控(Sentinel)"></a>监控(Sentinel)</h3><ul><li><p>监控</p><ul><li>port 26379<br>sentinel monitor master1 127.0.0.1 6381 2</li><li>redis-server  ./26379.conf –sentinel</li></ul></li></ul><h2 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h2><p>​        目前纯redis 的分布式锁都不是很好实现 </p><p>​        可以结合zookeeper</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
          <category> redis </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>再次浅谈jvm</title>
      <link href="/2020/06/11/jvm02/"/>
      <url>/2020/06/11/jvm02/</url>
      
        <content type="html"><![CDATA[<h1 id="jvm"><a href="#jvm" class="headerlink" title="jvm"></a>jvm</h1><h2 id="1-虚拟机基础概念"><a href="#1-虚拟机基础概念" class="headerlink" title="1. 虚拟机基础概念"></a>1. 虚拟机基础概念</h2><h3 id="Class-File-Format"><a href="#Class-File-Format" class="headerlink" title="Class File Format"></a>Class File Format</h3><h2 id="jdk-gt-jre-gt-jvm"><a href="#jdk-gt-jre-gt-jvm" class="headerlink" title="jdk  -&gt; jre -&gt; jvm"></a>jdk  -&gt; jre -&gt; jvm</h2><p>### </p><h2 id="2-class文件结构"><a href="#2-class文件结构" class="headerlink" title="2. class文件结构"></a>2. class文件结构</h2><h2 id="3-内存加载过程-JMM"><a href="#3-内存加载过程-JMM" class="headerlink" title="3. 内存加载过程 JMM"></a>3. 内存加载过程 JMM</h2><h3 id="1-Loading"><a href="#1-Loading" class="headerlink" title="1.Loading"></a>1.Loading</h3><ul><li>当class 加载到内存中 实际上生成了两块内容<br>一个是将二进制内容放到内存中 与此同时<br>生成了一个.class对象 这个对象指向这个内容<br>后续所有的代码都会通过这个.class对象访问二进制内容<br>类只会load一次<br>所以用emun来实现单例就是这个原理</li></ul><p>在jvm的matespacess中</p><ul><li><p>类加载器 机制顺序</p><ul><li><p>1.bootstrap</p><ul><li>最顶级的加载器 显示null</li></ul></li><li><p>2.extension</p><ul><li>加载插件的加载器 jre/lib/ext/*.jar 下面的扩展jar包</li></ul></li><li><p>3.app</p><ul><li>加载classPath指定内容</li></ul></li><li><p>4.CustomClassLoader</p><ul><li><p>自定义ClassLoad</p><ul><li><p>自制类加载器</p><ul><li>代码混淆</li><li>加密</li></ul></li></ul></li><li><p>自定义加载器步骤</p><ul><li><ol><li>extends ClassLoader</li></ol></li><li><ol start="2"><li>overwrite findClass() -&gt; defineClass(byte[] -&gt; Class clazz)</li></ol></li><li><ol start="3"><li>加密</li></ol></li></ul></li></ul></li></ul></li><li><p>ClassLoad 源码</p><ul><li>findInCache -&gt; parent.loadClass -&gt; findClass()</li></ul></li><li><p>jvm是按需动态加载,采用双亲委派机制</p><ul><li><p>为什么要采用双亲委派机制</p><ul><li>为了防止使用类似String.class 不经过询问直接加载,导致会执行自定义逻辑,<br>使用双亲委派后我们会直接返回已经加载过的内置.class</li></ul></li><li><p>自底向上检查该类是否已经加载 Parent方向</p></li><li>自顶下下进行查找和加载child方向</li></ul></li><li><p>jvm编译模式</p><ul><li>解释器- 解释语言</li><li>JIT just in Time compiler 代码编译</li><li>java采用的是混合编译模式  多次被调用的方法和多次被调用的循环 进行编译 </li><li>-Xmixed 默认混合模式</li><li>-Xint  使用解释模式 ,启动很快,执行稍慢</li><li>-Xcomp 使用纯编译模式,执行很快,启动慢</li></ul></li></ul><h3 id="Linking"><a href="#Linking" class="headerlink" title="Linking"></a>Linking</h3><ul><li><p>Verification</p><ul><li>来验证是否符合JVM语法规范  类似开头cafe babe </li></ul></li><li><p>Preparation</p><ul><li>给静态成员变量赋默认值,  注意是默认值不是初始化值</li></ul></li><li><p>Resolution</p><ul><li>将类、方法、属性等符号引用解析为直接引用</li><li>常量池中的各种符号引用解析为指针、偏移量等内存地址的直接引用</li></ul></li></ul><h3 id="Initializing-ɪˈnɪʃəlaɪzɪŋ"><a href="#Initializing-ɪˈnɪʃəlaɪzɪŋ" class="headerlink" title="Initializing ɪˈnɪʃəlaɪzɪŋ"></a>Initializing ɪˈnɪʃəlaɪzɪŋ</h3><ul><li>调用类初始化代码 <clinit>，给静态成员变量赋初始值</clinit></li></ul><h2 id="4-运行时内存结构"><a href="#4-运行时内存结构" class="headerlink" title="4. 运行时内存结构"></a>4. 运行时内存结构</h2><h3 id="每个线程都有单独的区域"><a href="#每个线程都有单独的区域" class="headerlink" title="每个线程都有单独的区域"></a>每个线程都有单独的区域</h3><ul><li><p>Program Counter </p><ul><li>存放栈帧的下一步运行</li><li>虚拟机里面类似这样的循环<br>while( not end ) {<br>​    取PC中的位置，找到对应位置的指令；<br>​    执行该指令；<br>​    PC ++;<br>}</li></ul></li><li><p>JVM Stack</p><ul><li><p>每个方法对应一个栈帧, 栈帧可以叠加 代表方法调用方法</p><ul><li><p>每个方法都有自己的栈帧,并且都拥有这四个属性</p><ul><li><ol><li><p>Local Variable Table</p><ul><li>局部变量表  istore_3</li><li>包括入参和方法内定义的变量</li><li>非static 里面默认包含一个this</li></ul></li></ol></li><li><ol start="2"><li><p>Operand-Stack</p><ul><li>操作数栈 一个用来执行栈操作的 压栈和出栈 </li><li>如果某个指令把一个值压入到操作数栈中，稍后另一个指令就可以弹出这个值来使用。</li></ul></li></ol></li><li><ol start="3"><li><p>Dynamic Linking</p><ul><li>动态链接   当一个方法里面有指向另一个类的符号引用时, 将符号引用替换为直接引用, </li></ul></li></ol></li><li><ol start="4"><li><p>return address</p><ul><li>a() -&gt; b()，方法a调用了方法b, b方法的返回值放在什么地方</li><li>b方法的返回值放在A方法的栈顶 便于赋值</li><li>return后返回的地方 </li></ul></li></ol></li></ul></li><li><p>A-&gt;B-&gt;C   栈帧也是 ABC</p></li></ul></li><li><p>指令集目前分为两种</p><ul><li><p>1 基于栈的指令集  JVM就是这样的</p><ul><li>iadd</li><li>istore_2</li><li>load</li><li>pop</li><li>mul</li><li>sub</li><li>return</li><li><p>invoke</p><ul><li><p>InvokeStatic</p><ul><li>调用静态方法使用的</li></ul></li><li><p>InvokeVirtual</p><ul><li>多数方法使用这个  自带多态</li></ul></li><li><p>InvokeInterface</p><ul><li>List list = new ArrayList<string>(); 使用</string></li></ul></li><li><p>InvokeSpecial</p><ul><li>可以直接调用的 不需要多态 </li><li>private  </li></ul></li><li><p>InvokeDynamic</p><ul><li>lambda 使用或者反射使用 </li></ul></li></ul></li></ul></li><li><ol start="2"><li>基于寄存器的指令集  类似汇编  AX BX</li></ol></li></ul></li></ul></li><li><p>Native Method Stack</p><ul><li>本地方法栈为虚拟机使用到的Native方法服务</li></ul></li></ul><h3 id="共享区域"><a href="#共享区域" class="headerlink" title="共享区域"></a>共享区域</h3><ul><li>Heap  堆</li><li><p>method Area</p><ul><li>装的各种各样的 class结构</li><li><ol><li>Perm Space (&lt;1.8)<br>字符串常量位于PermSpace<br>FGC不会清理<br>大小启动的时候指定，不能变</li></ol></li><li><ol start="2"><li>Meta Space (&gt;=1.8)<br>字符串常量位于堆<br>会触发FGC清理<br>不设定的话，最大就是物理内存</li></ol></li></ul></li><li><p>Direct Memory</p><ul><li>JVM 使用未公开的Unsafe 可以直接访问内核空间的内存 (操作系统OS管理的内存) </li><li>NIO包下ByteBuffer 提高效率, 实现zero copy</li><li><p>在jvm中只保留一个引用,</p><ul><li>可以扩展至更大的内存空间。比如超过1TB甚至比主存还大的空间</li><li>理论上能减少GC暂停时间（节约了大量的堆内内存）</li><li>它的持久化存储可以支持快速重启，同时还能够在测试环境中重现生产数据</li><li><p>堆外内存能够提升IO效率</p><ul><li>堆内内存由JVM管理，属于“用户态”；而堆外内存由OS管理，属于“内核态”。<br>如果从堆内向磁盘写数据时，数据会被先复制到堆外内存，即内核缓冲区，然后再由OS写入磁盘，使用堆外内存避免了数据从用户内向内核态的拷贝。</li></ul></li></ul></li></ul></li><li><p>Run-Time Constant Pool</p><ul><li>常量池的数据</li></ul></li></ul><h2 id="JMM-java-memory-model"><a href="#JMM-java-memory-model" class="headerlink" title="JMM (java memory model)"></a>JMM (java memory model)</h2><h3 id="硬件层数据一致性问题"><a href="#硬件层数据一致性问题" class="headerlink" title="硬件层数据一致性问题"></a>硬件层数据一致性问题</h3><ul><li><p>JMM 有很多协议 一般使用intel的MESI </p><ul><li>MESI 一共有四种状态来表示当前缓存的状态</li></ul></li><li><p>现代CPU的数据一致性是靠 缓存锁 + 总线锁来实现</p></li><li>读取缓存是以cache line为单位, 目前是64bytes位 一块为单位</li><li>四块为一个单位的合并写技术 WCbuffer</li><li><p>伪共享 就是  当内存发现这一块的数据中有一个发生改变就会重新读取整个块的内容 这样就会导致  即使你用不到的数据发生变动 也会导致重新加载内存的问题</p><ul><li>在多线程与高并发期间Disruptor 就采用了在游标前后加上 7个空的long类型 填充缓存块</li></ul></li></ul><h3 id="乱排序问题"><a href="#乱排序问题" class="headerlink" title="乱排序问题"></a>乱排序问题</h3><ul><li>cpu会将无关的指令并行执行 但有时候也会出现问题</li><li><p>处理乱序的规范</p><ul><li><p>硬件内存屏障 X86 cpu硬件级别的内存屏障 利用汇编指令来完成 </p><ul><li>save fence 写操作 写之前必须完成这个指令前的所有操作</li><li>load fence 读操作 读操作之前必须在这个指令前的所有操作</li><li>mfence 读写操作  这条指令前的所有读写必须完成了才能操作后续的指令</li><li>原子指令，如x86上的”lock …” 指令是一个Full Barrier，执行时会锁住内存子系统来确保执行顺序，甚至跨多个CPU。Software Locks通常使用了内存屏障或原子指令来实现变量可见性和保持程序顺序</li></ul></li><li><p>JVM级别的内存屏障</p><ul><li><p>LoadLoad屏障  (读操作)</p><ul><li>语句Load1; LoadLoad; Load2，</li><li>在执行之前必须保证之前的读取数据访问完成</li></ul></li><li><p>StoreStore屏障 (写操作)</p><ul><li>语句Store1; StoreStore; Store2，</li><li>在执行之前保证1的写入操作 对其他处理器可见</li></ul></li><li><p>LoadStore屏障</p><ul><li>语句Load1; LoadStore; Store2，</li><li>在后续写入操作被刷出之前,必须保证之前的操作读取完毕</li></ul></li><li><p>StoreLoad屏障</p><ul><li>语句Store1; StoreLoad; Load2，</li><li>在Load2及后续所有读取操作执行前，保证Store1的写入对所有处理器可见。</li></ul></li></ul></li></ul></li></ul><h3 id="volatile实现细节"><a href="#volatile实现细节" class="headerlink" title="volatile实现细节"></a>volatile实现细节</h3><ul><li><p>字节码层面</p><ul><li>Access flags  = volatile</li></ul></li><li><p>JVM层面</p><ul><li>volatile内存区的读写 都加屏障</li><li>StoreStoreBarrier</li></ul></li></ul><p>volatile 写操作</p><p>StoreLoadBarrier</p><pre><code>- LoadLoadBarrier</code></pre><p>volatile 读操作</p><p>LoadStoreBarrier</p><ul><li><p>OS/硬件层面</p><ul><li><p>windows lock 指令实现</p><ul><li>子主题 1</li></ul></li><li><p>工具 hsdis </p></li></ul></li></ul><h3 id="Synchronized-实现细节"><a href="#Synchronized-实现细节" class="headerlink" title="Synchronized 实现细节"></a>Synchronized 实现细节</h3><ul><li><p>字节码层面</p><ul><li>ACC_SYNCHRONIZED<br>monitorenter monitorexit  monitorexit</li></ul></li><li><p>JVM层面的实现</p><ul><li>调用了 C C++ 指令</li></ul></li><li><p>OS/硬件层面的实现</p><ul><li>X86  Lock  cmpxchg XXX 指令 </li></ul></li></ul><h2 id="5-jvm-常用命令"><a href="#5-jvm-常用命令" class="headerlink" title="5. jvm 常用命令"></a>5. jvm 常用命令</h2><h3 id="开头的-标准参数"><a href="#开头的-标准参数" class="headerlink" title="-开头的 标准参数"></a>-开头的 标准参数</h3><h3 id="X-开头的是非标准参数"><a href="#X-开头的是非标准参数" class="headerlink" title="-X 开头的是非标准参数"></a>-X 开头的是非标准参数</h3><h3 id="XX-是不建议使用的参数"><a href="#XX-是不建议使用的参数" class="headerlink" title="-XX 是不建议使用的参数"></a>-XX 是不建议使用的参数</h3><h3 id="常见垃圾回收器的组合参数设定-1-8"><a href="#常见垃圾回收器的组合参数设定-1-8" class="headerlink" title="常见垃圾回收器的组合参数设定 1.8"></a>常见垃圾回收器的组合参数设定 1.8</h3><ul><li><p>一般不会使用的</p><ul><li>-XX:+UseParNewGC = ParNew + SerialOld</li><li>-XX:+UseSerialGC = Serial New (DefNew) + Serial Old</li></ul></li><li><p>常见的几种组合</p><ul><li>-XX:+UseConc(urrent)MarkSweepGC = ParNew + CMS + Serial Old</li><li>-XX:+UseParallelGC = Parallel Scavenge + Parallel Old (1.8默认) 【PS + SerialOld】</li><li>-XX:+UseParallelOldGC = Parallel Scavenge + Parallel Old</li><li>-XX:+UseG1GC = G1</li></ul></li><li><p>Linux下1.8版本默认的垃圾回收器到底是什么？</p><ul><li>1.8.0_181 默认（看不出来）Copy MarkCompact</li><li>1.8.0_222 默认 PS + PO</li></ul></li></ul><h3 id="GC-日志打印"><a href="#GC-日志打印" class="headerlink" title="GC 日志打印"></a>GC 日志打印</h3><ul><li>-XX:+PrintGC 输出GC日志</li><li>-XX:+PrintGCDetails 输出GC的详细日志</li><li>-XX:+PrintGCTimeStamps 输出GC的时间戳（以基准时间的形式）</li><li>-XX:+PrintGCDateStamps 输出GC的时间戳（以日期的形式，如 2013-05-04T21:53:59.234+0800）</li><li>-XX:+PrintHeapAtGC 在进行GC的前后打印出堆的信息</li><li>-Xloggc:../logs/gc.log 日志文件的输出路径</li><li>-XX:+HeapDumpOnOutOfMemoryError   发生异常 自动存储</li><li>例如: java  -XX:+HeapDumpOnOutOfMemoryError   -XX:+PrintGCDateStamps -XX:+PrintGCDetails -Xloggc:./gclog -jar zhxt-1.01-SNAPSHOT.jar</li></ul><h2 id="6-GC-与调优"><a href="#6-GC-与调优" class="headerlink" title="6. GC 与调优"></a>6. GC 与调优</h2><h3 id="什么是垃圾"><a href="#什么是垃圾" class="headerlink" title="什么是垃圾"></a>什么是垃圾</h3><ul><li>没有任何引用指向的一个对象或者多个对象</li></ul><h3 id="怎么查找到它"><a href="#怎么查找到它" class="headerlink" title="怎么查找到它"></a>怎么查找到它</h3><ul><li><p>Reference Count</p><ul><li>无法解决循环引用 </li></ul></li><li><p>Root Searching</p><ul><li><p>哪些可以成为根节点</p><ul><li>static references in method area 本地方法区的静态引用</li><li>class</li><li>run-time constant pool  常量池</li><li>native method stack JNI指针</li><li>JVM Stack</li></ul></li></ul></li></ul><h3 id="GC-垃圾回收算法"><a href="#GC-垃圾回收算法" class="headerlink" title="GC 垃圾回收算法"></a>GC 垃圾回收算法</h3><ul><li><p>Mark-Sweep 标记清除</p><ul><li>通过根节点找到所有在用的,然后清除掉其他没用的</li><li>优点: 存活对象多的情况下效率较高<br>缺点: 容易产生碎片,需要扫描两次</li></ul></li><li><p>Copying</p><ul><li>将内存一分为二<br>优点: 适合存活对象较少 , 只需要扫描一次, 没有碎片<br>缺点: 移动复制对象,需要调整指向引用</li></ul></li><li><p>Mark-Compact</p><ul><li>扫描两次 需要将所以在使用的块移动到一起</li><li>优点: 不会有碎片产生, 不会让内存减半<br>缺点: 需要移动对象,效率偏低,不适合存货对象较多的区域</li></ul></li></ul><h3 id="JVM-内存分代模型"><a href="#JVM-内存分代模型" class="headerlink" title="JVM 内存分代模型"></a>JVM 内存分代模型</h3><ul><li><p>逻辑物理都分代</p><ul><li>POPS, CMS , </li></ul></li><li><p>逻辑分代,物理不分代</p><ul><li>G1</li></ul></li><li><p>逻辑物理都不分代</p><ul><li>Epsilon ZGC Shenandoah</li></ul></li></ul><h3 id="堆内逻辑分区"><a href="#堆内逻辑分区" class="headerlink" title="堆内逻辑分区"></a>堆内逻辑分区</h3><ul><li><p>new / young 新生代  1</p><ul><li>eden 伊甸区 8 </li><li>survivor 1</li><li>survivor 1</li></ul></li><li><p>old tenured老年代  3 </p></li><li>Method area</li></ul><h3 id="Garbage-Collectors"><a href="#Garbage-Collectors" class="headerlink" title="Garbage Collectors"></a>Garbage Collectors</h3><ul><li>Serial</li><li>Seral Old</li><li>ParNew (Parallel New)</li><li><p>CMS </p><ul><li>老年代垃圾回收器 </li><li><p>清理过程</p><ul><li><p>初始标记</p><ul><li>找到根节点并且标记出来</li></ul></li><li><p>并发标记</p><ul><li>找出根节点下的所有关联节点</li></ul></li><li><p>重新标记</p><ul><li>由于并发标记并会停止线程工作 可能导致一些漏标或者错标问题,所以这个时候需要STW来重新整理下</li></ul></li><li><p>并发清理</p><ul><li>将其他的清理掉 这个时候的垃圾就浮动垃圾 等待下一次回收</li></ul></li></ul></li><li><p>缺点</p><ul><li><p>Memory Fragmentation</p><ul><li>内存碎片的问题 当有新的对象在老年代放不下的时候会产生一次较长时间的STW 然后会有Seral Old 来标记移动对象 这样会效率很慢</li><li>解决1.  保证老年代有足够的空间 -XX:CMSSInitiatingOccupancyFraction 60%</li></ul></li><li><p>Floating Garbage</p><ul><li>浮动垃圾过多</li></ul></li></ul></li><li><p>算法</p><ul><li><p>三色标记 + Incremental Update</p><ul><li>三色标记 是在并发标记的过程中 将标记的所有对象归结为三类 黑,白,灰,<br>黑色代表自己和子节点标记完成,<br>灰色代表自己完成子节点未标记完成,<br>白色代表自己和子节点都没标记</li><li><p>漏标问题<br>应为并发过程中还有线程会引用 所以会产生一个情况<br>灰色的子节点标记删除了,<br>黑色新增一个白色的子节点,<br>这样导致子节点会不扫描</p><ul><li>Incremental Update</li><li>增量更新,关注引用的增加,将黑色重新标记为灰色,下次就会重新扫描</li></ul></li></ul></li></ul></li></ul></li><li><p>Parallel Scavenge</p><ul><li>copy 算法</li></ul></li><li><p>Parallel Old</p><ul><li>mark-compact 算法</li></ul></li><li><p>G1  1.8成熟  1.9 默认</p><ul><li><p>算法</p><ul><li><p>三色标记 + SATB</p><ul><li><p>漏标问题</p><ul><li>SATB(Snapshot at the beginning) 将所有的删除操作放在一个栈里面 保证下一次直接扫描这个栈里面的引用就可以了</li></ul></li></ul></li><li><p>将所有内存 分为 Eden, Survivor, Old , Humongous(分配大对象)</p></li><li>传统YGC找一个对象是否存活非常麻烦 需要去遍历所有的堆空间, 这样非常消耗时间</li><li>G1 是把所有关联的内存当成一个card,存储在card table里, 然后每个card里面有一个标识 </li><li>RSet = RemenberedSet<br>记录了其他Region中的对象到本Region的引用<br>垃圾回收器只需要扫描这个RSet就能知道谁引用了</li><li>新老年代比例 G1会根据上次YGC的时间来控制新老年代的比例 一般在5%-60% 之间</li><li>什么时候回FGC<br>当内存分配过快的时候 回产生FGC </li></ul></li></ul></li><li><p>扩内存</p><pre><code>- 提高CPU性能- 降低MixedGC的出发阈值,让MixedGC提前发生 默认是45%</code></pre><ul><li>XX:InitiatingHeapOccupacyPercent</li></ul></li><li><p>Card table  bitmap</p></li><li><p>ZGC</p><ul><li><p>算法</p><ul><li>ColoredPointers + 写屏障</li></ul></li></ul></li><li><p>Epsilon</p><ul><li>什么都不做的垃圾回收器</li></ul></li><li><p>Shenandoah</p><ul><li>收费</li><li><p>算法</p><ul><li>ColoredPointers + 读屏障</li></ul></li></ul></li></ul><h3 id="tunning"><a href="#tunning" class="headerlink" title="tunning"></a>tunning</h3><ul><li><p>基本概念</p><ul><li><p>吞吐量 优先</p><ul><li>PS + PO 算法支撑</li><li>F=N*R/T<br>F：吞吐量；N：并发虚拟用户数；R：每个虚拟用户发出的请求数量；T：性能测试所用的时间</li></ul></li><li><p>响应时间 优先</p><ul><li>G1</li></ul></li><li><p>淘宝一年来最高并发 54W</p></li><li>12306 百万并发</li></ul></li><li><p>什么是调优</p><ul><li><ol><li>根据需求进行JVM规划和预调优</li></ol></li><li><ol start="2"><li>优化运行JVM环境</li></ol></li><li><ol start="3"><li>解决各种JVM在运行过程中的问题 OOM</li></ol></li></ul></li><li><p>调优开始步骤</p><ul><li>需要有具体业务场景</li><li>需要有压力测试报告指明调优方向,</li><li><p>了解业务场景</p><ul><li><ol><li>响应时间、停顿时间 [CMS G1 ZGC] （需要给用户作响应）</li></ol></li><li><ol start="2"><li>吞吐量 = 用户时间 /( 用户时间 + GC时间) [PS]</li></ol></li></ul></li><li><p>选择回收器组合</p></li><li>计算内存需求( 经验值 1.5G 16G)</li><li>选定CPU (越高越好)</li><li>设定年代大小, 升级年龄</li><li><p>设定日志参数</p><ul><li><ol><li>-Xloggc:/opt/xxx/logs/xxx-xxx-gc-%t.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=5 -XX:GCLogFileSize=20M -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCCause</li></ol></li><li><ol start="2"><li>或者每天产生一个日志文件</li></ol></li></ul></li><li><p>观察日志情况</p></li></ul></li><li><p>调优步骤</p><ul><li>查询当前机器所有的进程<br>top  11056</li></ul></li></ul><p>或者 jsp 查询当前所有java进程</p><p>查询指定进程中的所有线程执行状态<br>top -Hp 11056</p><p>查询所有的线程执行状况<br>jstack  11056</p><p>启动信息查询<br>jinfo 88768</p><p>打印堆栈信息<br>jstat -gc 88768 500</p><p>找出哪个对象占用内存最多<br>jmap -histo 88768 | head -20</p><p>导出<br>jmap -dump:format=b,file=xxx pid：<br>线上系统，内存特别大，jmap执行期间会对进程产生很大影响，甚至卡顿（电商不适合）</p><ul><li><p>调优工具Arthas</p><ul><li>jvm == jinfo</li><li><p>thread</p><ul><li>thread 54 </li></ul></li><li><p>dashboard == top</p></li><li><p>heapdump</p><ul><li>heapdump /tmp/dump.hprof</li><li>分析文件 jhat -J -mx=512M dump.hprof</li></ul></li><li><p>jad</p></li><li>redefine 热替换</li></ul></li></ul><h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><h3 id="1-对象的创建过程"><a href="#1-对象的创建过程" class="headerlink" title="1. 对象的创建过程"></a>1. 对象的创建过程</h3><ul><li><ol><li>加载到内存</li></ol></li><li><ol start="2"><li>申请对象内存 </li></ol></li><li><ol start="3"><li>成员变量赋默认值 </li></ol></li><li><ol start="4"><li><p>调用构造方法 <init></init></p><ul><li><ol><li>成员变量 顺序 赋初始值</li></ol></li><li><ol start="2"><li>执行构造方法语句</li></ol></li></ul></li></ol></li></ul><h3 id="2-内存布局"><a href="#2-内存布局" class="headerlink" title="2,内存布局"></a>2,内存布局</h3><ul><li><ol><li><p>普通对象</p><ul><li><ol><li>markword 对象头</li></ol></li><li><ol start="2"><li>ClassPointer指针 -XX:+UseConpressedClassPointers 为4个字节  不开启为8个字节</li></ol></li><li><ol start="3"><li>实例数据 -XX: +UserCompressedOops 为4个字节 不开启为8个字节</li></ol></li><li><ol start="4"><li>padding 对其 8 的倍数</li></ol></li></ul></li></ol></li><li><ol start="2"><li><p>数组对象</p><ul><li><ol><li>对象头：markword 8</li></ol></li><li><ol start="2"><li>ClassPointer指针同上</li></ol></li><li><ol start="3"><li>数组长度：4字节</li></ol></li><li><ol start="4"><li>数组数据</li></ol></li><li><ol start="5"><li>对齐 8的倍数</li></ol></li></ul></li></ol></li></ul><h3 id="3-一个空对象在内存中占用多少个字节"><a href="#3-一个空对象在内存中占用多少个字节" class="headerlink" title="3. 一个空对象在内存中占用多少个字节"></a>3. 一个空对象在内存中占用多少个字节</h3><ul><li><p>普通对象</p><ul><li>对象头markword 8个字节</li><li>指针 本来是8个字节 但是64位系统为压缩到4个字节</li><li>本来是8+4 = 12 后续padding补齐 一共16个字节</li></ul></li><li><p>数组对象</p><ul><li>比普通对象多个 数组长度 4个字节</li></ul></li></ul><h3 id="4-对象头具体包含什么"><a href="#4-对象头具体包含什么" class="headerlink" title="4. 对象头具体包含什么"></a>4. 对象头具体包含什么</h3><ul><li>4位的 分代年龄</li><li>1位的偏向锁</li><li>2位的锁标志</li><li>31位的 hash code</li></ul><h3 id="5-对象怎么定位"><a href="#5-对象怎么定位" class="headerlink" title="5. 对象怎么定位"></a>5. 对象怎么定位</h3><ul><li><p>句柄池</p><ul><li><p>通过一个间接指针来指到两个指针上</p><ul><li>其中一个指定 T.clss</li><li>另外一个指定具体内容</li></ul></li></ul></li><li><p>直接指针 (HotSpot)</p><ul><li>A指向内容 内容包含B.class</li></ul></li></ul><h3 id="6-对象的分配过程"><a href="#6-对象的分配过程" class="headerlink" title="6. 对象的分配过程"></a>6. 对象的分配过程</h3><ul><li><p>栈上分配</p><ul><li>线程私有小对象</li><li>逃逸分析</li></ul></li><li><p>查看大不大 如果大的直接old</p></li><li><p>TLAB</p><ul><li>Thread Loocal Allocation Buffer</li><li>多线程的时候每个人分配占用1%的eden区域来分配对象,提高效率</li></ul></li><li><p>eden</p></li></ul><h3 id="对象何时进入老年代"><a href="#对象何时进入老年代" class="headerlink" title="对象何时进入老年代"></a>对象何时进入老年代</h3><ul><li>除了CMS是6次之外 其他的都是15</li></ul><h3 id="分配担保"><a href="#分配担保" class="headerlink" title="分配担保"></a>分配担保</h3><ul><li>YGC期间 当Sruvivor区内存空间不够了 空间担保直接进入老年代</li></ul><h3 id="动态年龄"><a href="#动态年龄" class="headerlink" title="动态年龄"></a>动态年龄</h3><ul><li>Survivor 的 区域大于50% , 找出年龄最大的放在老年代</li></ul>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
          <category> jvm </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>predixy</title>
      <link href="/2020/06/06/predixy/"/>
      <url>/2020/06/06/predixy/</url>
      
        <content type="html"><![CDATA[<p>predixy</p><p>去github 找最新的tar包下载到服务器 </p><p><a href="https://github.com/joyieldInc/predixy.git" target="_blank" rel="noopener">https://github.com/joyieldInc/predixy.git</a></p><p>git clone  <a href="https://github.com/joyieldInc/predixy/releases/download/1.0.5/predixy-1.0.5-bin-amd64-linux.tar.gz" target="_blank" rel="noopener">https://github.com/joyieldInc/predixy/releases/download/1.0.5/predixy-1.0.5-bin-amd64-linux.tar.gz</a></p><p>解压<br>tar xf predixy-1.0.5-bin-amd64-linux.tar.gz</p><p>进入主目录<br>cd bin </p><p>配置文件<br>cd conf</p><p>vi predixy.conf </p><p>Bind 127.0.0.1:7617</p><p>找到servers<br>Include sentinel.conf</p><p>vi sentinel.conf</p><p>复制examples</p><p>在sentinels 里面配置 你之前设置好的redis-sentinel</p><ul><li>127.0.0.1:26379</li><li>127.0.0.1:26380</li><li>127.0.0.1:26381</li></ul><p>还需要配置你的主库名称</p><p>Group master1 {</p><p>}</p><p>Group master2 {</p><p>}</p>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
          <category> java </category>
          
          <category> linux </category>
          
          <category> db </category>
          
          <category> 工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>推特redis twemproxy集群搭建</title>
      <link href="/2020/06/01/twemproxy/"/>
      <url>/2020/06/01/twemproxy/</url>
      
        <content type="html"><![CDATA[<p>简单介绍可以查看<a href="https://github.com/twitter/twemproxy.git" target="_blank" rel="noopener">https://github.com/twitter/twemproxy.git</a></p><p>推特redis twemproxy集群搭建 </p><p>twemproxy</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/twitter/twemproxy.git</span><br></pre></td></tr></table></figure><p>如果报错 yum update nss</p><p>进入twemproxy文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install automake libtool -y</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autoreconf -fvi</span><br></pre></td></tr></table></figure><p>如果报错</p><p>更改centOS源<br><a href="https://developer.aliyun.com/mirror/" target="_blank" rel="noopener">https://developer.aliyun.com/mirror/</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo</span><br></pre></td></tr></table></figure><p>yum clean all </p><ul><li>进入twemproxy文件夹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum search autoconf</span><br></pre></td></tr></table></figure><p>搜索出来的 install 下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install autoreconf268</span><br></pre></td></tr></table></figure><ul><li>autoreconf268 -fvi<br>执行完之后 多了一个 configure</li></ul><ul><li><p>执行 ./configure</p></li><li><p>执行 make</p></li></ul><p>进入scripts</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp nutcracker.init /etc/init.d/twemproxy</span><br><span class="line">cd /etc/init.d/twemproxy</span><br></pre></td></tr></table></figure><p>赋予权限</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x twemproxy</span><br></pre></td></tr></table></figure><p>因为该文件依赖一个yml配置文件</p><p>所以我们需要拷贝一个源码目录的这个配置文件</p><p>进入twemproxy文件夹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp ./conf/* /etc/nutcracker/</span><br><span class="line">cd /twemproxy/nutcracker/src</span><br></pre></td></tr></table></figure><p>拷贝可执行 cp nutcracker /sur/bin</p><ul><li>修改配置文件</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cd /etc/nutcracker/</span><br><span class="line"></span><br><span class="line">vi nutcracker.yml</span><br></pre></td></tr></table></figure><p>配置对应的server</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">servers</span><br><span class="line">- 127.0.0.1:6379</span><br><span class="line">- 127.0.0.1:6380</span><br></pre></td></tr></table></figure><ul><li>启动刚刚配置好的 redis</li></ul><p>启动nutcracker </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service nutcracker start</span><br></pre></td></tr></table></figure><p>如果你改名了的话就用改了名字的启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service twemproxy start</span><br></pre></td></tr></table></figure><p>然后去启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 22121</span><br></pre></td></tr></table></figure><p>端口是你刚刚那个配置文件里配置的端口</p><p>这个时候你连接22121 的redis 添加的数据会落在你之前配置的yml文件的server数据库中</p><p>缺点<br>不支持 keys *<br>不支持 watch<br>不支持 multi</p>]]></content>
      
      
      <categories>
          
          <category> redis </category>
          
          <category> java </category>
          
          <category> linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>设计原则</title>
      <link href="/2020/04/29/%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/"/>
      <url>/2020/04/29/%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99/</url>
      
        <content type="html"><![CDATA[<h1 id="单一职责原则"><a href="#单一职责原则" class="headerlink" title="单一职责原则"></a>单一职责原则</h1><p>单个类不要设计的太庞大</p><p>当关联业务比较多的时候可以单独抽出来做一个manage类</p><p>Person 人相关的方法</p><p>PersonManager 与人相关的业务方法</p><h1 id="开闭原则"><a href="#开闭原则" class="headerlink" title="开闭原则"></a>开闭原则</h1><p>设计紧抓这一点 “面向修改关闭,面向拓展开放”</p><p>当你发现修改一个业务需要更改很多地方或者很多代码的时候说明你的设计有问题</p><p>尽量在最少修改的情况下达到完成需求. </p><p>留下以前的代码,旧代码也有价值的.</p><h1 id="里氏替换原则"><a href="#里氏替换原则" class="headerlink" title="里氏替换原则"></a>里氏替换原则</h1><p>Liscov Substitutiono Principle</p><p>所有引用父类对象的地方,必须能够透明的使用子类对象</p><h1 id="依赖倒置原则"><a href="#依赖倒置原则" class="headerlink" title="依赖倒置原则"></a>依赖倒置原则</h1><p>Dependency INversion Priciple</p><p>参考 Array 对应 ArrayList ,LinkedList </p><p>就是在你需要添加新业务的时候 只需要新增一个抽象类的子类, </p><p>你只需要调用抽象类的方法就可以完成需求,无需修改现有逻辑,</p><p>面向接口编程 . 面向抽象编程.</p><h1 id="接口隔离原则"><a href="#接口隔离原则" class="headerlink" title="接口隔离原则"></a>接口隔离原则</h1><p>每个接口承担自己独立的业务,不要混和完成一个功能.</p>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>模板方法设计模式</title>
      <link href="/2020/04/28/TemplateMathod/"/>
      <url>/2020/04/28/TemplateMathod/</url>
      
        <content type="html"><![CDATA[<p>模板方法 也叫钩子函数 </p><p>就是父类把所有的应该做的方法都写出来 让子类去实现</p><p>我先定义一个模板出来 </p><p>具体的实现子类去做</p><p>定义抽象类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">F</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        op1();</span><br><span class="line">        op2();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">op1</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">op2</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以实现一个子类或多个子类 </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1</span> <span class="keyword">extends</span> <span class="title">F</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">op1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"op1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">op2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"op2"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>main 使用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">F f = <span class="keyword">new</span> C1();</span><br><span class="line">f.m();</span><br></pre></td></tr></table></figure><p>在AQS里面有使用这个模式 </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Sync</span> <span class="keyword">extends</span> <span class="title">AbstractQueuedSynchronizer</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">5179523762034025860L</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Performs &#123;<span class="doctag">@link</span> Lock#lock&#125;. The main reason for subclassing</span></span><br><span class="line"><span class="comment">         * is to allow fast path for nonfair version.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Performs non-fair tryLock.  tryAcquire is implemented in</span></span><br><span class="line"><span class="comment">         * subclasses, but both need nonfair try for trylock method.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">nonfairTryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">final</span> Thread current = Thread.currentThread();</span><br><span class="line">            <span class="keyword">int</span> c = getState();</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, acquires)) &#123;</span><br><span class="line">                    setExclusiveOwnerThread(current);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (current == getExclusiveOwnerThread()) &#123;</span><br><span class="line">                <span class="keyword">int</span> nextc = c + acquires;</span><br><span class="line">                <span class="keyword">if</span> (nextc &lt; <span class="number">0</span>) <span class="comment">// overflow</span></span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"Maximum lock count exceeded"</span>);</span><br><span class="line">                setState(nextc);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryRelease</span><span class="params">(<span class="keyword">int</span> releases)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> c = getState() - releases;</span><br><span class="line">            <span class="keyword">if</span> (Thread.currentThread() != getExclusiveOwnerThread())</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalMonitorStateException();</span><br><span class="line">            <span class="keyword">boolean</span> free = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="number">0</span>) &#123;</span><br><span class="line">                free = <span class="keyword">true</span>;</span><br><span class="line">                setExclusiveOwnerThread(<span class="keyword">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            setState(c);</span><br><span class="line">            <span class="keyword">return</span> free;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">isHeldExclusively</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="comment">// While we must in general read state before owner,</span></span><br><span class="line">            <span class="comment">// we don't need to do so to check if current thread is owner</span></span><br><span class="line">            <span class="keyword">return</span> getExclusiveOwnerThread() == Thread.currentThread();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">final</span> ConditionObject <span class="title">newCondition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ConditionObject();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Methods relayed from outer class</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">final</span> Thread <span class="title">getOwner</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> getState() == <span class="number">0</span> ? <span class="keyword">null</span> : getExclusiveOwnerThread();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">final</span> <span class="keyword">int</span> <span class="title">getHoldCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> isHeldExclusively() ? getState() : <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">isLocked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> getState() != <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Reconstitutes the instance from a stream (that is, deserializes it).</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(java.io.ObjectInputStream s)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> java.io.IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">            s.defaultReadObject();</span><br><span class="line">            setState(<span class="number">0</span>); <span class="comment">// reset to unlocked state</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Sync object for non-fair locks</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NonfairSync</span> <span class="keyword">extends</span> <span class="title">Sync</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">7316153563782823691L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Performs lock.  Try immediate barge, backing up to normal</span></span><br><span class="line"><span class="comment">     * acquire on failure.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">            setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            acquire(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryAcquire</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> nonfairTryAcquire(acquires);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Creates an instance of &#123;<span class="doctag">@code</span> ReentrantLock&#125;.</span></span><br><span class="line"><span class="comment">   * This is equivalent to using &#123;<span class="doctag">@code</span> ReentrantLock(false)&#125;.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ReentrantLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      sync = <span class="keyword">new</span> NonfairSync();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Acquires the lock.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * &lt;p&gt;Acquires the lock if it is not held by another thread and returns</span></span><br><span class="line"><span class="comment">   * immediately, setting the lock hold count to one.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * &lt;p&gt;If the current thread already holds the lock then the hold</span></span><br><span class="line"><span class="comment">   * count is incremented by one and the method returns immediately.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * &lt;p&gt;If the lock is held by another thread then the</span></span><br><span class="line"><span class="comment">   * current thread becomes disabled for thread scheduling</span></span><br><span class="line"><span class="comment">   * purposes and lies dormant until the lock has been acquired,</span></span><br><span class="line"><span class="comment">   * at which time the lock hold count is set to one.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          sync.lock();</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>工厂设计模式实际应用案例</title>
      <link href="/2020/04/24/factory/"/>
      <url>/2020/04/24/factory/</url>
      
        <content type="html"><![CDATA[<h1 id="设计模式中的工厂模式"><a href="#设计模式中的工厂模式" class="headerlink" title="设计模式中的工厂模式"></a>设计模式中的工厂模式</h1><p>  工厂模式在实际应用中也很常见 各种框架的factory也很多 </p><h2 id="先说说需求"><a href="#先说说需求" class="headerlink" title="先说说需求"></a>先说说需求</h2><p>我们这个项目有一个发送通知的需求</p><p>通知有各种各样的 举几个例子</p><p>手机验证码通知</p><p>项目审批通知</p><p>出函通知</p><p>确认函通知</p><p>会议取消通知</p><p>待处理通知</p><p>… </p><p>发送方式也有很多种</p><p>邮件通知</p><p>短信通知</p><p>微信通知</p><p>钉钉通知</p><p>…</p><p>所以在设计的时候一个合格的通知必须经过三个步骤</p><ol><li>确定发送类型</li><li>确定发送人</li><li>确定发送方式</li></ol><p>我们可以把通知类做成一个factory 专门做通知的发送</p><p>// 2020年修改</p><p>后来我觉得这么设计有点不妥</p><p>改成</p><p>factory 制作各种通知</p><p>由策略模式来负责发送短信</p><p>工厂只负责短信的生产,不负责发送</p><h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><h3 id="步骤-1"><a href="#步骤-1" class="headerlink" title="步骤 1"></a>步骤 1</h3><p>创建一个接口。</p><p>ProfessorStrategy</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">notice</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">type</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">choose</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">send</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="步骤-2"><a href="#步骤-2" class="headerlink" title="步骤 2"></a>步骤 2</h3><p>创建实现接口的实体类。</p><p>EIMProfessorStrategy</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EIMProfessorStrategy</span> <span class="keyword">implements</span> <span class="title">ProfessorStrategy</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Professor&gt; <span class="title">five</span><span class="params">(Integer tableId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//省略了我的筛选策略</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>IPDProfessorStrategy</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IPDProfessorStrategy</span> <span class="keyword">implements</span> <span class="title">ProfessorStrategy</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Professor&gt; <span class="title">five</span><span class="params">(Integer tableId)</span> </span>&#123;</span><br><span class="line">     <span class="comment">//省略了我的筛选策略</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserProfessorStrategy</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserProfessorStrategy</span> <span class="keyword">implements</span> <span class="title">ProfessorStrategy</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Professor&gt; <span class="title">five</span><span class="params">(Integer tableId)</span> </span>&#123;</span><br><span class="line">     <span class="comment">//省略了我的筛选策略</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="步骤-3"><a href="#步骤-3" class="headerlink" title="步骤 3"></a>步骤 3</h3><p>创建一个<em>工厂</em>，生成基于给定信息的实体类的对象。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回接口数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> professorStrategy</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span>   List&lt;SysAttendsModel&gt; <span class="title">find</span><span class="params">(Integer tableId, ProfessorStrategy professorStrategy)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        获取对应的五个专家</span></span><br><span class="line">        List&lt;Professor&gt; five = professorStrategy.five(tableId);</span><br><span class="line"></span><br><span class="line">        List&lt;SysAttendsModel&gt; sysAttendsModels = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sysAttendsModels;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="步骤-4"><a href="#步骤-4" class="headerlink" title="步骤 4"></a>步骤 4</h3><p>使用 <em>find</em> 来查看当它改变策略 <em>Strategy</em> 时的行为变化。</p><p>main</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 单据id</span></span><br><span class="line">      <span class="keyword">int</span> tableId = <span class="number">10086</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 挂牌算法</span></span><br><span class="line">      List&lt;SysAttendsModel&gt; list = find(tableId, <span class="keyword">new</span> EIMProfessorStrategy());</span><br><span class="line">      <span class="comment">// 可转债算法</span></span><br><span class="line">  List&lt;SysAttendsModel&gt; list2 = find(tableId, <span class="keyword">new</span> IPDProfessorStrategy());</span><br><span class="line">      <span class="comment">// 会员算法</span></span><br><span class="line">  List&lt;SysAttendsModel&gt; list2 = find(tableId, <span class="keyword">new</span> IPDProfessorStrategy());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="代码讲解"><a href="#代码讲解" class="headerlink" title="代码讲解"></a>代码讲解</h2>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>权限设计</title>
      <link href="/2020/04/14/%E6%9D%83%E9%99%90%E8%AE%BE%E8%AE%A1/"/>
      <url>/2020/04/14/%E6%9D%83%E9%99%90%E8%AE%BE%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="设计核心"><a href="#设计核心" class="headerlink" title="设计核心"></a>设计核心</h2><p>每个登录用户拥有各自的权限,由后端返回</p><h3 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h3><p>下文整个权限模式基于RBAC理论设计</p><p>后台验证角色的权限,前端根据后台返回的menuList, permissionList 来设计前端的页面Router</p><p>角色的作用其实只是用来管理分配权限的,真正的验证只验证<strong>权限</strong> </p><h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><p>数据库主要包含五张表，分别是<br>用户表 <strong>sys_user</strong> 、<br>角色表 <strong>sys_role</strong> 、<br>用户角色表 <strong>sys_job</strong> 、<br>权限表 <strong>sys_permission</strong> 、<br>角色权限表 <strong>sys_role_permission</strong> 。</p><p>关联关系如下图所示</p><p><img src="/static/权限1.png" alt="权限1"></p><h3 id="数据库表内容及其含义"><a href="#数据库表内容及其含义" class="headerlink" title="数据库表内容及其含义"></a>数据库表内容及其含义</h3><h4 id="运营后台用户表"><a href="#运营后台用户表" class="headerlink" title="运营后台用户表"></a>运营后台用户表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`sys_user`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`username`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户名'</span>,</span><br><span class="line">  <span class="string">`password`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'密码'</span>,</span><br><span class="line">  <span class="string">`nickname`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'昵称'</span>,</span><br><span class="line">  <span class="string">`role_id`</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'角色ID'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> <span class="built_in">timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'创建时间'</span>,</span><br><span class="line">  <span class="string">`update_time`</span> <span class="built_in">timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'修改时间'</span>,</span><br><span class="line">  <span class="string">`delete_status`</span> <span class="built_in">varchar</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="string">'1'</span> <span class="keyword">COMMENT</span> <span class="string">'是否有效  1有效  2无效'</span>,</span><br><span class="line">  <span class="string">`phone`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'管理员手机号'</span>,</span><br><span class="line">  <span class="string">`type`</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="string">'1'</span> <span class="keyword">COMMENT</span> <span class="string">'1:流程管理用户 2：管理员或者超级管理员'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">10089</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">'运营后台用户表'</span>;</span><br></pre></td></tr></table></figure><h4 id="用户的组织角色和岗位信息"><a href="#用户的组织角色和岗位信息" class="headerlink" title="用户的组织角色和岗位信息"></a>用户的组织角色和岗位信息</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`sys_job`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'id'</span>,</span><br><span class="line">  <span class="string">`org_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'组织id'</span>,</span><br><span class="line">  <span class="string">`job_name`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'表单id'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> <span class="built_in">timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'创建时间'</span>,</span><br><span class="line">  <span class="string">`update_time`</span> <span class="built_in">timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="string">`delete_status`</span> <span class="built_in">varchar</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="string">'1'</span> <span class="keyword">COMMENT</span> <span class="string">'是否有效 1有效     2无效'</span>,</span><br><span class="line">  <span class="string">`user_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户id'</span>,</span><br><span class="line">  <span class="string">`role_id`</span> <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户关联组的角色'</span>,</span><br><span class="line">  <span class="string">`claim_type`</span> <span class="built_in">varchar</span>(<span class="number">12</span>) <span class="keyword">DEFAULT</span> <span class="string">'1'</span> <span class="keyword">COMMENT</span> <span class="string">'认领类型 1：可以认领任务 2：不能认领任务'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1084</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COMMENT</span>=<span class="string">'判断用户的组织和岗位'</span>;</span><br></pre></td></tr></table></figure><h4 id="后台角色表"><a href="#后台角色表" class="headerlink" title="后台角色表"></a>后台角色表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`sys_role`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`type`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'角色类型'</span>,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'角色名'</span>,</span><br><span class="line">  <span class="string">`flow_id`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'流程角色id'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> <span class="built_in">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="string">`update_time`</span> <span class="built_in">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="string">`delete_status`</span> <span class="built_in">varchar</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="string">'1'</span> <span class="keyword">COMMENT</span> <span class="string">'是否有效  1有效  2无效'</span>,</span><br><span class="line">  <span class="string">`note`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'备注'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">47</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 ROW_FORMAT=<span class="keyword">COMPACT</span> <span class="keyword">COMMENT</span>=<span class="string">'后台角色表'</span>;</span><br></pre></td></tr></table></figure><h4 id="后台权限表"><a href="#后台权限表" class="headerlink" title="后台权限表"></a>后台权限表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`sys_permission`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">COMMENT</span> <span class="string">'自定id,主要供前端展示权限列表分类排序使用.'</span>,</span><br><span class="line">  <span class="string">`menu_code`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'归属菜单,前端判断并展示菜单使用,'</span>,</span><br><span class="line">  <span class="string">`menu_name`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'菜单的中文释义'</span>,</span><br><span class="line">  <span class="string">`permission_code`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'权限的代码/通配符,对应代码中@RequiresPermissions 的value'</span>,</span><br><span class="line">  <span class="string">`permission_name`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'本权限的中文释义'</span>,</span><br><span class="line">  <span class="string">`required_permission`</span> <span class="built_in">tinyint</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="string">'2'</span> <span class="keyword">COMMENT</span> <span class="string">'是否本菜单必选权限, 1.必选 2非必选 通常是"列表"权限是必选'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">'后台权限表'</span>;</span><br></pre></td></tr></table></figure><h4 id="角色-权限关联表"><a href="#角色-权限关联表" class="headerlink" title="角色-权限关联表"></a>角色-权限关联表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`sys_role_permission`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`role_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'角色id'</span>,</span><br><span class="line">  <span class="string">`permission_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'权限id'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> <span class="built_in">timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="string">`update_time`</span> <span class="built_in">timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="string">`delete_status`</span> <span class="built_in">varchar</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="string">'1'</span> <span class="keyword">COMMENT</span> <span class="string">'是否有效 1有效 2无效'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">20</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">'角色-权限关联表'</span>;</span><br></pre></td></tr></table></figure><h2 id="逻辑设计"><a href="#逻辑设计" class="headerlink" title="逻辑设计"></a>逻辑设计</h2><h3 id="用户配置岗位信息"><a href="#用户配置岗位信息" class="headerlink" title="用户配置岗位信息"></a>用户配置岗位信息</h3><p>举例: 固收分管领导及总裁 账号是 admin11 关联的岗位job信息是1015</p><p>岗位信息包含当前系统中所有的岗位</p><p><img src="/static/image-20200414163259757.png" alt="image-20200414163259757"></p><h3 id="岗位信息关联角色"><a href="#岗位信息关联角色" class="headerlink" title="岗位信息关联角色"></a>岗位信息关联角色</h3><p>当前系统所有的角色信息</p><p>固收分管领导及总裁 流程角色id是user88 角色id是 <strong>39</strong></p><p><img src="/static/image-20200414165633387.png" alt="image-20200414165633387"></p><h3 id="给角色对应的权限"><a href="#给角色对应的权限" class="headerlink" title="给角色对应的权限"></a>给角色对应的权限</h3><p>当前角色对应权限表中的某些权限</p><p>固收分管领导及总裁的角色id是39 所以需要给role_id配置不同的权限.</p><p>下面配置了4个权限,具体权限内容可以在权限表中查看</p><p><img src="/static/image-20200414165858964.png" alt="image-20200414165858964"></p><h3 id="配置所有的权限列表"><a href="#配置所有的权限列表" class="headerlink" title="配置所有的权限列表"></a>配置所有的权限列表</h3><p>存储系统中不同粒度的权限</p><p>包含但不止</p><p><img src="/static/image-20200414162424318.png" alt="image-20200414162424318"></p><p>其中如果想要分配子权限必须拥有顶级权限</p><h2 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h2><p>最后: </p><ul><li>如何一个账号对应多个第三方系统的角色</li></ul><p>有两种解决方案</p><ol><li><p>理论上来讲它也是当前系统中的一种权限,所以把它加到系统权限表中,之后配置角色的时候来添加不同的第三方角色</p></li><li><p>如果你觉得第一种比较麻烦,可以在你当前系统的角色表中添加一个第三方系统角色的ID来标识,这样有一个缺点就是无法添加多个角色,不过也有解决办法,就是新建一张表来维护与第三方的角色关系.</p></li></ol><ul><li>角色继承的问题</li></ul><p>一个user对应多个岗位</p><p>一个岗位对应一个角色</p><p>延伸</p><p>可以在用户user和岗位job两个表中间添加一个关联表</p><p>用户和岗位关联起来</p><p>岗位是初始化指定角色权限的个人岗位job </p><p>初始化的时候角色和岗位是一对一的  </p><p>后期添加操作修改权限是针对岗位来操作的</p><p>举个例子 </p><p>张三是程序员岗位的角色后来申请可以操作DB的权限</p><p> 在数据库中是<strong>张三这个岗位可以操作DB 并不是程序员这个角色可以操作DB</strong></p><p>上面这种架构系统对继承角色非常麻烦, 要么循环当前角色来继承他的权限,要么多维护一张表.或者可以读下关于RBAC3的继承逻辑.</p><p>RBAC参考文献</p><p><a href="http://csrc.nist.gov/groups/SNS/rbac/index.html" target="_blank" rel="noopener">http://csrc.nist.gov/groups/SNS/rbac/index.html</a></p><p><a href="http://csrc.nist.gov/groups/SNS/rbac/faq.html" target="_blank" rel="noopener">http://csrc.nist.gov/groups/SNS/rbac/faq.html</a></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>浅谈jvm</title>
      <link href="/2020/04/10/jvm/"/>
      <url>/2020/04/10/jvm/</url>
      
        <content type="html"><![CDATA[<h3 id="GC的基础知识"><a href="#GC的基础知识" class="headerlink" title="GC的基础知识"></a>GC的基础知识</h3><h4 id="1-什么是垃圾"><a href="#1-什么是垃圾" class="headerlink" title="1.什么是垃圾"></a>1.什么是垃圾</h4><p>简单来讲<strong>没有任何引用指向的一个对象或者多个对象（循环引用）就是垃圾.</strong></p><p>引用又分为强引用，软引用，弱引用，虚引用。 </p><ul><li>强引用（Strong Reference）：这类引用是Java程序中最普遍的。只要强引用还存在，垃圾收集器就永远不会回收掉被引用的对象,当内存不够的时候只会抛出OOM异常</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object  obj = <span class="keyword">new</span> Object();</span><br></pre></td></tr></table></figure><ul><li>软引用（Soft Reference）：它用来描述一些可能还有用，但并非必须的对象。在<strong>系统内存不够用时</strong>，这类引用关联的对象将被垃圾收集器回收。JDK1.2之后提供了SoftReference类来实现软引用。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SoftReference  soft = <span class="keyword">new</span> SoftReference(user);</span><br></pre></td></tr></table></figure><ul><li>弱引用（Weak Reference）：它也是用来描述非须对象的，但它的强度比软引用更弱些，被弱引用关联的对象只能生存到下一次垃圾收集发生之前。当垃圾收集器工作时，<strong>无论当前内存是否足够，都会回收掉</strong>只被弱引用关联的对象。在JDK1.2之后，提供了WeakReference类来实现弱引用。</li></ul><ul><li>虚引用（Phantom Reference）：最弱的一种引用关系，完全不会对其生存时间构成影响，也无法通过虚引用来取得一个对象实例。为一个对象设置虚引用关联的唯一目的<strong>是希望能在这个对象被收集器回收时收到一个系统通知</strong>。JDK1.2之后提供了PhantomReference类来实现虚引用。</li></ul><h4 id="2-如何寻找垃圾"><a href="#2-如何寻找垃圾" class="headerlink" title="2.如何寻找垃圾"></a>2.如何寻找垃圾</h4><ol><li><p>引用计数</p><p>java没有在用这种算法,它需要单独维护一个引用计数器 目前OkHttp,netty在用故不在本章节讨论范围.</p></li><li><p>根可达算法</p></li></ol><p>所谓根集(Root Set)就是正在执行的Java程序可以访问的引用变量（注意：不是对象）的集合(包括局 部变量、参数、类变量)，程序可以使用引用变量访问对象的属性和调用对象的方法。</p><p> 这种算法的基本思路：</p><p>（1）通过一系列名为“GC Roots”的对象作为起始点，寻找对应的引用节点。</p><p>（2）找到这些引用节点后，从这些节点开始向下继续寻找它们的引用节点。 </p><p>（3）重复（2）。</p><p>（4）搜索所走过的路径称为引用链，当一个对象到GC Roots没有任何引用链相连时，就证明此对象是不可用的。</p><p>常见的根节点(起始点)<br>（1）虚拟机栈中引用的对象（栈帧中的本地变量表）；<br>（2）方法区中的常量引用的对象；final 常量名=值;<br>（3）方法区中的类静态属性引用的对象 static；<br>（4）本地方法栈中JNI（Native方法）的引用对象。<br>（5）活跃线程。</p><p>在根搜索算法中，要真正宣告一个对象死亡，至少要经历两次标记过程：</p><p>1.如果对象在进行根搜索后发现没有与GC Roots相连接的引用链，那它会被第一次标记并且进行一次筛选。筛选的条件是此对象是否有必要执行 finalize（）方法。当对象没有覆盖finalize（）方法，或finalize（）方法已经被虚拟机调用过，虚拟机将这两种情况都视为没有必要执行。</p><p>2.如果该对象被判定为有必要执行finalize（）方法，那么这个对象将会被放置在一个名为F-Queue队列中，并在稍后由一条由虚拟机自动建立的、低优先级的Finalizer线程去执行finalize（）方法。finalize（）方法是对象逃脱死亡命运的最后一次机会（因为一个对象的finalize（）方法最多只会被系统自动调用一次），稍后GC将对F-Queue中的对象进行第二次小规模的标记，如果要在finalize（）方法中成功拯救自己，只要在finalize（）方法中让该对象重新引用链上的任何一个对象建立关联即可。而如果对象这时还没有关联到任何链上的引用，那它就会被回收掉。</p><h4 id="3-常见的垃圾回收算法"><a href="#3-常见的垃圾回收算法" class="headerlink" title="3.常见的垃圾回收算法"></a>3.常见的垃圾回收算法</h4><ol><li>标记清除 - 位置不连续 产生碎片</li><li>拷贝算法 - 没有碎片，浪费空间</li><li>标记压缩 - 没有碎片，效率偏低</li></ol><h4 id="4-JVM内存分代模型（用于分代垃圾回收算法）"><a href="#4-JVM内存分代模型（用于分代垃圾回收算法）" class="headerlink" title="4.JVM内存分代模型（用于分代垃圾回收算法）"></a>4.JVM内存分代模型（用于分代垃圾回收算法）</h4><ol><li><p>新生代 + 老年代 + 永久代（1.7）/ 元数据区(1.8) Metaspace</p><ol><li>永久代 元数据 - Class</li><li>永久代必须指定大小限制 ，元数据可以设置，也可以不设置，无上限（受限于物理内存）</li><li>字符串常量 1.7 - 永久代，1.8 - 堆</li><li>MethodArea逻辑概念 - 永久代、元数据</li></ol></li><li><p>新生代 = Eden + 2个suvivor区 </p><ol><li>YGC回收之后，大多数的对象会被回收，活着的进入 s0</li><li>再次YGC，活着的对象eden + s0 -&gt; s1</li><li>再次YGC，eden + s1 -&gt; s0</li><li>年龄足够 -&gt; 老年代 （15 CMS 6）</li><li>suvivor区装不下 -&gt; 老年代</li></ol></li><li><p>老年代</p><ol><li>顽固分子</li><li>老年代满了FGC Full GC</li></ol></li><li>GC Tuning (Generation)<ol><li>尽量减少FGC</li><li>MinorGC = YGC</li><li>MajorGC = FGC</li></ol></li></ol><h4 id="5-常见的垃圾回收器"><a href="#5-常见的垃圾回收器" class="headerlink" title="5.常见的垃圾回收器"></a>5.常见的垃圾回收器</h4><ol><li>Serial 年轻代 串行回收</li><li>PS 年轻代 并行回收</li><li>ParNew 年轻代 配合CMS的并行回收</li><li>SerialOld </li><li>ParallelOld</li><li>ConcurrentMarkSweep 老年代 并发的， 垃圾回收和应用程序同时运行，降低STW的时间(200ms)</li><li>G1(10ms)</li><li>ZGC (1ms) PK C++</li><li>Shenandoah</li><li>Eplison</li></ol><p>1.8默认的垃圾回收：PS + ParallelOld</p><h4 id="6-JVM调优第一步，了解生产环境下的垃圾回收器组合"><a href="#6-JVM调优第一步，了解生产环境下的垃圾回收器组合" class="headerlink" title="6.JVM调优第一步，了解生产环境下的垃圾回收器组合"></a>6.JVM调优第一步，了解生产环境下的垃圾回收器组合</h4><h3 id="jvm运行时数据分析"><a href="#jvm运行时数据分析" class="headerlink" title="jvm运行时数据分析"></a>jvm运行时数据分析</h3><p>在区域中一般分为五块</p><h4 id="运行时数据区域"><a href="#运行时数据区域" class="headerlink" title="运行时数据区域"></a>运行时数据区域</h4><ol><li><p>计数器<br> 通过改变这个计数器的值来获取下一条需要执行的字节码,包括判断<br> 循环,跳转,异常处理</p><ol start="2"><li><p>方法区(method Area)</p><p> 该区域用来存放我们生成的各种对象信息</p></li></ol></li></ol><ol start="3"><li><p>虚拟机栈(VM stack)<br> 每个类 都会在执行的时候创建一个栈帧(javap -c -s xxx.class)来存放关于这个类的所有信息.<br> 包括方法内的局部变量,以及各种操作帧数, 动态链接(各种引用)及方法的出口返回值等等。每个方法的调用到结束意味着虚拟机的栈桢的入栈到出栈,</p></li><li><p>堆(heap)<br> 在遇到new指令后 我们会根据相对应的内存引用 来找如果有就引用  没有的话就执行类加载 Java 类加载过程那一套东西</p></li><li><p>本地方法栈(native mathod stack)<br> 存放本地原生调用方法和虚拟机栈一样只不过内容是原生计算机内的C方法native是与C++联合开发的时候用的 所以一般开发不会用到</p></li></ol><p>前面在堆中说了类引用会检查是否已经加载过当前需要的类 </p><p>如果没有加载则会去加载 那么类的加载过程就是下面要说的</p><p>当程序用到某个类但这个类还没有加载到内存中,jvm会通过加载,连接,初始化来对这个类进行初始化</p><ol><li>加载</li></ol><p>jvm通过类的全类名来获取字节流 (也就是.class文件) 然后根据字节流创建class对象  创建完成后写入到内存中,然后放在运行时区域的方法区内(method Area)  然后在堆(heap)中创建出对应的Class对象</p><ol start="2"><li>链接</li></ol><p>分为三部分 </p><p>验证语法  满足jvm虚拟机规范 </p><p>准备阶段  为类的静态static 分配内存 设置默认值</p><p>解析阶段  将符号引用替换为内存引用(直接引用)</p><ol start="3"><li>初始化</li></ol><p>将static修饰的方法或者变量进行初始化,如果有父级引用优先加载父类 </p><p>那么这个类的加载机制又是什么 它是通过什么来加载的</p><p>采用的双亲委派机制</p><p>当加载某个类的时候先去询问父类节点是否可以加载 </p><p>这样既避免了重复加载也防止了注入还提高了效率</p><h3 id="常见垃圾回收器组合参数设定：-1-8"><a href="#常见垃圾回收器组合参数设定：-1-8" class="headerlink" title="常见垃圾回收器组合参数设定：(1.8)"></a>常见垃圾回收器组合参数设定：(1.8)</h3><ul><li><p>-XX:+UseSerialGC = Serial New (DefNew) + Serial Old</p><ul><li>小型程序。默认情况下不会是这种选项，HotSpot会根据计算及配置和JDK版本自动选择收集器</li></ul></li><li>-XX:+UseParNewGC = ParNew + SerialOld<ul><li>这个组合已经很少用（在某些版本中已经废弃）</li><li><a href="https://stackoverflow.com/questions/34962257/why-remove-support-for-parnewserialold-anddefnewcms-in-the-future" target="_blank" rel="noopener">https://stackoverflow.com/questions/34962257/why-remove-support-for-parnewserialold-anddefnewcms-in-the-future</a></li></ul></li><li>-XX:+UseConc<font color="red">(urrent)</font>MarkSweepGC = ParNew + CMS + Serial Old</li><li>-XX:+UseParallelGC = Parallel Scavenge + Parallel Old (1.8默认) 【PS + SerialOld】</li><li>-XX:+UseParallelOldGC = Parallel Scavenge + Parallel Old</li><li>-XX:+UseG1GC = G1</li><li><p>Linux中没找到默认GC的查看方法，而windows中会打印UseParallelGC </p><ul><li>java +XX:+PrintCommandLineFlags -version</li><li>通过GC的日志来分辨</li></ul></li><li><p>Linux下1.8版本默认的垃圾回收器到底是什么？</p><ul><li>1.8.0_181 默认（看不出来）Copy MarkCompact</li><li>1.8.0_222 默认 PS + PO</li></ul></li></ul><p>  java -XX:+PrintFlagsWithComments //只有debug版本能用</p><ul><li><p>JVM的命令行参数参考：<a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html</a></p></li><li><p>JVM参数分类</p><blockquote><p>标准： - 开头，所有的HotSpot都支持</p><p>非标准：-X 开头，特定版本HotSpot支持特定命令</p><p>不稳定：-XX 开头，下个版本可能取消</p></blockquote><p>-XX:+PrintCommandLineFlags </p><p>-XX:+PrintFlagsFinal 最终参数值</p><p>-XX:+PrintFlagsInitial 默认参数值</p></li></ul><h3 id="PS-GC日志详解"><a href="#PS-GC日志详解" class="headerlink" title="PS GC日志详解"></a>PS GC日志详解</h3><p>每种垃圾回收器的日志格式是不同的！</p><p>PS日志格式</p><p><img src="./GC日志详解.png" alt="GC日志详解"></p><p>heap dump部分：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">eden space <span class="number">5632</span>K, <span class="number">94</span>% used [<span class="number">0</span>x00000000ff980000,<span class="number">0</span>x00000000ffeb3e28,<span class="number">0</span>x00000000fff00000)</span><br><span class="line">                            后面的内存地址指的是，起始地址，使用空间结束地址，整体空间结束地址</span><br></pre></td></tr></table></figure><p><img src="GCHeapDump.png" alt="GCHeapDump"></p><p>total = eden + 1个survivor</p><h3 id="调优前的基础概念："><a href="#调优前的基础概念：" class="headerlink" title="调优前的基础概念："></a>调优前的基础概念：</h3><ol><li>吞吐量：用户代码时间 /（用户代码执行时间 + 垃圾回收时间）</li><li>响应时间：STW越短，响应时间越好</li></ol><p>所谓调优，首先确定，追求啥？吞吐量优先，还是响应时间优先？还是在满足一定的响应时间的情况下，要求达到多大的吞吐量…</p><p>问题：</p><p>科学计算，吞吐量。数据挖掘，thrput。吞吐量优先的一般：（PS + PO）</p><p>响应时间：网站 GUI API （1.8 G1）</p><h3 id="什么是调优？"><a href="#什么是调优？" class="headerlink" title="什么是调优？"></a>什么是调优？</h3><ol><li>根据需求进行JVM规划和预调优</li><li>优化运行JVM运行环境（慢，卡顿）</li><li>解决JVM运行过程中出现的各种问题(OOM)</li></ol><h3 id="调优，从规划开始"><a href="#调优，从规划开始" class="headerlink" title="调优，从规划开始"></a>调优，从规划开始</h3><ul><li><p>调优，从业务场景开始，没有业务场景的调优都是耍流氓</p></li><li><p>无监控（压力测试，能看到结果），不调优</p></li><li><p>步骤：</p><ol><li>熟悉业务场景（没有最好的垃圾回收器，只有最合适的垃圾回收器）<ol><li>响应时间、停顿时间 [CMS G1 ZGC] （需要给用户作响应）</li><li>吞吐量 = 用户时间 /( 用户时间 + GC时间) [PS]</li></ol></li><li>选择回收器组合</li><li>计算内存需求（经验值 1.5G 16G）</li><li>选定CPU（越高越好）</li><li>设定年代大小、升级年龄</li><li>设定日志参数<ol><li>-Xloggc:/opt/xxx/logs/xxx-xxx-gc-%t.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=5 -XX:GCLogFileSize=20M -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCCause</li><li>或者每天产生一个日志文件</li></ol></li><li>观察日志情况</li></ol></li></ul><p>思维导图 查看地址:</p><p><a href="https://www.processon.com/embed/5e902d83e401fd32b82a99c2" target="_blank" rel="noopener">https://www.processon.com/embed/5e902d83e401fd32b82a99c2</a></p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ol><li><a href="https://blogs.oracle.com/jonthecollector/our-collectors" target="_blank" rel="noopener">https://blogs.oracle.com/ </a><a href="https://blogs.oracle.com/jonthecollector/our-collectors" target="_blank" rel="noopener">jonthecollector</a><a href="https://blogs.oracle.com/jonthecollector/our-collectors" target="_blank" rel="noopener">/our-collectors</a></li><li><a href="https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html</a></li><li><a href="http://java.sun.com/javase/technologies/hotspot/vmoptions.jsp" target="_blank" rel="noopener">http://java.sun.com/javase/technologies/hotspot/vmoptions.jsp</a></li><li>《深入理解JVM虚拟机》</li></ol>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>redis-bitmap</title>
      <link href="/2020/04/03/redis-bitmap/"/>
      <url>/2020/04/03/redis-bitmap/</url>
      
        <content type="html"><![CDATA[<h1 id="1-BitMap-是什么"><a href="#1-BitMap-是什么" class="headerlink" title="1. BitMap 是什么"></a>1. BitMap 是什么</h1><p>在redis中可以设置用一个bit的位置来标识某个元素的0-1状态, </p><p>具体的操作指令是  指定某个key的offset的0或者1的状态</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SETBIT key offset value</span><br></pre></td></tr></table></figure><p>计算某个key的被设置为 <code>1</code> 的比特位的数量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BITCOUNT key [start end]</span><br></pre></td></tr></table></figure><h1 id="2-BitMap-怎么用"><a href="#2-BitMap-怎么用" class="headerlink" title="2. BitMap 怎么用"></a>2. BitMap 怎么用</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 设置reids的bitmap位置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> offset 根据需求设置long int</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Boolean <span class="title">setBit</span><span class="params">(String key,<span class="keyword">int</span> offset, Boolean value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> redisTemplate.execute((RedisCallback&lt;Boolean&gt;) con -&gt; con.setBit(key.getBytes(),(<span class="keyword">long</span>)offset,value));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 统计key的所有1值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">bitCount</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> redisTemplate.execute((RedisCallback&lt;Long&gt;) con -&gt; con.bitCount(key.getBytes()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3-BitMap-什么时候用"><a href="#3-BitMap-什么时候用" class="headerlink" title="3. BitMap 什么时候用"></a>3. BitMap 什么时候用</h1><ul><li><h2 id="短信验证一分钟不能发送5次"><a href="#短信验证一分钟不能发送5次" class="headerlink" title="短信验证一分钟不能发送5次"></a>短信验证一分钟不能发送5次</h2></li></ul><h3 id="之前我们的做法"><a href="#之前我们的做法" class="headerlink" title="之前我们的做法"></a>之前我们的做法</h3><p>调用reids的increment方法来自增完成需求</p><h3 id="现在我们的做法"><a href="#现在我们的做法" class="headerlink" title="现在我们的做法"></a>现在我们的做法</h3><p>将当前用户当做key ,拿到当前分钟的毫秒数做offset,最后用bitcount来统计用户在当前分钟数访问次数.</p><ul><li><h2 id="记录用户当前是否在线"><a href="#记录用户当前是否在线" class="headerlink" title="记录用户当前是否在线"></a>记录用户当前是否在线</h2></li></ul><h3 id="之前我们的做法-1"><a href="#之前我们的做法-1" class="headerlink" title="之前我们的做法"></a>之前我们的做法</h3><p>我们需要在数据库字段里标志处是否离线</p><h3 id="现在我们的做法-1"><a href="#现在我们的做法-1" class="headerlink" title="现在我们的做法"></a>现在我们的做法</h3><p>找到我们需要的key, 拿用户id做offset,最后我们标记出是否在线 还可以统计当前在线总人数</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
          <category> redis </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>浅析docker</title>
      <link href="/2020/03/10/docker02/"/>
      <url>/2020/03/10/docker02/</url>
      
        <content type="html"><![CDATA[<h1 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h1><h2 id="Docker-安装"><a href="#Docker-安装" class="headerlink" title="Docker 安装"></a>Docker 安装</h2><p>Mac <a href="https://docs.docker.com/docker-for-mac/install/Windows" target="_blank" rel="noopener">https://docs.docker.com/docker-for-mac/install/Windows</a> </p><p><a href="https://docs.docker.com/docker-for-windows/install/Ubuntu" target="_blank" rel="noopener">https://docs.docker.com/docker-for-windows/install/Ubuntu</a> </p><p><a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/Debian" target="_blank" rel="noopener">https://docs.docker.com/install/linux/docker-ce/ubuntu/Debian</a> </p><p><a href="https://docs.docker.com/install/linux/docker-ce/debian/CentOS" target="_blank" rel="noopener">https://docs.docker.com/install/linux/docker-ce/debian/CentOS</a> </p><p><a href="https://docs.docker.com/install/linux/docker-ce/centos/Fedora" target="_blank" rel="noopener">https://docs.docker.com/install/linux/docker-ce/centos/Fedora</a> </p><p><a href="https://docs.docker.com/install/linux/docker-ce/fedora/" target="_blank" rel="noopener">https://docs.docker.com/install/linux/docker-ce/fedora/</a></p><p>其他 Linux 发行版 </p><p><a href="https://docs.docker.com/install/linux/docker-ce/binaries/" target="_blank" rel="noopener">https://docs.docker.com/install/linux/docker-ce/binaries/</a></p><h2 id="镜像加速"><a href="#镜像加速" class="headerlink" title="镜像加速"></a>镜像加速</h2><p><a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" target="_blank" rel="noopener">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a> 可以按照阿里云的步骤 操作</p><h2 id="容器与镜像"><a href="#容器与镜像" class="headerlink" title="容器与镜像"></a>容器与镜像</h2><p><img src="https://docs.docker.com/engine/images/architecture.svg" alt="docker"></p><p>docker pull  拉取镜像image 然后根据镜像image 产生具体的容器</p><p>我们最后操作的是容器并不是镜像image</p><p>client 指的是我们的操作命令 各种pull run 等等,<br>我们可以根据命令来操作dockerHost,<br>registry 是我们的远程仓库,或者说是dockerhub接下来就是我们的整体dockerHost</p><p>这里面包含了 整个docker组件, images CONTAINERS  </p><p>你可以把daemon当做是一个管家来管理docker组件你在client端上的所有操作都会由它来执行 </p><h2 id="容器生命周期"><a href="#容器生命周期" class="headerlink" title="容器生命周期"></a>容器生命周期</h2><p><img src="/static/image-20200512143758893.png" alt="image-20200512143758893"></p><h2 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h2><h3 id="pull"><a href="#pull" class="headerlink" title="pull"></a>pull</h3><ul><li>拉取镜像文件命令</li><li>docker pull mysql:latestdocker pull mysql:8.0.20格式是 : docker pull NAME[:TAG] TAG 默认是 latest </li></ul><h3 id="images"><a href="#images" class="headerlink" title="images"></a>images</h3><ul><li>docker images 查看所有已经下拉到本地的镜像</li><li>docker images  | grep ‘test’</li></ul><h3 id="run"><a href="#run" class="headerlink" title="run"></a>run</h3><ul><li>docker run tomcat</li><li>端口转发docker run -p 8000:8080 tomcat</li><li>-d 后台运行</li><li>–name  赋予容器名称</li><li>–ip 172.17.0.10 指定启动的ip地址</li></ul><h3 id="logs"><a href="#logs" class="headerlink" title="logs"></a>logs</h3><ul><li>docker logs [容器ID]  查看一个容器的启动日志</li></ul><h3 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h3><ul><li>docker ps 查看所有正在运行容器 (并不是镜像)</li><li>-a 查看所有容器</li></ul><h3 id="stop"><a href="#stop" class="headerlink" title="stop"></a>stop</h3><ul><li>将一个已经在运行的容器停止 docker stop [容器ID]</li></ul><h3 id="kill"><a href="#kill" class="headerlink" title="kill"></a>kill</h3><ul><li>与stop不同的是 kill 会将这个容器删除 stop是将这个容器停止 后续还可以继续start使用</li></ul><h3 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h3><ul><li>使用前容器必须在stop状态下docker rm [容器id] </li><li>无需容器在stop状态强制删除 -fdocker rm -f [容器ID]</li><li>docker rm $(docker ps -a -q)  删除所有容器</li><li>强制删除镜像imagesdocker rmi -f [容器ID]</li><li>注意点：1. 删除前需要保证容器是停止的  stop2. 需要注意删除镜像和容器的命令不一样。 docker rmi ID  ,其中 容器(rm)  和 镜像(rmi)3. 顺序需要先删除容器</li></ul><h3 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h3><ul><li>docker exec -it [id] /bin/bash   进入一个已经存在的容器</li></ul><h3 id="inspect"><a href="#inspect" class="headerlink" title="inspect"></a>inspect</h3><ul><li>docker inspect [容器ID] 查看容器的详细信息</li></ul><h3 id="network"><a href="#network" class="headerlink" title="network"></a>network</h3><ul><li>docker network ls 列出当前存在的网络连接</li><li>docker network create  my_net 创建一个网桥 类似于网关</li><li>-d 设置创建的网络驱动</li></ul><h3 id="build"><a href="#build" class="headerlink" title="build"></a>build</h3><ul><li>docker build -t  机构/镜像名&lt;版本&gt; Dockerfile目录</li></ul><h3 id="help"><a href="#help" class="headerlink" title="help"></a>help</h3><ul><li>docker -h </li><li>docker run -h</li></ul><h2 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h2><h3 id="构建docker-build-t-机构-镜像名-lt-版本-gt-Dockerfile目录"><a href="#构建docker-build-t-机构-镜像名-lt-版本-gt-Dockerfile目录" class="headerlink" title="构建docker build -t  机构/镜像名&lt;版本&gt; Dockerfile目录"></a>构建docker build -t  机构/镜像名&lt;版本&gt; Dockerfile目录</h3><h3 id="FROM-基准镜像-基于哪一个来构建的image"><a href="#FROM-基准镜像-基于哪一个来构建的image" class="headerlink" title="FROM 基准镜像 基于哪一个来构建的image"></a>FROM 基准镜像 基于哪一个来构建的image</h3><ul><li>FROM centos</li><li>FROM scratch 不依赖任何镜像</li><li>FROM mysql:8.0.20</li></ul><h3 id="说明信息"><a href="#说明信息" class="headerlink" title="说明信息"></a>说明信息</h3><ul><li>MAINTAINER 当前镜像由谁来维护</li><li>LABEL version=”V1.0”</li><li>LABEL description = “”</li></ul><h3 id="WORKDIR-工作目录-类似cd"><a href="#WORKDIR-工作目录-类似cd" class="headerlink" title="WORKDIR 工作目录 类似cd"></a>WORKDIR 工作目录 类似cd</h3><h3 id="ADD-amp-COPY"><a href="#ADD-amp-COPY" class="headerlink" title="ADD &amp; COPY"></a>ADD &amp; COPY</h3><ul><li>ADD text.txt / 将当前text文件添加到容器的根目录</li><li>ADD text.gz / 添加并解压缩</li></ul><h3 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h3><ul><li>ENV JAVA_HOME /sur/local/jdk  设置容器环境变量</li></ul><h3 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h3><ul><li><p>shell 模式</p><ul><li>RUN yum install -y vim </li></ul></li><li><p>exec 模式(推荐)</p><ul><li>RUN [“yum”,”install”,”-y”,”vim”]</li></ul></li></ul><h3 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h3><ul><li>只有最后一个有效</li><li>ENTRYPOINT [“ps”]</li></ul><h3 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h3><ul><li>类似ENTRYPOINT 但是有时候不一定会被执行 建议用ENTRYPOINT</li><li>CMD 当你的容器启动的时候最后附带参数的话就不会被执行 如果不附带参数的话就会执行当前CMD指令</li></ul><h3 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h3><ul><li>对外暴露端口</li></ul><h3 id="docker-build-t-机构-镜像名-lt-版本-gt-Dockerfile目录docker-build-t-hki-com-myapp-1-0"><a href="#docker-build-t-机构-镜像名-lt-版本-gt-Dockerfile目录docker-build-t-hki-com-myapp-1-0" class="headerlink" title="docker build -t  机构/镜像名&lt;版本&gt; Dockerfile目录docker build -t hki.com/myapp:1.0 ."></a>docker build -t  机构/镜像名&lt;版本&gt; Dockerfile目录docker build -t hki.com/myapp:1.0 .</h3><h2 id="容器间通讯"><a href="#容器间通讯" class="headerlink" title="容器间通讯"></a>容器间通讯</h2><h3 id="单向通讯"><a href="#单向通讯" class="headerlink" title="单向通讯"></a>单向通讯</h3><ul><li>在启动的时候加上一个参数 –link [需要通讯的容器名称]</li></ul><h3 id="bridge网桥-双向通讯"><a href="#bridge网桥-双向通讯" class="headerlink" title="bridge网桥 双向通讯"></a>bridge网桥 双向通讯</h3><ul><li><p>启动的时候指定网桥来通讯</p><ul><li>–network my_net启动的时候多加一个参数来指定当前容器的 网桥是哪个</li></ul></li><li><p>创建一个网桥 用来通讯</p><ul><li><ol><li>创建一个网桥docker network create my_net</li></ol></li><li><ol start="2"><li>将容器containerr1连接到新建网络my_netdocker network connect my_net container1</li></ol></li><li><ol start="3"><li>将容器containerr2连接到新建网络my_netdocker network connect my_net container2</li></ol></li></ul></li></ul><h2 id="volume数据共享"><a href="#volume数据共享" class="headerlink" title="volume数据共享"></a>volume数据共享</h2><h3 id="数据共享分两种-1-在启动的时候加上-v参数来设置数据卷-2-先设置一个存档点-然后后续容器启动的时候直接指定这个存档点"><a href="#数据共享分两种-1-在启动的时候加上-v参数来设置数据卷-2-先设置一个存档点-然后后续容器启动的时候直接指定这个存档点" class="headerlink" title="数据共享分两种 1. 在启动的时候加上-v参数来设置数据卷 2.  先设置一个存档点,然后后续容器启动的时候直接指定这个存档点"></a>数据共享分两种 1. 在启动的时候加上-v参数来设置数据卷 2.  先设置一个存档点,然后后续容器启动的时候直接指定这个存档点</h3><h3 id="v-宿主机文件地址-容器的文件地址"><a href="#v-宿主机文件地址-容器的文件地址" class="headerlink" title="-v 宿主机文件地址:容器的文件地址"></a>-v 宿主机文件地址:容器的文件地址</h3><h3 id="创建共享容器来存放数据"><a href="#创建共享容器来存放数据" class="headerlink" title="创建共享容器来存放数据"></a>创建共享容器来存放数据</h3><ul><li>docker create –name my_volume -v /usr/test:/usr/local/tomcat/webapps/ tomcat</li><li>docker run -d -p  8000:8080 –volumes-from my_volume –name test tomcat</li></ul><h2 id="DockerCompose"><a href="#DockerCompose" class="headerlink" title="DockerCompose"></a>DockerCompose</h2><h3 id="Windows-和-mac-不需要安装-linux需要"><a href="#Windows-和-mac-不需要安装-linux需要" class="headerlink" title="Windows 和 mac 不需要安装 linux需要"></a>Windows 和 mac 不需要安装 linux需要</h3><ul><li>sudo curl -L “<a href="https://github.com/docker/compose/releases/download/1.25.5/docker-compose-$" target="_blank" rel="noopener">https://github.com/docker/compose/releases/download/1.25.5/docker-compose-$</a>(uname -s)-$(uname -m)” -o /usr/local/bin/docker-compose</li><li>sudo chmod +x /usr/local/bin/docker-compose</li></ul><h3 id="k8s-代替了"><a href="#k8s-代替了" class="headerlink" title="k8s 代替了"></a>k8s 代替了</h3>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IDEA远程调试</title>
      <link href="/2020/02/25/ideaDebug/"/>
      <url>/2020/02/25/ideaDebug/</url>
      
        <content type="html"><![CDATA[<h2 id="远程debug是什么"><a href="#远程debug是什么" class="headerlink" title="远程debug是什么 ?"></a>远程debug是什么 ?</h2><p>远程debug 原理是利用服务器端口监听来触发本地开发工具IDEA的一种调试手段 </p><h2 id="什么情况下会用到"><a href="#什么情况下会用到" class="headerlink" title="什么情况下会用到 ?"></a>什么情况下会用到 ?</h2><p>一般我们本地调试的话会直接在代码中打断点然后debug模式运行代码就可以调试了.</p><p>但是我们在实际开发中会遇到一些比较复杂的问题我举几个例子</p><ol><li><p>涉及到调用生产环境会出现的网络问题.</p></li><li><p>本地运行没问题,只有在测试服务器或者生产环境会出现报错</p></li><li><p>因为开发系统和服务器系统不一致导致的问题</p></li></ol><p>等等类似这样的问题我们在本地就没办法调试,这时候就需要用到远程服务器调试了.</p><h2 id="如何使用远程服务器调试"><a href="#如何使用远程服务器调试" class="headerlink" title="如何使用远程服务器调试"></a>如何使用远程服务器调试</h2><p>远程调试主要有以下几个步骤</p><ul><li><p>在调试之前我们需要你本地的代码和远程的代码要保持一致</p></li><li><p>部署上去之后需要加上特定的参数来启动 </p></li><li><p>服务器启动之后在启动本地环境</p></li></ul><p>保持一致就不需要我们详细说了,部署最新版的就可以了.</p><p>接下来我们来加上启动参数</p><p>原来启动jar包需要的命令<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar xxx.jar</span><br></pre></td></tr></table></figure></p><p>如果是远程debug 则需要加上一些参数<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=4001 xxx.jar</span><br></pre></td></tr></table></figure></p><p>这个参数在idea里可以直接获取到</p><p>接下来我们去找如何获取debug参数</p><blockquote><p>菜单 -&gt; Run -&gt; Edit Configurations…</p></blockquote><p><img src="/img/git1.png" alt="img"></p><blockquote><p>在debug Configurations的弹出框里添加一个remote</p></blockquote><p><img src="/img/git2.png" alt="img"></p><blockquote><p>之后会弹出一个如下图所示的界面 我们需要配置两个地方.图中的1是我们的服务器地址和端口,端口我们一般默认为4001.也可以自己配置.2是我们需要调试的项目.当这两个配置好后3的位置就会自动生成我们需要的启动参数</p></blockquote><p><img src="/img/a.png" alt="img"></p><blockquote><p>之后启动jar的时候添加上 服务器启动好后 在启动本地的remote</p></blockquote><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ul><li>当发现启动报错 首先检查下你的命令 不要直接复制我的 看你自己生成的代码</li><li>保证端口没被占用</li><li>本地启动remote会发送请求连接服务器 如果本机无法连接服务器也不行</li></ul>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> idea </tag>
            
            <tag> debug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>迭代器模式</title>
      <link href="/2020/02/11/Iterator/"/>
      <url>/2020/02/11/Iterator/</url>
      
        <content type="html"><![CDATA[<p>查看java代码</p><p>Iterator 和 Collection 模式</p><p>其原理就是利用了接口实现规则来约束每个array或者link结构来实现他的遍历方式</p>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>策略设计模式实际应用案例</title>
      <link href="/2020/01/18/strategy/"/>
      <url>/2020/01/18/strategy/</url>
      
        <content type="html"><![CDATA[<h1 id="设计模式中的策略模式"><a href="#设计模式中的策略模式" class="headerlink" title="设计模式中的策略模式"></a>设计模式中的策略模式</h1><p> 讲理论的话网上有很多现成的 以前也看了不少 这次特地在实际项目中抽取出来做成笔记</p><h2 id="先说说需求"><a href="#先说说需求" class="headerlink" title="先说说需求"></a>先说说需求</h2><p>根据不同的单据类型选出选出五个教授</p><p>其中单据类型有可转债和挂牌两大类 目前可转债和挂牌各有几种选择方式 下面案例我一样拿出一种来</p><p>之前的模式在有多种策略选择相似的情况下，使用 if…else 复杂和难以维护,代码阅读起来也比较困难</p><p>现在使用策略模式的步骤及简化结果 </p><h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><h3 id="步骤-1"><a href="#步骤-1" class="headerlink" title="步骤 1"></a>步骤 1</h3><p>创建一个接口。</p><p>ProfessorStrategy</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProfessorStrategy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;Professor&gt; <span class="title">five</span><span class="params">(Integer tableId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="步骤-2"><a href="#步骤-2" class="headerlink" title="步骤 2"></a>步骤 2</h3><p>创建实现接口的实体类。</p><p>EIMProfessorStrategy</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EIMProfessorStrategy</span> <span class="keyword">implements</span> <span class="title">ProfessorStrategy</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Professor&gt; <span class="title">five</span><span class="params">(Integer tableId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//省略了我的筛选策略</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>IPDProfessorStrategy</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IPDProfessorStrategy</span> <span class="keyword">implements</span> <span class="title">ProfessorStrategy</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Professor&gt; <span class="title">five</span><span class="params">(Integer tableId)</span> </span>&#123;</span><br><span class="line">     <span class="comment">//省略了我的筛选策略</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserStrategy</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserStrategy</span> <span class="keyword">implements</span> <span class="title">ProfessorStrategy</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Professor&gt; <span class="title">five</span><span class="params">(Integer tableId)</span> </span>&#123;</span><br><span class="line">     <span class="comment">//省略了我的筛选策略</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="步骤-3"><a href="#步骤-3" class="headerlink" title="步骤 3"></a>步骤 3</h3><p>创建具体的 <em>find</em> 方法, 你也可以创建一个有泛型的类来使用。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回接口数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> professorStrategy</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span>   List&lt;SysAttendsModel&gt; <span class="title">find</span><span class="params">(Integer tableId, ProfessorStrategy professorStrategy)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        获取对应的五个专家</span></span><br><span class="line">        List&lt;Professor&gt; five = professorStrategy.five(tableId);</span><br><span class="line"></span><br><span class="line">        List&lt;SysAttendsModel&gt; sysAttendsModels = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sysAttendsModels;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="步骤-4"><a href="#步骤-4" class="headerlink" title="步骤 4"></a>步骤 4</h3><p>使用 <em>find</em> 来查看当它改变策略 <em>Strategy</em> 时的行为变化。</p><p>main</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 单据id</span></span><br><span class="line">      <span class="keyword">int</span> tableId = <span class="number">10086</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 挂牌算法</span></span><br><span class="line">      List&lt;SysAttendsModel&gt; list = find(tableId, <span class="keyword">new</span> EIMProfessorStrategy());</span><br><span class="line">      <span class="comment">// 可转债算法</span></span><br><span class="line">  List&lt;SysAttendsModel&gt; list2 = find(tableId, <span class="keyword">new</span> IPDProfessorStrategy());</span><br><span class="line">      <span class="comment">// 会员算法</span></span><br><span class="line">  List&lt;SysAttendsModel&gt; list2 = find(tableId, <span class="keyword">new</span> UserStrategy());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="代码讲解"><a href="#代码讲解" class="headerlink" title="代码讲解"></a>代码讲解</h2><p>讲讲上面的代码 </p><p>大概就和支付策略是一个逻辑</p><p><strong>支付前都需要找出二维码</strong></p><p><strong>支付后都需要查看是否到账</strong></p><p>中间走具体的 现金 or 微信支付 or 支付宝支付 我们不关心</p><p>不管后面有多少个支付手段我们就加上相对应的接口的实体类就行了.</p>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>外部jar包打包方式</title>
      <link href="/2020/01/02/jarOpinize/"/>
      <url>/2020/01/02/jarOpinize/</url>
      
        <content type="html"><![CDATA[<ul><li><p>将原本 jar 包解压缩找到 BOOT-INF 下的 lib ,该目录下包含当前项目中用到的所有 jar包 ,复制出来放到jar包启动位置</p></li><li><p>在 pom 中 spring-boot-maven-plugin 打包插件设置打包时排除所有 jar 包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">        &lt;includes&gt;</span><br><span class="line">            &lt;include&gt;</span><br><span class="line">                &lt;!-- 排除所有Jar --&gt;</span><br><span class="line">                &lt;groupId&gt;nothing&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;nothing&lt;/artifactId&gt;</span><br><span class="line">            &lt;/include&gt;</span><br><span class="line">        &lt;/includes&gt;</span><br><span class="line">    &lt;/configuration&gt;</span><br><span class="line">&lt;/plugin&gt;</span><br></pre></td></tr></table></figure></li><li><p>这个时候需要在jar包启动参数上添加一个 -Dloader.path</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Dloader.path=&quot;lib/&quot; -jar test.jar</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>多线程与高并发(基础知识)</title>
      <link href="/2019/12/28/JUC02/"/>
      <url>/2019/12/28/JUC02/</url>
      
        <content type="html"><![CDATA[<h1 id="JUC"><a href="#JUC" class="headerlink" title="JUC"></a>JUC</h1><h2 id="基本知识"><a href="#基本知识" class="headerlink" title="基本知识"></a>基本知识</h2><h3 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h3><ul><li><p>继承thread</p><ul><li>.strat()</li></ul></li><li><p>实现runable接口</p><ul><li>new Thread(new MyRunable()).start()</li></ul></li><li><p>匿名函数实现</p><ul><li>new Thread(()-&gt;{<pre><code>System.out.println(&quot;Hello Lambda!&quot;);</code></pre>  }).start();</li></ul></li><li><p>启动线程的三种方式 1：Thread 2: Runnable 3:Executors.newCachedThrad</p></li></ul><h3 id="yield"><a href="#yield" class="headerlink" title="yield"></a>yield</h3><ul><li>让出资源进入等待队列</li></ul><h3 id="join"><a href="#join" class="headerlink" title="join"></a>join</h3><ul><li>调用其他线程</li></ul><h3 id="线程状态迁移图"><a href="#线程状态迁移图" class="headerlink" title="线程状态迁移图"></a>线程状态迁移图</h3><p><img src="/static/线程状态迁移图.png" alt="线程状态迁移图"></p><h3 id="wait-amp-notify"><a href="#wait-amp-notify" class="headerlink" title="wait &amp; notify"></a>wait &amp; notify</h3><ul><li>notify 不释放锁 ,需要手动将当前线程wait, 让出锁  notify才能生效</li><li>notifyAll 是让所有线程都醒过来去争抢锁  </li></ul><h3 id="wait-和-await"><a href="#wait-和-await" class="headerlink" title="wait 和 await"></a>wait 和 await</h3><ul><li>await//此时当前线程释放lock锁，进入[等待状态]，等待其他线程执行 signal()时才有可能执行</li><li>signal() //此时当前线程释放obj锁，随机唤醒一个处于等待状态的线程，继续执行wait后面的程序。</li><li><ul><li>使用wait要用notify/notifyAll唤醒</li></ul></li><li><ul><li>使用await要用signal/signalAll唤醒</li></ul></li></ul><h3 id="synchronized-悲观锁"><a href="#synchronized-悲观锁" class="headerlink" title="synchronized 悲观锁"></a>synchronized 悲观锁</h3><ul><li>在对象头中有一个64位的对象头 markword其中有一个2位的标识符 00 - 11 共四个状态来标志这个锁对象</li><li>还有一位来标识是否是偏向锁</li><li>this 和 锁住某个对象意义是一样的</li><li>锁方法和锁住整块代码意义也是一样的</li><li>synchronized static 锁住的是 XX.class</li><li>sychronized 是可重入锁 , 同一个锁可以相互调用,也就是说如果锁的是同一个对象那么可以相互调用</li><li>sychronized 如果抛出异常会释放锁,这样的话会导致其他线程拿到锁之后执行业务逻辑,所以需要做try处理</li><li>synchronized 锁的对象不能是String常量 ,Integer ,Long </li><li><p>synchronized(this) 的锁升级过程 </p><ol><li>无锁状态<br>当一个线程访问同步块并获取锁时，会在对象头和栈帧的锁记录里存储偏向的线程ID，<br>以后该线程在进入和退出同步块时不需要进行CAS操作来加锁和解锁，</li></ol><p>只需测试Mark Word里线程ID是否为当前线程。<br>因为没人和它竞争所以就没必要加锁</p><p>如果后来有线程进来对比发现线程ID和自己不一样 则发生竞争</p></li></ul><ol start="2"><li><p>偏向锁<br>如果判断发现ThreadID和自己不一样，则下一步需要判断偏向锁的标识。如果标识被设置为0（表示当前是无锁状态），则使用CAS(原子操作)竞争锁；</p><p>如果标识设置成1（表示当前是偏向锁状态），则尝试使用CAS将对象头的偏向锁指向当前线程，触发偏向锁的撤销。</p><p>偏向锁只有在竞争出现才会释放锁。当其他线程尝试竞争偏向锁时，程序到达全局安全点后（没有正在执行的代码），它会查看Java对象头中记录的线程是否存活，如果没有存活，那么锁对象被重置为无锁状态，</p><p>其它线程可以竞争将其设置为偏向锁；</p><p>如果存活，那么立刻查找该线程的栈帧信息，如果还是需要继续持有这个锁对象，那么暂停当前线程，撤销偏向锁，升级为轻量级锁，</p><p>如果线程1不再使用该锁对象，那么将锁对象状态设为无锁状态，重新偏向新的线程。</p><p>3.轻量级锁</p><p>线程在执行同步块之前，</p><p>JVM会先在当前线程的栈帧中创建用于存储锁记录的空间，并将对象头的MarkWord复制到锁记录中，即Displaced Mark Word。</p><p>然后线程会尝试使用CAS将对象头中的Mark Word替换为指向锁记录的指针。如果成功，当前线程获得锁。如果失败，表示其他线程在竞争锁，当前线程使用自旋来获取锁。</p><p>当自旋次数达到一定次数时，锁就会升级为重量级锁。</p><p>轻量级锁解锁时，会使用CAS操作将Displaced Mark Word替换回到对象头，如果成功，表示没有竞争发生。</p><p>如果失败，表示当前锁存在竞争，</p><p>锁已经被升级为重量级锁，则会释放锁并唤醒等待的线程。</p></li></ol><ol start="4"><li><p>当自旋超过10次之后 我们会进入os的等待队列 退出CPU的资源 然后向系统资源申请重量级锁</p><p>*注意：为了避免无用的自旋，轻量级锁一旦膨胀为重量级锁就不会再降级为轻量级锁了；偏向锁升级为轻量级锁也不能再降级为偏向锁。一句话就是锁可以升级不可以降级，但是偏向锁状态可以被重置为无锁状态。</p></li></ol><h3 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h3><ul><li><p>1.线程间可见</p><ul><li>缓存一致性协议</li></ul></li><li><p>2.禁止jvm重排序</p><ul><li>线程在分配内存的时候 分三步 1.申请内存,2赋值,3引用指向, 当执行步骤为132的时候  会出现还没有赋值但是对象不为空的问题</li><li><p>JMM模式</p><ul><li>jmm模型中有8个指令完成数据的读写, 其中 load store 指令相互组成的4个内存屏障实现指令重排序</li></ul></li></ul></li><li><p>注意: 和synchronized 不同的是  volatile可以保证可见性但并不能保证原子性, synchronized可以都保证.</p></li></ul><h3 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h3><ul><li>线程间各占一份 互不影响 </li><li>static ThreadLocal<person> tl = new ThreadLocal&lt;&gt;();</person></li><li>使用完成后必须remove调 不然会产生内存泄露</li></ul><h2 id="JUC同步锁"><a href="#JUC同步锁" class="headerlink" title="JUC同步锁"></a>JUC同步锁</h2><h3 id="CAS-Compare-And-Set-无锁优化-自旋锁-乐观锁"><a href="#CAS-Compare-And-Set-无锁优化-自旋锁-乐观锁" class="headerlink" title="CAS (Compare And Set ) 无锁优化| 自旋锁 | 乐观锁"></a>CAS (Compare And Set ) 无锁优化| 自旋锁 | 乐观锁</h3><ul><li>atomic包中的都是CAS操作</li><li>cas(V, Expected, NewValue) 有三个参数需要注意, v本次的对象, Expected 期望的值, NewValue 新的值 如果发现期望的值和现在的不一样那么就重新轮询一次获取新值</li><li><p>CAS自旋原理</p><ul><li>在解释一下<br>cas (操作对象， 期望值，更新值)</li></ul></li></ul><p>如果发现期望值不一样 则重新读取内存当中的值<br>if(当前值== 期望值){<br> 当前值 = 更新值<br>}else{<br> 重新获取值<br>}</p><ul><li>CPU源语支持 不存在指令重排序</li><li><p>ABA问题 </p><ul><li>解决方法就是加一个版本号 不停地增加 AtomicStampedReference</li></ul></li></ul><h3 id="increment-高并发递增值的方法"><a href="#increment-高并发递增值的方法" class="headerlink" title="increment 高并发递增值的方法"></a>increment 高并发递增值的方法</h3><ul><li>sync</li><li>atomicXXXX</li><li><p>LongAdder 高并发情况下效率最高</p><ul><li>采用跳表实现 分段锁</li></ul></li></ul><h3 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a>ReentrantLock</h3><ul><li>类似snychronized<br>可以使用 .lock()  nulock() 来锁代码 </li><li>trylock(time)<br>尝试去拿锁， 如果规定时间内拿不到锁则继续执行，拿到了就加锁执行</li><li><p>lockInterruptibly<br>在一个线程等待锁的过程中可以被打断<br>如果一个线程开启锁的方式是lockInterruptibly()那么这个线程可以调用.interrupt()被打断</p></li><li><p>new ReentrantLock(true)<br>如果设置成公平锁，新的线程在竞争锁的时候回去检查队列里面是否有线程在等待 如果有则进入队列进行排队取锁</p></li></ul><h3 id="CountDownLatch-门闩"><a href="#CountDownLatch-门闩" class="headerlink" title="CountDownLatch 门闩"></a>CountDownLatch 门闩</h3><ul><li><p>使用环境是在于并发转换文件 当转换完成后需要继续执行业务<br>Thread[] threads = new Thread[100];<br> CountDownLatch latch = new CountDownLatch(threads.length);</p><p> 当执行完成某个后需要调用latch.countDown();<br> 当全部执行完成后 latch.await()后继续之后的逻辑</p></li></ul><h3 id="CyclicBarrier-线程栅栏"><a href="#CyclicBarrier-线程栅栏" class="headerlink" title="CyclicBarrier 线程栅栏"></a>CyclicBarrier 线程栅栏</h3><ul><li>当任务达到一定数量后再执行并发操作</li><li>积攒一定数量的任务当数量达到阈值后开始执行任务</li></ul><h3 id="Phaser-feize"><a href="#Phaser-feize" class="headerlink" title="Phaser  (feize)"></a>Phaser  (feize)</h3><ul><li>升级版的CyclicBarrier , 可以控制执行阶段 就是一个业务分为十个阶段,每个阶段都需要并发执行,只有当上个阶段的都执行完才能执行下一个阶段,</li><li>arriveAndAwaitAdvance()</li><li>arriveAndDeregister()</li></ul><h3 id="ReadWriteLock"><a href="#ReadWriteLock" class="headerlink" title="ReadWriteLock"></a>ReadWriteLock</h3><ul><li>共享锁 | 排他锁 | 读写锁</li><li>写锁 是排他锁 , 读锁是共享锁. </li><li>类似读写分离吧, 读操作可以并发,写操作在后续执行<br>static ReadWriteLock readWriteLock = new ReentrantReadWriteLock();<br>  static Lock readLock = readWriteLock.readLock();<br>  static Lock writeLock = readWriteLock.writeLock();</li></ul><h3 id="Semaphoer"><a href="#Semaphoer" class="headerlink" title="Semaphoer"></a>Semaphoer</h3><ul><li>信号量 , 信号灯 0 - 1 </li><li>可以设置数量<br>Semaphore s = new Semaphore(2);</li><li>可以设置公平锁<br>Semaphore s = new Semaphore(2, true);</li><li>使用场景 限流 (车道-收费站)</li><li>semaphoer和lock的区别</li></ul><h3 id="Exchanger"><a href="#Exchanger" class="headerlink" title="Exchanger"></a>Exchanger</h3><ul><li>线程间通讯</li><li>s = exchanger.exchange(s);</li><li>当线程运行到这段代码后会阻塞等待交换</li></ul><h3 id="Locksupport"><a href="#Locksupport" class="headerlink" title="Locksupport"></a>Locksupport</h3><ul><li>part 停车 或者 停止</li><li>unpart 开始 或者 启动</li></ul><h2 id="AQS-AbstractQueuedSynchronized"><a href="#AQS-AbstractQueuedSynchronized" class="headerlink" title="AQS (AbstractQueuedSynchronized)"></a>AQS (AbstractQueuedSynchronized)</h2><h3 id="ReentrantLock-–-sync-–-AQS"><a href="#ReentrantLock-–-sync-–-AQS" class="headerlink" title="ReentrantLock – sync – AQS"></a>ReentrantLock – sync – AQS</h3><h3 id="维护了一个双向链表队列-所有人去抢-status这个状态值-它用volatile-修饰-后续会用CAS操作更改值"><a href="#维护了一个双向链表队列-所有人去抢-status这个状态值-它用volatile-修饰-后续会用CAS操作更改值" class="headerlink" title="维护了一个双向链表队列- 所有人去抢 status这个状态值 它用volatile 修饰 后续会用CAS操作更改值"></a>维护了一个双向链表队列- 所有人去抢 status这个状态值 它用volatile 修饰 后续会用CAS操作更改值</h3><h3 id="锁住链表最后一个节点然后用CAS来操作"><a href="#锁住链表最后一个节点然后用CAS来操作" class="headerlink" title="锁住链表最后一个节点然后用CAS来操作"></a>锁住链表最后一个节点然后用CAS来操作</h3><h3 id="公平锁和非公平锁的区别是会去尝试通过CAS来操作如果不成功则进入队列-成功抢到锁则运行"><a href="#公平锁和非公平锁的区别是会去尝试通过CAS来操作如果不成功则进入队列-成功抢到锁则运行" class="headerlink" title="公平锁和非公平锁的区别是会去尝试通过CAS来操作如果不成功则进入队列 成功抢到锁则运行"></a>公平锁和非公平锁的区别是会去尝试通过CAS来操作如果不成功则进入队列 成功抢到锁则运行</h3><h2 id="强软弱虚-引用"><a href="#强软弱虚-引用" class="headerlink" title="强软弱虚 引用"></a>强软弱虚 引用</h2><h3 id="强-new-Object"><a href="#强-new-Object" class="headerlink" title="强  new Object()"></a>强  new Object()</h3><h3 id="软-SoftReference"><a href="#软-SoftReference" class="headerlink" title="软 SoftReference"></a>软 SoftReference</h3><ul><li>软引用在系统内存不够用的时候会回收</li><li>主要用来做缓存</li></ul><h3 id="弱waekReference"><a href="#弱waekReference" class="headerlink" title="弱waekReference"></a>弱waekReference</h3><ul><li>只要遭遇GC,就会回收<br>只要进行一次GC,就会回收</li><li>TheadLocal 使用了弱引用中的entry<br>entry继承自弱引用 , 如果当前线程存在则不会回收,如果当前线程消失可能会存在内存泄露,但是使用弱引用泄露的概率就很小了</li></ul><h3 id="虚phantomReterence"><a href="#虚phantomReterence" class="headerlink" title="虚phantomReterence"></a>虚phantomReterence</h3><ul><li>当你的框架或者是项目需要使用对外内存可能会用到这个引用</li><li><p>一个对象是否有虚引用的存在，完全不会对其生存时间构成影响，<br>也无法通过虚引用来获取一个对象的实例。<br>为一个对象设置虚引用关联的唯一目的就是能在这个对象被收集器回收时收到一个系统通知。<br>虚引用和弱引用对关联对象的回收都不会产生影响，如果只有虚引用活着弱引用关联着对象，<br>那么这个对象就会被回收。它们的不同之处在于弱引用的get方法，虚引用的get方法始终返回null,<br>弱引用可以使用ReferenceQueue,虚引用必须配合ReferenceQueue使用。</p><p>jdk中直接内存的回收就用到虚引用，由于jvm自动内存管理的范围是堆内存，<br>而直接内存是在堆内存之外（其实是内存映射文件，自行去理解虚拟内存空间的相关概念），<br>所以直接内存的分配和回收都是有Unsafe类去操作，java在申请一块直接内存之后，<br>会在堆内存分配一个对象保存这个堆外内存的引用，<br>这个对象被垃圾收集器管理，一旦这个对象被回收，<br>相应的用户线程会收到通知并对直接内存进行清理工作。</p><p>事实上，虚引用有一个很重要的用途就是用来做堆外内存的释放，<br>DirectByteBuffer就是通过虚引用来实现堆外内存的释放的。</p></li></ul><h2 id="同步容器"><a href="#同步容器" class="headerlink" title="同步容器"></a>同步容器</h2><h3 id="Collections-单个数据进出"><a href="#Collections-单个数据进出" class="headerlink" title="Collections 单个数据进出"></a>Collections 单个数据进出</h3><ul><li><p>List</p><ul><li>完全没锁 线程不安全, 需要手动加锁来处理任务</li><li><p>CopyOnWrite  写-时-复制</p><ul><li>也就是说 在写的时候复制一份对象  如果一个业务写的业务较少 读取的业务较多的时候 可以考虑用这个， 其本质上来讲就是一个ReadWriteLock</li><li><p>CopyOnWriteList</p><ul><li>/**<ul><li>Appends the specified element to the end of this list.<br>*</li><li>@param e element to be appended to this list</li><li>@return {@code true} (as specified by {@link Collection#add})<br>*/<br>public boolean add(E e) {<br>final ReentrantLock lock = this.lock;<br>lock.lock();<br>try {<br>Object[] elements = getArray();<br>int len = elements.length;<br>//重点是这一句话<br>Object[] newElements = Arrays.copyOf(elements, len + 1);<br>newElements[len] = e;<br>setArray(newElements);<br>return true;<br>} finally {<br>lock.unlock();<br>}<br>}</li></ul></li></ul></li><li><p>CopyOnWriteSet</p><ul><li>/**<ul><li>A version of addIfAbsent using the strong hint that given</li><li>recent snapshot does not contain e.<br>*/<br>private boolean addIfAbsent(E e, Object[] snapshot) {<br>final ReentrantLock lock = this.lock;<br>lock.lock();<br>try {<br>Object[] current = getArray();<br>int len = current.length;<br>if (snapshot != current) {<br>// Optimize for lost race to another addXXX operation<br>int common = Math.min(snapshot.length, len);<br>for (int i = 0; i &lt; common; i++)<pre><code>if (current[i] != snapshot[i] &amp;&amp; eq(e, current[i]))    return false;</code></pre>if (indexOf(e, current, common, len) &gt;= 0)<pre><code>return false;</code></pre>}<br>Object[] newElements = Arrays.copyOf(current, len + 1);<br>newElements[len] = e;<br>setArray(newElements);<br>return true;<br>} finally {<br>lock.unlock();<br>}<br>}</li></ul></li></ul></li></ul></li><li><p>ArrayList</p><ul><li>未考虑多线程安全（未实现同步）</li></ul></li></ul></li><li><p>Set</p></li><li><p>vector</p><ul><li>Vector 线程安全 大部分关键方法都加了锁<br>但是可能出现锁与锁之间的共享问题 还是会出现线程不安全<br>就是两个方法虽然都加了锁但是 调用过程中会出现问题</li></ul></li></ul><ul><li><p>Queue 面对高并发准备</p><ul><li>(*高并发,多线程) 内部使用的是CAS来操作数据</li><li><p>ConcurrentLinkedQueue</p><ul><li>和Queue 的区别<br>offer -&gt; add  会有返回值<br>peek -&gt; get<br>poll -&gt; get remove</li></ul></li></ul></li></ul><pre><code>- ArrayBlockingQueue    - 数组阻塞队列  </code></pre><p>strs.offer(“aaa”, 1, TimeUnit.SECONDS);当内容满了之后就会等待阻塞 如果后面加上时间参数则会等待规定的时间后返回false 继续执行</p><pre><code>- LinkedBlockQueue    - 链表实现的阻塞队列 </code></pre><p>在ConcurrentLinkedQueue基础上添加了方法<br>    put 如果满了就等待<br>    take 如果空了就等待<br>    底层实现是利用了part 和unpart  类似之前面试题用到的 wait notify</p><pre><code>- DelayQueue    -     按照等待时间排序  也是阻塞队列的一种 BlockingQueue按照时间进行任务调度可以用这个本质上是PriorityQueue- SychronusQueue 同步    - 本质上和exchange线程差不多 线程size为0  所以不能add 不能往里面装东西 会阻塞等待消费者进行消费 puttake- TransferQueue    - 需要得到一个线程完成的标记或者是结果 可以用这个</code></pre><h3 id="Map-键值对K-V"><a href="#Map-键值对K-V" class="headerlink" title="Map 键值对K-V"></a>Map 键值对K-V</h3><ul><li><p>HashMap</p><ul><li><p>HashTable</p><ul><li>刚开始设计的时候只有这个,所有方法都加了锁的 线程是安全的 但是性能不是很高</li></ul></li><li><p>HashMap</p><ul><li>后来意识到之后就把锁都给取消了 , 所有方法都没有加锁  线程不安全  但是性能较高</li></ul></li><li><p>SynchronizedHashTable</p><ul><li>后来觉得锁的粒度放细一点,只在具体调用函数的代码块来锁 其实和HashTable本质上并没什么区别.</li></ul></li><li><p>ConcurrentHashMap  无序集合 高并发使用 </p><ul><li>采用了跳表的形式虽然写的时候不如 HashTable高 但是读起来性能高很多</li></ul></li><li><p>ConcurrentSkipListMap</p><ul><li>有序集合线程安全高并发使用  跳表实现原理 读取效率高</li></ul></li><li><p>LinkedHashMap</p><ul><li>里面维护了一个 LinkedKeySet</li><li>非线程安全 </li></ul></li></ul></li><li><p>TreeMap</p></li><li>WeakHashMap</li><li>identityHashMap</li></ul><h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><h3 id="背过"><a href="#背过" class="headerlink" title="背过"></a>背过</h3><ul><li><p>面试题：写一个固定容量同步容器，拥有put和get方法，以及getCount方法，</p><ul><li><p>能够支持2个生产者线程以及10个消费者线程的阻塞调用</p><ul><li>注意点:  1.wait 和await的区别  2. lock 和unlock  要全部包住代码 </li></ul></li></ul></li><li><p>put get</p></li></ul><h3 id="并发和并行"><a href="#并发和并行" class="headerlink" title="并发和并行"></a>并发和并行</h3><ul><li>Concurrent VS Parallel</li></ul><p>并发指的是任务同时到达某个接口</p><p>并行指的是多个CPU同时去处理某个事情</p><p>并行是并发的子集</p><h2 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h2><h3 id="ExecutorServices-gt-Executor-线程池"><a href="#ExecutorServices-gt-Executor-线程池" class="headerlink" title="ExecutorServices -&gt;  Executor   线程池"></a>ExecutorServices -&gt;  Executor   线程池</h3><ul><li><p>里面拥有很多操作线程的方法 </p><ul><li>awaitTermination</li><li>invokeAll</li><li>invokeAny</li><li>isShutdown</li><li>isTerminated</li><li>shutdown</li><li>shutdownNow</li><li>submit</li></ul></li><li><p>ExecutorServeices.submit 之后是异步执行的 不影响主线程</p></li></ul><h3 id="基本知识-1"><a href="#基本知识-1" class="headerlink" title="基本知识"></a>基本知识</h3><ul><li>Callable(String)  一个有返回值的线程</li><li><p>Future</p><ul><li>Future<string> submit = executorService.submit(() -&gt; {<pre><code>return &quot;&quot;;</code></pre>  });<br>submit.get();</string></li><li>线程池提交一个线程之后会返回这个线程的future 我们可以get它的返回值 提交是异步 get是阻塞的</li></ul></li><li><p>FutureTask</p><ul><li>用来存放Callable的返回值 –public FutureTask(Callable<v> callable)</v></li><li>如果想拿到的话 直接调用 FutureTask.get() 这个方法是阻塞的<br>相当于直接拿到这个线程的返回值 不需要生成线程池</li></ul></li><li><p>CompletableFuture</p><ul><li>组合各个线程的返回结果然后统一返回一个结果 </li></ul></li></ul><h3 id="两种线程池的自定义方式"><a href="#两种线程池的自定义方式" class="headerlink" title="两种线程池的自定义方式"></a>两种线程池的自定义方式</h3><ul><li><p>ThreadPoolExecutor</p><ul><li>ThreadPoolExecutor -&gt; AbstractExecutorService -&gt; ExecutorService -&gt;  Executor</li><li><p>ThreadPoolExecutor tpe = new ThreadPoolExecutor(2, 4,</p><pre><code>60, TimeUnit.SECONDS,new ArrayBlockingQueue&lt;Runnable&gt;(4),Executors.defaultThreadFactory(),new ThreadPoolExecutor.CallerRunsPolicy());</code></pre></li><li><ol><li>corePoolSize 核心线程</li></ol></li><li><ol start="2"><li>maxPoolSize 可扩展的最大线程</li></ol></li><li><ol start="3"><li>keepAliveTime  如果一个线程空闲时间超过设定值则讲线程紫苑交给操作系统 核心线程永远活着 不过有个方法可以设置核心线程参不参与归还资源</li></ol></li><li><ol start="4"><li>TimeUnit 时间单位</li></ol></li><li><ol start="5"><li>queue  BolckingQueue线程队列<br>当核心线程满了之后 后续任务进入的等待队列</li></ol></li><li><ol start="6"><li>threadFactory DefaultThreadFactory 线程池的工厂类<br>实现 ThreadFactory 接口  里面有一个newThread 自己去实现具体的线程<br>public Thread newThread(Runnable r) {<br>Thread t = new Thread(group, r,<pre><code>namePrefix + threadNumber.getAndIncrement(),0);</code></pre>if (t.isDaemon())<br>//设置线程守护<br>t.setDaemon(false);<br>if (t.getPriority() != Thread.NORM_PRIORITY)<br>//设置优先级<br>t.setPriority(Thread.NORM_PRIORITY);<br>return t;<br>}</li></ol></li><li><ol start="7"><li>rejectedExecutionHandler 拒绝策略 </li></ol></li></ul></li></ul><p>线程池满了 并且 任务队列也满了 然后启动的非核心线程数也满了  会执行拒绝策略</p><pre><code>- JDK默认提供了四种拒绝策略 - Abort  抛异常- Discard 扔掉,不抛异常- DiscardOldest 扔掉排队时间最久的- CallerRuns 调用处理任务 哪个线程调用的哪个去处理 非异步处理- 我们也可以去自定义自己的拒绝策略</code></pre><p>实现 implements RejectedExecutionHandler接口<br>完成rejectedExecution方法</p><pre><code>- </code></pre><p>自定义拒绝策略</p><p>static class MyHandler implements RejectedExecutionHandler {</p><pre><code>@Overridepublic void rejectedExecution(Runnable r, ThreadPoolExecutor executor) {    //log(&quot;r rejected&quot;)    //save r kafka mysql redis    //try 3 times    if(executor.getQueue().size() &lt; 10000) {        //try put again();    }}</code></pre><p>}</p><ul><li><p>ForkJoinPool</p><ul><li>ForkJoinPool -&gt; AbstractExecutorService -&gt; ExecutorService -&gt;  Executor</li><li>主要用来处理CPU密集型的任务 </li><li>每个线程有自己的任务队列</li><li>把大任务切分成一个一个的小任务来执行<br>然后再汇总结果</li><li>newWorkStealingPool<br>new ForkJoinPool<br>(Runtime.getRuntime().availableProcessors(),<br>ForkJoinPool.defaultForkJoinWorkerThreadFactory,<br>null, true);</li></ul></li></ul><h3 id="JDK默认的线程池的实现"><a href="#JDK默认的线程池的实现" class="headerlink" title="JDK默认的线程池的实现"></a>JDK默认的线程池的实现</h3><ul><li>Executors -线程池的工厂</li><li><ol><li><p>SingleThreadExecutor</p><ul><li>单例的线程池 里面只有一个线程<br>new FinalizableDelegatedExecutorService<br>(new ThreadPoolExecutor(1, 1,<pre><code>0L, TimeUnit.MILLISECONDS,new LinkedBlockingQueue&lt;Runnable&gt;()));</code></pre></li></ul></li></ol></li><li><ol start="2"><li><p>newCachedThreadPool</p><ul><li>里面拥有核心线程池为0, 可以扩展最大的为int最大值<br>new ThreadPoolExecutor(0, Integer.MAX_VALUE,<pre><code>60L, TimeUnit.SECONDS,new SynchronousQueue&lt;Runnable&gt;());</code></pre></li></ul></li></ol></li><li><ol start="3"><li><p>newFixedThreadPool</p><ul><li>核心线程和扩展线程都是固定的值 可以通过计算 一般是CPU的核心线程数+1<br>new ThreadPoolExecutor(nThreads, nThreads,<pre><code>0L, TimeUnit.MILLISECONDS,new LinkedBlockingQueue&lt;Runnable&gt;());</code></pre></li></ul></li></ol></li></ul><ul><li><ol start="4"><li><p>newScheduledThreadPool</p><ul><li>定时任务线程池<br>可以用框架代替<br>Quartz cron </li></ul></li></ol></li></ul><p>super(corePoolSize, Integer.MAX_VALUE, 0, NANOSECONDS,<br>      new DelayedWorkQueue());</p><ul><li>以上四个线程池底层都是ThreadPoolExecutor来实现的</li></ul><h2 id="Disruptor"><a href="#Disruptor" class="headerlink" title="Disruptor"></a>Disruptor</h2><h3 id="维护一个环形数组队列-首尾相连"><a href="#维护一个环形数组队列-首尾相连" class="headerlink" title="维护一个环形数组队列 首尾相连"></a>维护一个环形数组队列 首尾相连</h3><h3 id="目前性能最高的MQ"><a href="#目前性能最高的MQ" class="headerlink" title="目前性能最高的MQ"></a>目前性能最高的MQ</h3>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
          <category> java </category>
          
          <category> linux </category>
          
          <category> db </category>
          
          <category> 工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>linux语法操作</title>
      <link href="/2019/12/28/shell/"/>
      <url>/2019/12/28/shell/</url>
      
        <content type="html"><![CDATA[<h1 id="gt-File"><a href="#gt-File" class="headerlink" title="&gt;File"></a>&gt;File</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ls       </span><br><span class="line">ll     </span><br><span class="line">ls -l  </span><br><span class="line">ll -rt</span><br></pre></td></tr></table></figure><h1 id="gt-shell-base"><a href="#gt-shell-base" class="headerlink" title="&gt;shell base"></a>&gt;shell base</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Ctrl+w:删除光标前面的单词的字符</span><br><span class="line">Ctrl – a ：移到行首</span><br><span class="line">Ctrl – e ：移到行尾</span><br><span class="line">esc - f  : 前移一个词</span><br><span class="line">esc - b:  后移一个词</span><br></pre></td></tr></table></figure><p>创建文件用touch<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">例如：touch [1.txt]</span><br></pre></td></tr></table></figure></p><p>删除文件用rm<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">例如：rm -f [1.txt]</span><br></pre></td></tr></table></figure></p><p>创建目录用mkdir<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">例如：mkdir [xxx]     &#123; -p 参数来创建多级文件夹 &#125;</span><br></pre></td></tr></table></figure></p><p>删除空目录用rmdir<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">例如：rmdir [xxx]（有东西的目录不能删）</span><br></pre></td></tr></table></figure></p><p>打开文件    </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi  vim open cat more less</span><br></pre></td></tr></table></figure><p>批量创建    </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p nginxdb/&#123;conf,conf.d,html,logs&#125;</span><br></pre></td></tr></table></figure><h1 id="gt-删除"><a href="#gt-删除" class="headerlink" title="&gt;删除"></a>&gt;删除</h1><p>删除装有东西的目录就用</p><figure class="highlight plain"><figcaption><span>-rfi 例如rm -rfi [XXX]</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i是为了提醒 最好加上</span><br></pre></td></tr></table></figure><h1 id="gt-查看"><a href="#gt-查看" class="headerlink" title="&gt;查看"></a>&gt;查看</h1><p>文件末尾<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Tail -20 [filename]</span><br><span class="line"># &gt;经常查看日志需要用到这个</span><br><span class="line">tail -f xxx.log -n100</span><br></pre></td></tr></table></figure></p><p>重新命名<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mv [old.text] [new.text]</span><br></pre></td></tr></table></figure></p><h1 id="gt-杀死进程"><a href="#gt-杀死进程" class="headerlink" title="&gt;杀死进程"></a>&gt;杀死进程</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Kill [pid]</span><br></pre></td></tr></table></figure><p>pkill和阿里源码里学的<br>直接删除程序对应的进程<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkill -f zwkj-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></table></figure></p><h1 id="gt-权限赋予"><a href="#gt-权限赋予" class="headerlink" title="&gt;权限赋予"></a>&gt;权限赋予</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Chmod -R 777 [目录]</span><br><span class="line">建议了解下 linux权限的 0124 组成 这样就知道777怎么来的</span><br><span class="line">chown apple/staff xxx</span><br></pre></td></tr></table></figure><h1 id="gt-解压"><a href="#gt-解压" class="headerlink" title="&gt;解压"></a>&gt;解压</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">zip all.zip *.jpg</span><br><span class="line"></span><br><span class="line">unzip all.zip</span><br></pre></td></tr></table></figure><h1 id="gt-Grep-管道查询"><a href="#gt-Grep-管道查询" class="headerlink" title="&gt;Grep 管道查询"></a>&gt;Grep 管道查询</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-A num：匹配到搜索到的行以及该行下面的num行</span><br><span class="line">  </span><br><span class="line">-B num：匹配到搜索到的行以及该行上面的num行</span><br><span class="line"></span><br><span class="line">-C num：匹配到搜索到的行以及上下各num行</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">grep -E -B 1  &apos;use time:&apos; /data/home/zhxt/zhxt-test/logs/test.log</span><br><span class="line"></span><br><span class="line">ls | grep &apos;.docx&apos;</span><br><span class="line"></span><br><span class="line">ls | grep a*   (a 开头的)</span><br><span class="line"></span><br><span class="line">ls | grep &apos;a*&apos;  (包含a的)</span><br><span class="line"></span><br><span class="line">https://www.cnblogs.com/kongzhongqijing/articles/4462793.html</span><br></pre></td></tr></table></figure><h1 id="gt-查看历史输入的命令"><a href="#gt-查看历史输入的命令" class="headerlink" title="&gt;查看历史输入的命令"></a>&gt;查看历史输入的命令</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat ~/.bash_history</span><br><span class="line"></span><br><span class="line">history | head -20</span><br></pre></td></tr></table></figure><h1 id="gt-查看执行文件的路径"><a href="#gt-查看执行文件的路径" class="headerlink" title="&gt;查看执行文件的路径"></a>&gt;查看执行文件的路径</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whereis mysql</span><br></pre></td></tr></table></figure><h1 id="gt-读取文件"><a href="#gt-读取文件" class="headerlink" title="&gt;读取文件"></a>&gt;读取文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cat [filename]</span><br></pre></td></tr></table></figure><h1 id="gt-查询文件"><a href="#gt-查询文件" class="headerlink" title="&gt;查询文件"></a>&gt;查询文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find [path_root] -name &apos;*.doc*&apos;</span><br><span class="line">find / -name [xxx] -d</span><br><span class="line">locate</span><br></pre></td></tr></table></figure><h1 id="gt-查看某个端口是否被占用"><a href="#gt-查看某个端口是否被占用" class="headerlink" title="&gt;查看某个端口是否被占用"></a>&gt;查看某个端口是否被占用</h1><p>习惯用lsof  不想用netstat<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">安装 </span><br><span class="line">yum install lsof -y</span><br><span class="line">lsof -i tcp:8080     (PS 必须用root权限)</span><br><span class="line"></span><br><span class="line">netstat -tunlp|grep [端口号]</span><br><span class="line">ps -axu|grep [java]  启动位置输出</span><br></pre></td></tr></table></figure></p><h1 id="gt-文件下载"><a href="#gt-文件下载" class="headerlink" title="&gt;文件下载"></a>&gt;文件下载</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.shu.edu.cn/apache/tomcat/tomcat-8/v8.5.34/bin/apache-tomcat-8.5.34.zip --no-check-certificate</span><br></pre></td></tr></table></figure><h1 id="gt-scp下载"><a href="#gt-scp下载" class="headerlink" title="&gt;scp下载"></a>&gt;scp下载</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp -P 2204 isinonet@106.37.74.50:/home/gzzx/excel/ProfessionReport18584791024.xlsx /Users/apple/Documents</span><br><span class="line">scp -P 2204 isinonet@106.37.74.50:/logs/test.log /Users/apple/Documents</span><br><span class="line">-r 文件夹   -p端口</span><br></pre></td></tr></table></figure><h1 id="gt-上传"><a href="#gt-上传" class="headerlink" title="&gt;上传"></a>&gt;上传</h1><p>服务器文件移动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp /Users/apple/Documents/zwsj-category-0.0.1-SNAPSHOT.jar root@192.168.0.118:/home/zwsjObj</span><br><span class="line">Scp -r</span><br></pre></td></tr></table></figure></p><h1 id="gt-其他"><a href="#gt-其他" class="headerlink" title="&gt;其他"></a>&gt;其他</h1><p>查看磁盘容量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">df -hl /xxx</span><br></pre></td></tr></table></figure></p><p>查看位置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">which java</span><br></pre></td></tr></table></figure></p><p>rpm包安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rpm -ivh **.rpm</span><br></pre></td></tr></table></figure></p><p>后台运行命令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Nohup 详细指南</span><br></pre></td></tr></table></figure></p><p>该命令用来列出目前与过去登录系统的用户相关信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Last</span><br></pre></td></tr></table></figure></p><p>Linux查看文件夹大小<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">du -sh</span><br></pre></td></tr></table></figure></p><p>查看当前文件夹大小<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">du -sh * | sort -n</span><br></pre></td></tr></table></figure></p><p>统计当前文件夹(目录)大小，并按文件大小排序<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">du -sk filename 查看指定文件大小</span><br></pre></td></tr></table></figure></p><p>遇到其他不会的命令实例可以按照这个命令来查看基础语法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tldr  mkdir</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>vimrc配置文件</title>
      <link href="/2019/12/18/vimrc/"/>
      <url>/2019/12/18/vimrc/</url>
      
        <content type="html"><![CDATA[<p>替换了本地的自带的vi </p><p>采用了 macvim</p><p>安装方法通过 brew </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install macvim</span><br></pre></td></tr></table></figure><p>安装过程需要xcode的支持 </p><p>下载时间比较长耐心等待下 可能会报错 具体解决原有看报错后的日志</p><p>之后需要修改.bash_profile</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alias vi=vim</span><br><span class="line">alias vim=mvim</span><br><span class="line">alias mvim=&apos;/usr/local/bin/mvim -v&apos;</span><br></pre></td></tr></table></figure><p>安装完成后 去配置vim的 .vimrc文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br></pre></td><td class="code"><pre><span class="line">&quot;=========================================================================</span><br><span class="line">&quot; DesCRiption: 适合自己使用的vimrc文件，for Linux/Windows, GUI/Console</span><br><span class="line">&quot;</span><br><span class="line">&quot; Last Change: 2019年08月02日 15时13分 </span><br><span class="line">&quot;</span><br><span class="line">&quot; Version: 1.80</span><br><span class="line">&quot;</span><br><span class="line">&quot;=========================================================================</span><br><span class="line"></span><br><span class="line">set nocompatible &quot; 关闭 vi 兼容模式</span><br><span class="line">syntax on &quot; 自动语法高亮</span><br><span class="line">set number &quot; 显示行号</span><br><span class="line">set cursorline &quot; 突出显示当前行</span><br><span class="line">set ruler &quot; 打开状态栏标尺</span><br><span class="line">set shiftwidth=4 &quot; 设定 &lt;&lt; 和 &gt;&gt; 命令移动时的宽度为 4</span><br><span class="line">set softtabstop=4 &quot; 使得按退格键时可以一次删掉 4 个空格</span><br><span class="line">set tabstop=4 &quot; 设定 tab 长度为 4</span><br><span class="line">set nobackup &quot; 覆盖文件时不备份</span><br><span class="line">set autochdir &quot; 自动切换当前目录为当前文件所在的目录</span><br><span class="line">filetype plugin indent on &quot; 开启插件</span><br><span class="line">set backupcopy=yes &quot; 设置备份时的行为为覆盖</span><br><span class="line">set ignorecase smartcase &quot; 搜索时忽略大小写，但在有一个或以上大写字母时仍保持对大小写敏感</span><br><span class="line">set nowrapscan &quot; 禁止在搜索到文件两端时重新搜索</span><br><span class="line">set incsearch &quot; 输入搜索内容时就显示搜索结果</span><br><span class="line">set hlsearch &quot; 搜索时高亮显示被找到的文本</span><br><span class="line">set noerrorbells &quot; 关闭错误信息响铃</span><br><span class="line">set novisualbell &quot; 关闭使用可视响铃代替呼叫</span><br><span class="line">set t_vb= &quot; 置空错误铃声的终端代码</span><br><span class="line">&quot; set showmatch &quot; 插入括号时，短暂地跳转到匹配的对应括号</span><br><span class="line">&quot; set matchtime=2 &quot; 短暂跳转到匹配括号的时间</span><br><span class="line">set magic &quot; 设置魔术</span><br><span class="line">set hidden &quot; 允许在有未保存的修改时切换缓冲区，此时的修改由 vim 负责保存</span><br><span class="line">set guioptions-=T &quot; 隐藏工具栏</span><br><span class="line">set guioptions-=m &quot; 隐藏菜单栏</span><br><span class="line">set smartindent &quot; 开启新行时使用智能自动缩进</span><br><span class="line">set backspace=indent,eol,start</span><br><span class="line">&quot; 不设定在插入状态无法用退格键和 Delete 键删除回车符</span><br><span class="line">set cmdheight=1 &quot; 设定命令行的行数为 1</span><br><span class="line">set laststatus=2 &quot; 显示状态栏 (默认值为 1, 无法显示状态栏)</span><br><span class="line">set statusline=\ %&lt;%F[%1*%M%*%n%R%H]%=\ %y\ %0(%&#123;&amp;fileformat&#125;\ %&#123;&amp;encoding&#125;\ %c:%l/%L%)\ </span><br><span class="line">&quot; 设置在状态行显示的信息</span><br><span class="line">set foldenable &quot; 开始折叠</span><br><span class="line">set foldmethod=syntax &quot; 设置语法折叠</span><br><span class="line">set foldcolumn=0 &quot; 设置折叠区域的宽度</span><br><span class="line">setlocal foldlevel=1 &quot; 设置折叠层数为</span><br><span class="line">&quot; set foldclose=all &quot; 设置为自动关闭折叠 </span><br><span class="line">&quot; nnoremap &lt;space&gt; @=((foldclosed(line(&apos;.&apos;)) &lt; 0) ? &apos;zc&apos; : &apos;zo&apos;)&lt;CR&gt;</span><br><span class="line">&quot; 用空格键来开关折叠</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot; return OS type, eg: windows, or linux, mac, et.st..</span><br><span class="line">function! MySys()</span><br><span class="line">if has(&quot;win16&quot;) || has(&quot;win32&quot;) || has(&quot;win64&quot;) || has(&quot;win95&quot;)</span><br><span class="line">return &quot;windows&quot;</span><br><span class="line">elseif has(&quot;unix&quot;)</span><br><span class="line">return &quot;linux&quot;</span><br><span class="line">endif</span><br><span class="line">endfunction</span><br><span class="line"></span><br><span class="line">&quot; 用户目录变量$VIMFILES</span><br><span class="line">if MySys() == &quot;windows&quot;</span><br><span class="line">let $VIMFILES = $VIM.&apos;/vimfiles&apos;</span><br><span class="line">elseif MySys() == &quot;linux&quot;</span><br><span class="line">let $VIMFILES = $HOME.&apos;/.vim&apos;</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">&quot; 设定doc文档目录</span><br><span class="line">let helptags=$VIMFILES.&apos;/doc&apos;</span><br><span class="line"></span><br><span class="line">&quot; 设置字体 以及中文支持</span><br><span class="line">if has(&quot;win32&quot;)</span><br><span class="line">set guifont=Inconsolata:h12:cANSI</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">&quot; 配置多语言环境</span><br><span class="line">if has(&quot;multi_byte&quot;)</span><br><span class="line">&quot; UTF-8 编码</span><br><span class="line">set encoding=utf-8</span><br><span class="line">set termencoding=utf-8</span><br><span class="line">set formatoptions+=mM</span><br><span class="line">set fencs=utf-8,gbk</span><br><span class="line"></span><br><span class="line">if v:lang =~? &apos;^\(zh\)\|\(ja\)\|\(ko\)&apos;</span><br><span class="line">set ambiwidth=double</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">if has(&quot;win32&quot;)</span><br><span class="line">source $VIMRUNTIME/delmenu.vim</span><br><span class="line">source $VIMRUNTIME/menu.vim</span><br><span class="line">language messages zh_CN.utf-8</span><br><span class="line">endif</span><br><span class="line">else</span><br><span class="line">echoerr &quot;Sorry, this version of (g)vim was not compiled with +multi_byte&quot;</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">&quot; Buffers操作快捷方式!</span><br><span class="line">nnoremap &lt;C-RETURN&gt; :bnext&lt;CR&gt;</span><br><span class="line">nnoremap &lt;C-S-RETURN&gt; :bprevious&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">&quot; Tab操作快捷方式!</span><br><span class="line">nnoremap &lt;C-TAB&gt; :tabnext&lt;CR&gt;</span><br><span class="line">nnoremap &lt;C-S-TAB&gt; :tabprev&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">&quot;关于tab的快捷键</span><br><span class="line">&quot; map tn :tabnext&lt;cr&gt;</span><br><span class="line">&quot; map tp :tabprevious&lt;cr&gt;</span><br><span class="line">&quot; map td :tabnew .&lt;cr&gt;</span><br><span class="line">&quot; map te :tabedit</span><br><span class="line">&quot; map tc :tabclose&lt;cr&gt;</span><br><span class="line"></span><br><span class="line">&quot;窗口分割时,进行切换的按键热键需要连接两次,比如从下方窗口移动</span><br><span class="line">&quot;光标到上方窗口,需要&lt;c-w&gt;&lt;c-w&gt;k,非常麻烦,现在重映射为&lt;c-k&gt;,切换的</span><br><span class="line">&quot;时候会变得非常方便.</span><br><span class="line">nnoremap &lt;C-h&gt; &lt;C-w&gt;h</span><br><span class="line">nnoremap &lt;C-j&gt; &lt;C-w&gt;j</span><br><span class="line">nnoremap &lt;C-k&gt; &lt;C-w&gt;k</span><br><span class="line">nnoremap &lt;C-l&gt; &lt;C-w&gt;l</span><br><span class="line"></span><br><span class="line">&quot;一些不错的映射转换语法（如果在一个文件中混合了不同语言时有用）</span><br><span class="line">nnoremap &lt;leader&gt;1 :set filetype=xhtml&lt;CR&gt;</span><br><span class="line">nnoremap &lt;leader&gt;2 :set filetype=css&lt;CR&gt;</span><br><span class="line">nnoremap &lt;leader&gt;3 :set filetype=javascript&lt;CR&gt;</span><br><span class="line">nnoremap &lt;leader&gt;4 :set filetype=php&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">&quot; set fileformats=unix,dos,mac</span><br><span class="line">&quot; nmap &lt;leader&gt;fd :se fileformat=dos&lt;CR&gt;</span><br><span class="line">&quot; nmap &lt;leader&gt;fu :se fileformat=unix&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">&quot; use Ctrl+[l|n|p|cc] to list|next|previous|jump to count the result</span><br><span class="line">&quot; map &lt;C-x&gt;l &lt;ESC&gt;:cl&lt;CR&gt;</span><br><span class="line">&quot; map &lt;C-x&gt;n &lt;ESC&gt;:cn&lt;CR&gt;</span><br><span class="line">&quot; map &lt;C-x&gt;p &lt;ESC&gt;:cp&lt;CR&gt;</span><br><span class="line">&quot; map &lt;C-x&gt;c &lt;ESC&gt;:cc&lt;CR&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot; 让 Tohtml 产生有 CSS 语法的 html</span><br><span class="line">&quot; syntax/2html.vim，可以用:runtime! syntax/2html.vim</span><br><span class="line">let html_use_css=1</span><br><span class="line"></span><br><span class="line">&quot; Python 文件的一般设置，比如不要 tab 等</span><br><span class="line">autocmd FileType python set tabstop=4 shiftwidth=4 expandtab</span><br><span class="line">autocmd FileType python map &lt;F12&gt; :!python %&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">&quot; 选中状态下 Ctrl+c 复制</span><br><span class="line">vmap &lt;C-c&gt; &quot;+y</span><br><span class="line"></span><br><span class="line">&quot; 打开javascript折叠</span><br><span class="line">let b:javascript_fold=1</span><br><span class="line">&quot; 打开javascript对dom、html和css的支持</span><br><span class="line">let javascript_enable_domhtmlcss=1</span><br><span class="line">&quot; 设置字典 ~/.vim/dict/文件的路径</span><br><span class="line">autocmd filetype javascript set dictionary=$VIMFILES/dict/javascript.dict</span><br><span class="line">autocmd filetype css set dictionary=$VIMFILES/dict/css.dict</span><br><span class="line">autocmd filetype php set dictionary=$VIMFILES/dict/php.dict</span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin - bufexplorer.vim Buffers切换</span><br><span class="line">&quot; \be 全屏方式查看全部打开的文件列表</span><br><span class="line">&quot; \bv 左右方式查看 \bs 上下方式查看</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin - taglist.vim 查看函数列表，需要ctags程序</span><br><span class="line">&quot; F4 打开隐藏taglist窗口</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">if MySys() == &quot;windows&quot; &quot; 设定windows系统中ctags程序的位置</span><br><span class="line">let Tlist_Ctags_Cmd = &apos;&quot;&apos;.$VIMRUNTIME.&apos;/ctags.exe&quot;&apos;</span><br><span class="line">elseif MySys() == &quot;linux&quot; &quot; 设定windows系统中ctags程序的位置</span><br><span class="line">let Tlist_Ctags_Cmd = &apos;/usr/bin/ctags&apos;</span><br><span class="line">endif</span><br><span class="line">nnoremap &lt;silent&gt;&lt;F4&gt; :TlistToggle&lt;CR&gt;</span><br><span class="line">let Tlist_Show_One_File = 1 &quot; 不同时显示多个文件的tag，只显示当前文件的</span><br><span class="line">let Tlist_Exit_OnlyWindow = 1 &quot; 如果taglist窗口是最后一个窗口，则退出vim</span><br><span class="line">let Tlist_Use_Right_Window = 1 &quot; 在右侧窗口中显示taglist窗口</span><br><span class="line">let Tlist_File_Fold_Auto_Close=1 &quot; 自动折叠当前非编辑文件的方法列表</span><br><span class="line">let Tlist_Auto_Open = 0</span><br><span class="line">let Tlist_Auto_Update = 1</span><br><span class="line">let Tlist_Hightlight_Tag_On_BufEnter = 1</span><br><span class="line">let Tlist_Enable_Fold_Column = 0</span><br><span class="line">let Tlist_Process_File_Always = 1</span><br><span class="line">let Tlist_Display_Prototype = 0</span><br><span class="line">let Tlist_Compact_Format = 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin - mark.vim 给各种tags标记不同的颜色，便于观看调式的插件。</span><br><span class="line">&quot; \m mark or unmark the word under (or before) the cursor</span><br><span class="line">&quot; \r manually input a regular expression. 用于搜索.</span><br><span class="line">&quot; \n clear this mark (i.e. the mark under the cursor), or clear all highlighted marks .</span><br><span class="line">&quot; \* 当前MarkWord的下一个 \# 当前MarkWord的上一个</span><br><span class="line">&quot; \/ 所有MarkWords的下一个 \? 所有MarkWords的上一个</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin - NERD_tree.vim 以树状方式浏览系统中的文件和目录</span><br><span class="line">&quot; :ERDtree 打开NERD_tree :NERDtreeClose 关闭NERD_tree</span><br><span class="line">&quot; o 打开关闭文件或者目录 t 在标签页中打开</span><br><span class="line">&quot; T 在后台标签页中打开 ! 执行此文件</span><br><span class="line">&quot; p 到上层目录 P 到根目录</span><br><span class="line">&quot; K 到第一个节点 J 到最后一个节点</span><br><span class="line">&quot; u 打开上层目录 m 显示文件系统菜单（添加、删除、移动操作）</span><br><span class="line">&quot; r 递归刷新当前目录 R 递归刷新当前根目录</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; F3 NERDTree 切换</span><br><span class="line">map &lt;F3&gt; :NERDTreeToggle&lt;CR&gt;</span><br><span class="line">imap &lt;F3&gt; &lt;ESC&gt;:NERDTreeToggle&lt;CR&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin - NERD_commenter.vim 注释代码用的，</span><br><span class="line">&quot; [count],cc 光标以下count行逐行添加注释(7,cc)</span><br><span class="line">&quot; [count],cu 光标以下count行逐行取消注释(7,cu)</span><br><span class="line">&quot; [count],cm 光标以下count行尝试添加块注释(7,cm)</span><br><span class="line">&quot; ,cA 在行尾插入 /* */,并且进入插入模式。 这个命令方便写注释。</span><br><span class="line">&quot; 注：count参数可选，无则默认为选中行或当前行</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">let NERDSpaceDelims=1 &quot; 让注释符与语句之间留一个空格</span><br><span class="line">let NERDCompactSexyComs=1 &quot; 多行注释时样子更好看</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin - DoxygenToolkit.vim 由注释生成文档，并且能够快速生成函数标准注释</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">let g:DoxygenToolkit_authorName=&quot;Asins - asinsimple AT gmail DOT com&quot;</span><br><span class="line">let g:DoxygenToolkit_briefTag_funcName=&quot;yes&quot;</span><br><span class="line">map &lt;leader&gt;da :DoxAuthor&lt;CR&gt;</span><br><span class="line">map &lt;leader&gt;df :Dox&lt;CR&gt;</span><br><span class="line">map &lt;leader&gt;db :DoxBlock&lt;CR&gt;</span><br><span class="line">map &lt;leader&gt;dc a /* */&lt;LEFT&gt;&lt;LEFT&gt;&lt;LEFT&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin – ZenCoding.vim 很酷的插件，HTML代码生成</span><br><span class="line">&quot; 插件最新版：http://github.com/mattn/zencoding-vim</span><br><span class="line">&quot; 常用命令可看：http://nootn.com/blog/Tool/23/</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin – checksyntax.vim JavaScript常见语法错误检查</span><br><span class="line">&quot; 默认快捷方式为 F5</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">let g:checksyntax_auto = 0 &quot; 不自动检查</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin - NeoComplCache.vim 自动补全插件</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">let g:AutoComplPop_NotEnableAtStartup = 1</span><br><span class="line">let g:NeoComplCache_EnableAtStartup = 1</span><br><span class="line">let g:NeoComplCache_SmartCase = 1</span><br><span class="line">let g:NeoComplCache_TagsAutoUpdate = 1</span><br><span class="line">let g:NeoComplCache_EnableInfo = 1</span><br><span class="line">let g:NeoComplCache_EnableCamelCaseCompletion = 1</span><br><span class="line">let g:NeoComplCache_MinSyntaxLength = 3</span><br><span class="line">let g:NeoComplCache_EnableSkipCompletion = 1</span><br><span class="line">let g:NeoComplCache_SkipInputTime = &apos;0.5&apos;</span><br><span class="line">let g:NeoComplCache_SnippetsDir = $VIMFILES.&apos;/snippets&apos;</span><br><span class="line">&quot; &lt;TAB&gt; completion.</span><br><span class="line">inoremap &lt;expr&gt;&lt;TAB&gt; pumvisible() ? &quot;\&lt;C-n&gt;&quot; : &quot;\&lt;TAB&gt;&quot;</span><br><span class="line">&quot; snippets expand key</span><br><span class="line">imap &lt;silent&gt; &lt;C-e&gt; &lt;Plug&gt;(neocomplcache_snippets_expand)</span><br><span class="line">smap &lt;silent&gt; &lt;C-e&gt; &lt;Plug&gt;(neocomplcache_snippets_expand)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin - matchit.vim 对%命令进行扩展使得能在嵌套标签和语句之间跳转</span><br><span class="line">&quot; % 正向匹配 g% 反向匹配</span><br><span class="line">&quot; [% 定位块首 ]% 定位块尾</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin - vcscommand.vim 对%命令进行扩展使得能在嵌套标签和语句之间跳转</span><br><span class="line">&quot; SVN/git管理工具</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot;-----------------------------------------------------------------</span><br><span class="line">&quot; plugin – a.vim</span><br><span class="line">&quot;----------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">&quot;让vimrc配置变更立即生效</span><br><span class="line">autocmd BufWritePost $MYVIMRC source $MYVIMRC-</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> vim </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>spring cloud alibaba</title>
      <link href="/2019/12/16/alibaba/"/>
      <url>/2019/12/16/alibaba/</url>
      
        <content type="html"><![CDATA[<p>spring cloud alibaba </p><p>nacos  远程配置 | 服务发现和注册<br>ribbon 负载均衡<br>sentinel 熔断监控<br>gateway  网关<br>skywalking 链路追踪<br>rockertMQ 异步通讯<br>seata  分布式事务管理<br>dubbo RPC框架 </p>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>责任链模式</title>
      <link href="/2019/12/08/cor/"/>
      <url>/2019/12/08/cor/</url>
      
        <content type="html"><![CDATA[<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Servlet_Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Request request = <span class="keyword">new</span> Request();</span><br><span class="line">        request.str = <span class="string">"开始 进入: &lt;&gt; 1 "</span>;</span><br><span class="line">        Response response = <span class="keyword">new</span> Response();</span><br><span class="line">        response.str = <span class="string">"结束 退出: "</span>;</span><br><span class="line"></span><br><span class="line">        FilterChain chain = <span class="keyword">new</span> FilterChain();</span><br><span class="line">        chain.add(<span class="keyword">new</span> HTMLFilter()).add(<span class="keyword">new</span> SensitiveFilter());</span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line">        System.out.println(request.str);</span><br><span class="line">        System.out.println(response.str);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(Request request, Response response, FilterChain chain)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span> </span>&#123;</span><br><span class="line">    String str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Response</span> </span>&#123;</span><br><span class="line">    String str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HTMLFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(Request request, Response response, FilterChain chain)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 进入的时候做的业务逻辑</span></span><br><span class="line">        request.str = request.str.replaceAll(<span class="string">"&lt;"</span>, <span class="string">"["</span>).replaceAll(<span class="string">"&gt;"</span>, <span class="string">"]"</span>) + <span class="string">"HTMLFilter()"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用下一个chain</span></span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 完成后做业务逻辑</span></span><br><span class="line">        response.str += <span class="string">"--HTMLFilter()"</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SensitiveFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(Request request, Response response, FilterChain chain)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 进入之前做的业务逻辑</span></span><br><span class="line">        System.out.println(<span class="string">"拦截器2"</span>);</span><br><span class="line">        request.str = request.str.replaceAll(<span class="string">"1"</span>, <span class="string">"2"</span>) + <span class="string">" SensitiveFilter()"</span>;</span><br><span class="line">        <span class="comment">// 去找下一个chain</span></span><br><span class="line">        chain.doFilter(request, response);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 之后的逻辑处理</span></span><br><span class="line">        response.str += <span class="string">"--SensitiveFilter()"</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FilterChain</span> </span>&#123;</span><br><span class="line">    List&lt;Filter&gt; filters = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterChain <span class="title">add</span><span class="params">(Filter f)</span> </span>&#123;</span><br><span class="line">        filters.add(f);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(Request request, Response response)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index == filters.size()) &#123;</span><br><span class="line">            <span class="comment">// 做了某些业务后需要返回</span></span><br><span class="line">            System.out.println(<span class="string">"做了某些业务后需要返回"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        Filter f = filters.get(index);</span><br><span class="line"></span><br><span class="line">        index ++;</span><br><span class="line"></span><br><span class="line">        f.doFilter(request, response, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>装饰者模式</title>
      <link href="/2019/12/01/decorator/"/>
      <url>/2019/12/01/decorator/</url>
      
        <content type="html"><![CDATA[<h1 id="decorator-装饰器"><a href="#decorator-装饰器" class="headerlink" title="decorator 装饰器"></a>decorator 装饰器</h1>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>idea 显示run dashboard</title>
      <link href="/2019/11/20/ideaRun/"/>
      <url>/2019/11/20/ideaRun/</url>
      
        <content type="html"><![CDATA[<p>在最上面的 help -&gt; edit custom VM  options </p><p>在打开的xml里面添加</p><p>-Dide.run.dashboard=true</p>]]></content>
      
      
      <categories>
          
          <category> idea </category>
          
      </categories>
      
      
        <tags>
            
            <tag> idea </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker基本语法</title>
      <link href="/2019/10/08/dockerShell/"/>
      <url>/2019/10/08/dockerShell/</url>
      
        <content type="html"><![CDATA[<p><img src="/static/image-20200512143758893.png" alt="image-20200512143758893"></p><p><img src="https://docs.docker.com/engine/images/architecture.svg" alt="docker"></p><ul><li><p>查看所有正在运行容器 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker ps</span></span><br></pre></td></tr></table></figure></li><li><p>查看所有容器 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> docker ps -a</span></span><br></pre></td></tr></table></figure></li><li><p>查看所有容器ID </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps -a -q</span><br></pre></td></tr></table></figure></li><li><p>启动容器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker start [NAME]</span><br></pre></td></tr></table></figure></li><li><p>stop停止所有容器 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop </span><br><span class="line">$(docker ps -a -q)</span><br></pre></td></tr></table></figure></li><li><p>remove删除所有容器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker rm $(docker ps -a -q)</span><br></pre></td></tr></table></figure></li><li><p>run创建一个新的服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it [NAME] /bin/bash</span><br></pre></td></tr></table></figure></li><li><p>Exec 进入一个已经存在的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it 217a29f3495a /bin/bash</span><br></pre></td></tr></table></figure></li><li><p>查看容器启动日志</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs [容器ID]</span><br></pre></td></tr></table></figure></li></ul><p>-删除容器镜像  image<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo docker rmi IMAGE [IMAGE...]</span><br><span class="line">sudo docker rmi centos:latest</span><br></pre></td></tr></table></figure></p><ul><li><p>强制删除 实例</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm -f</span><br></pre></td></tr></table></figure></li><li><p>启动一个实例Container </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span><br><span class="line">sudo docker run -t -i contos /bin/bash</span><br><span class="line">sudo docker run  -p 8080:8080 -d [name]</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>博客MD模板应用</title>
      <link href="/2019/10/08/singleton/"/>
      <url>/2019/10/08/singleton/</url>
      
        <content type="html"><![CDATA[<blockquote><h1 id="literal-asterisks-转义"><a href="#literal-asterisks-转义" class="headerlink" title="\*literal asterisks\* 转义"></a>\*literal asterisks\* 转义</h1></blockquote><p>*literal asterisks*</p><blockquote><h1 id="MD-语法-加粗-加粗"><a href="#MD-语法-加粗-加粗" class="headerlink" title="MD 语法 加粗 **加粗**"></a>MD 语法 加粗 **加粗**</h1></blockquote><p><strong>比较粗</strong></p><blockquote><h1 id="MD-语法-斜体-斜体"><a href="#MD-语法-斜体-斜体" class="headerlink" title="MD 语法 斜体 *斜体*"></a>MD 语法 斜体 *斜体*</h1></blockquote><p><em>本来就是斜的</em></p><blockquote><h1 id="MD-语法-列表-1-2-3"><a href="#MD-语法-列表-1-2-3" class="headerlink" title="MD 语法 列表 1. 2. 3."></a>MD 语法 列表 1. 2. 3.</h1></blockquote><ol><li>ni shuo ni shi shui ?</li><li>ni bushi shuo ni me ?</li><li>wo xi huan de shi ni !</li></ol><blockquote><h1 id="MD-语法-列表-XXX-XXX-XXX"><a href="#MD-语法-列表-XXX-XXX-XXX" class="headerlink" title="MD 语法 列表 -XXX -XXX -XXX"></a>MD 语法 列表 -XXX -XXX -XXX</h1></blockquote><ul><li>wo bu shi yi ge haoren</li><li>na ni shi shen me ?</li><li>wo shi dog</li></ul><blockquote><h1 id="MD-语法-分割线-代表一条分割线"><a href="#MD-语法-分割线-代表一条分割线" class="headerlink" title="MD 语法 分割线 *** 代表一条分割线"></a>MD 语法 分割线 *** 代表一条分割线</h1></blockquote><hr><hr><blockquote><h1 id="MD-语法-A-标签-A-标签显示的名称-链接地址"><a href="#MD-语法-A-标签-A-标签显示的名称-链接地址" class="headerlink" title="MD 语法 A 标签 [A 标签显示的名称](链接地址)"></a>MD 语法 A 标签 [A 标签显示的名称](链接地址)</h1></blockquote><p><a href="http://www.baidu.com" target="_blank" rel="noopener">baidu</a></p><blockquote><h1 id="MD-语法-图片-图片说明-图片地址"><a href="#MD-语法-图片-图片说明-图片地址" class="headerlink" title="MD 语法 图片 ![ 图片说明 ](图片地址)"></a>MD 语法 图片 ![ 图片说明 ](图片地址)</h1></blockquote><p><img src="/static/jvm.jpeg" alt="img"></p><blockquote><h1 id="MD-语法-编写代码-三个"><a href="#MD-语法-编写代码-三个" class="headerlink" title="MD 语法 编写代码 三个 `"></a>MD 语法 编写代码 三个 `</h1></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  <span class="title">print</span><span class="params">(<span class="string">'asd'</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">test</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure><blockquote><h1 id="MD-语法-表格"><a href="#MD-语法-表格" class="headerlink" title="MD 语法 表格"></a>MD 语法 表格</h1></blockquote><table><thead><tr><th style="text-align:center">id</th><th style="text-align:center">select_type</th><th style="text-align:center">table</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">“SIMPLE”</td><td style="text-align:center">“professor”</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">“SIMPLE”</td><td style="text-align:center">“professor”</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">“SIMPLE”</td><td style="text-align:center">“professor”</td></tr></tbody></table><blockquote><h1 id="MD-语法-标题-一个-号是一级标题-依此类推"><a href="#MD-语法-标题-一个-号是一级标题-依此类推" class="headerlink" title="MD 语法 标题 一个#号是一级标题 依此类推"></a>MD 语法 标题 一个#号是一级标题 依此类推</h1></blockquote><h1 id="一级标题"><a href="#一级标题" class="headerlink" title="一级标题"></a>一级标题</h1><h2 id="二级标题"><a href="#二级标题" class="headerlink" title="二级标题"></a>二级标题</h2><h3 id="三级标题"><a href="#三级标题" class="headerlink" title="三级标题"></a>三级标题</h3><h4 id="四级标题"><a href="#四级标题" class="headerlink" title="四级标题"></a>四级标题</h4><h5 id="五级标题"><a href="#五级标题" class="headerlink" title="五级标题"></a>五级标题</h5><h6 id="六级标题"><a href="#六级标题" class="headerlink" title="六级标题"></a>六级标题</h6>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
          <category> java </category>
          
          <category> linux </category>
          
          <category> db </category>
          
          <category> 工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>git 忽略已经提交和没提交的文件</title>
      <link href="/2019/10/08/gitignore/"/>
      <url>/2019/10/08/gitignore/</url>
      
        <content type="html"><![CDATA[<h1 id="没有提交的"><a href="#没有提交的" class="headerlink" title="没有提交的"></a>没有提交的</h1><p>其实一直都知道有这么个功能 但是一直都是手写没有记录 </p><p>可以先去看下github官方提供的gitignore  里面有各种语言的 gitignore</p><p><a href="https://github.com/github/gitignore" target="_blank" rel="noopener">https://github.com/github/gitignore</a></p><p>自己个性化的话 可以在上面的文件基础上修改</p><p>在Git工作区的根目录下创建一个特殊的 .gitignore</p><p>下面是我自己使用的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/target/**</span><br><span class="line">/target</span><br><span class="line">target</span><br><span class="line">!.mvn/wrapper/maven-wrapper.jar</span><br><span class="line"></span><br><span class="line">###STS###</span><br><span class="line">.apt_generated</span><br><span class="line">.classpath</span><br><span class="line">.factorypath</span><br><span class="line">.project</span><br><span class="line">.settings</span><br><span class="line">.springBeans</span><br><span class="line">.sts4-cache</span><br><span class="line"></span><br><span class="line">###IntelliJIDEA###</span><br><span class="line">.idea</span><br><span class="line">*.iws</span><br><span class="line">*.iml</span><br><span class="line">*.ipr</span><br><span class="line"></span><br><span class="line">###NetBeans###</span><br><span class="line">/nbproject/private/</span><br><span class="line">/build/</span><br><span class="line">/nbbuild/</span><br><span class="line">/dist/</span><br><span class="line">/nbdist/</span><br><span class="line">/.nb-gradle/</span><br><span class="line"></span><br><span class="line">#Compiledclassfile</span><br><span class="line">*.class</span><br><span class="line"></span><br><span class="line">#Logfile</span><br><span class="line">*.log</span><br><span class="line"></span><br><span class="line">#BlueJfiles</span><br><span class="line">*.ctxt</span><br><span class="line"></span><br><span class="line">#MobileToolsforJava(J2ME)</span><br><span class="line">.mtj.tmp/</span><br><span class="line"></span><br><span class="line">#PackageFiles#</span><br><span class="line">*.jar</span><br><span class="line">*.war</span><br><span class="line">*.nar</span><br><span class="line">*.ear</span><br><span class="line">*.zip</span><br><span class="line">*.tar.gz</span><br><span class="line">*.rar</span><br><span class="line"></span><br><span class="line"># virtual machine crash logs, see http://www.java.com/en/download/help/error_hotspot.xml</span><br><span class="line">hs_err_pid*</span><br><span class="line">.pdf</span><br><span class="line">.zip</span><br><span class="line">.doc</span><br></pre></td></tr></table></figure></p><p>下面是一些语法使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">• bin/: 忽略当前路径下的bin文件夹，该文件夹下的所有内容都会被忽略，不忽略 bin 文件</span><br><span class="line"></span><br><span class="line">• /bin: 忽略根目录下的bin文件</span><br><span class="line"></span><br><span class="line">• /*.c: 忽略 cat.c，不忽略 build/cat.c</span><br><span class="line"></span><br><span class="line">• debug/*.obj: 忽略 debug/io.obj，不忽略 debug/common/io.obj 和 tools/debug/io.obj</span><br><span class="line"></span><br><span class="line">• **/foo: 忽略/foo, a/foo, a/b/foo等</span><br><span class="line"></span><br><span class="line">• a/**/b: 忽略a/b, a/x/b, a/x/y/b等</span><br><span class="line"></span><br><span class="line">• !/bin/run.sh: 不忽略 bin 目录下的 run.sh 文件</span><br><span class="line"></span><br><span class="line">• *.log: 忽略所有 .log 文件</span><br><span class="line"></span><br><span class="line">• config.php: 忽略当前路径的 config.php 文件</span><br></pre></td></tr></table></figure></p><h1 id="已经提交但是本地在修改需要忽略的"><a href="#已经提交但是本地在修改需要忽略的" class="headerlink" title="已经提交但是本地在修改需要忽略的"></a>已经提交但是本地在修改需要忽略的</h1><p>值得注意的是中央仓库已经存在该文件后 需要取消追踪<br>对某个文件取消跟踪</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git rm --cached  readme1.txt # 删除readme1.txt的跟踪，并保留在本地。</span><br><span class="line"></span><br><span class="line">git add -A # 这里是将所有的改动提交到git</span><br><span class="line"></span><br><span class="line">git commit -m &apos;update local file&apos;</span><br></pre></td></tr></table></figure><p>然后git commit 即可。但是git status查看状态时还是会列出来</p>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>观察者模式</title>
      <link href="/2019/10/08/ObServer/"/>
      <url>/2019/10/08/ObServer/</url>
      
        <content type="html"><![CDATA[<p>简单说下 后续再改</p><p>首先这个模式很常见  类似的有 callback  function ,listener , hook 都是这样的, 也可以说是一个东西</p><p>窗口添加事件  </p><p>js 回调事件</p><p>等等类似的其实本质上都是ObServer模式</p><p>首先我们看下main函数运行的代码 </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Button b = <span class="keyword">new</span> Button();</span><br><span class="line">    b.addActionListener(<span class="keyword">new</span> MyActionListener());</span><br><span class="line">    b.addActionListener(<span class="keyword">new</span> MyActionListener2());</span><br><span class="line">    b.addActionListener((e)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">"ppp"</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    b.buttonPressed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因为你之前new Button() 所以我们会实现一个button类 </p><p>里面会有一个for循环来依次实现你之前添加的事件  </p><p>就是buttonPressed 里的 for循环</p><p>同时还有一个添加事件的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Button</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> List&lt;ActionListener&gt; actionListeners = <span class="keyword">new</span> ArrayList&lt;ActionListener&gt;();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buttonPressed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ActionEvent e = <span class="keyword">new</span> ActionEvent(System.currentTimeMillis(),<span class="keyword">this</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;actionListeners.size(); i++) &#123;</span><br><span class="line">ActionListener l = actionListeners.get(i);</span><br><span class="line">l.actionPerformed(e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addActionListener</span><span class="params">(ActionListener l)</span> </span>&#123;</span><br><span class="line">actionListeners.add(l);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来我们需要写 事件类的接口  参数是你具体的事件本身</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>添加事件类接口的实现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyActionListener</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"button pressed!"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyActionListener2</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"button pressed 2!"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后是刚刚传的参数你也需要定义  这里我们定义的是 事件本身需要的属性</p><p>这里有两个  你可以根据自己的业务需求来判断</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ActionEvent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> when;</span><br><span class="line">Object source;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ActionEvent</span><span class="params">(<span class="keyword">long</span> when, Object source)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.when = when;</span><br><span class="line"><span class="keyword">this</span>.source = source;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getWhen</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> when;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> source;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一般会和责任链模式配合使用 在返回false后执行失败监听函数</p>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>享元模式</title>
      <link href="/2019/10/08/flyweight/"/>
      <url>/2019/10/08/flyweight/</url>
      
        <content type="html"><![CDATA[<p>重点是重复利用对象 </p><p>类似安卓 的 List组件 RecyclerView</p><p>创建一个对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bullet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> UUID id = UUID.randomUUID();</span><br><span class="line">    <span class="keyword">boolean</span> living = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Bullet&#123;"</span> +</span><br><span class="line">                <span class="string">"id="</span> + id +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>维持一个池子里的key </p><p>for循环查看key的标签是否可以重复利用 </p><p>如果可以则返回</p><p>不可以说明都在用 这个时候需要new出来了</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BulletPool</span> </span>&#123;</span><br><span class="line">    List&lt;Bullet&gt; bullets = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) bullets.add(<span class="keyword">new</span> Bullet());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Bullet <span class="title">getBullet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bullets.size(); i++) &#123;</span><br><span class="line">            Bullet b = bullets.get(i);</span><br><span class="line">            <span class="keyword">if</span> (!b.living) <span class="keyword">return</span> b;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Bullet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>main函数实际使用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       BulletPool bp = <span class="keyword">new</span> BulletPool();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">           Bullet b = bp.getBullet();</span><br><span class="line">           System.out.println(b);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>build 复杂对象构造器</title>
      <link href="/2019/08/18/build/"/>
      <url>/2019/08/18/build/</url>
      
        <content type="html"><![CDATA[<p>Build 模式一般是用来对复杂对象的构造器</p><p>一般我们可以对一个复杂对象这样new </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SysMessage</span><span class="params">(String phone, String comm, LocalDateTime sendTime, Integer status, Integer templateId, String tableId, String name, String role)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.phone = phone;</span><br><span class="line">    <span class="keyword">this</span>.comm = comm;</span><br><span class="line">    <span class="keyword">this</span>.sendTime = sendTime;</span><br><span class="line">    <span class="keyword">this</span>.status = status;</span><br><span class="line">    <span class="keyword">this</span>.templateId = templateId;</span><br><span class="line">    <span class="keyword">this</span>.tableId = tableId;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.role = role;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用的时候是这样的</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> SysMessage(getTel(), comm, LocalDateTime.now()</span><br><span class="line">                                    , getDeleted(), <span class="number">1006</span>,</span><br><span class="line">                                    <span class="string">"10086"</span>, getName(), <span class="string">"专家"</span>)</span><br></pre></td></tr></table></figure><p>上面这个例子是一个短信模板对象的生成 </p><p>这样写也可以  如果不想要其中某个我们可以传空 </p><p>但是这么写在&lt;<effective java>&gt;中是不推荐这么写的 </effective></p><p>书中写到如果你要构建复杂对象的话 最好使用build模式来做</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SysMessageBuild</span></span>&#123;</span><br><span class="line">        SysMessage sysMessage = <span class="keyword">new</span> SysMessage();</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> SysMessageBuild <span class="title">basicInfo</span><span class="params">(String role,String name,String phone,String comm)</span> </span>&#123;</span><br><span class="line">            sysMessage.role = role;</span><br><span class="line">            sysMessage.name = name;</span><br><span class="line">            sysMessage.phone = phone;</span><br><span class="line">            sysMessage.comm = comm;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> SysMessageBuild <span class="title">sendTime</span><span class="params">(LocalDateTime sendTime)</span></span>&#123;</span><br><span class="line">            sysMessage.sendTime = sendTime;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> SysMessageBuild <span class="title">status</span><span class="params">(Integer status)</span></span>&#123;</span><br><span class="line">            sysMessage.status = status;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> SysMessageBuild <span class="title">templateId</span><span class="params">(Integer templateId)</span></span>&#123;</span><br><span class="line">            sysMessage.templateId = templateId;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> SysMessageBuild <span class="title">tableId</span><span class="params">(String tableId)</span></span>&#123;</span><br><span class="line">            sysMessage.tableId = tableId;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> SysMessage <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> sysMessage;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>最后用一个build方法返回 </p>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>博客MD模板应用</title>
      <link href="/2019/08/18/A1tamplate/"/>
      <url>/2019/08/18/A1tamplate/</url>
      
        <content type="html"><![CDATA[<blockquote><h1 id="literal-asterisks-转义"><a href="#literal-asterisks-转义" class="headerlink" title="\*literal asterisks\* 转义"></a>\*literal asterisks\* 转义</h1></blockquote><p>*literal asterisks*</p><blockquote><h1 id="MD-语法-加粗-加粗"><a href="#MD-语法-加粗-加粗" class="headerlink" title="MD 语法 加粗 **加粗**"></a>MD 语法 加粗 **加粗**</h1></blockquote><p><strong>比较粗</strong></p><blockquote><h1 id="MD-语法-斜体-斜体"><a href="#MD-语法-斜体-斜体" class="headerlink" title="MD 语法 斜体 *斜体*"></a>MD 语法 斜体 *斜体*</h1></blockquote><p><em>本来就是斜的</em></p><blockquote><h1 id="MD-语法-列表-1-2-3"><a href="#MD-语法-列表-1-2-3" class="headerlink" title="MD 语法 列表 1. 2. 3."></a>MD 语法 列表 1. 2. 3.</h1></blockquote><ol><li>ni shuo ni shi shui ?</li><li>ni bushi shuo ni me ?</li><li>wo xi huan de shi ni !</li></ol><blockquote><h1 id="MD-语法-列表-XXX-XXX-XXX"><a href="#MD-语法-列表-XXX-XXX-XXX" class="headerlink" title="MD 语法 列表 -XXX -XXX -XXX"></a>MD 语法 列表 -XXX -XXX -XXX</h1></blockquote><ul><li>wo bu shi yi ge haoren</li><li>na ni shi shen me ?</li><li>wo shi dog</li></ul><blockquote><h1 id="MD-语法-分割线-代表一条分割线"><a href="#MD-语法-分割线-代表一条分割线" class="headerlink" title="MD 语法 分割线 *** 代表一条分割线"></a>MD 语法 分割线 *** 代表一条分割线</h1></blockquote><hr><hr><blockquote><h1 id="MD-语法-A-标签-A-标签显示的名称-链接地址"><a href="#MD-语法-A-标签-A-标签显示的名称-链接地址" class="headerlink" title="MD 语法 A 标签 [A 标签显示的名称](链接地址)"></a>MD 语法 A 标签 [A 标签显示的名称](链接地址)</h1></blockquote><p><a href="http://www.baidu.com" target="_blank" rel="noopener">baidu</a></p><blockquote><h1 id="MD-语法-图片-图片说明-图片地址"><a href="#MD-语法-图片-图片说明-图片地址" class="headerlink" title="MD 语法 图片 ![ 图片说明 ](图片地址)"></a>MD 语法 图片 ![ 图片说明 ](图片地址)</h1></blockquote><p><img src="/static/jvm.jpeg" alt="img"></p><blockquote><h1 id="MD-语法-编写代码-三个"><a href="#MD-语法-编写代码-三个" class="headerlink" title="MD 语法 编写代码 三个 `"></a>MD 语法 编写代码 三个 `</h1></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  <span class="title">print</span><span class="params">(<span class="string">'asd'</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">test</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure><blockquote><h1 id="MD-语法-表格"><a href="#MD-语法-表格" class="headerlink" title="MD 语法 表格"></a>MD 语法 表格</h1></blockquote><table><thead><tr><th style="text-align:center">id</th><th style="text-align:center">select_type</th><th style="text-align:center">table</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">“SIMPLE”</td><td style="text-align:center">“professor”</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">“SIMPLE”</td><td style="text-align:center">“professor”</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">“SIMPLE”</td><td style="text-align:center">“professor”</td></tr></tbody></table><blockquote><h1 id="MD-语法-标题-一个-号是一级标题-依此类推"><a href="#MD-语法-标题-一个-号是一级标题-依此类推" class="headerlink" title="MD 语法 标题 一个#号是一级标题 依此类推"></a>MD 语法 标题 一个#号是一级标题 依此类推</h1></blockquote><h1 id="一级标题"><a href="#一级标题" class="headerlink" title="一级标题"></a>一级标题</h1><h2 id="二级标题"><a href="#二级标题" class="headerlink" title="二级标题"></a>二级标题</h2><h3 id="三级标题"><a href="#三级标题" class="headerlink" title="三级标题"></a>三级标题</h3><h4 id="四级标题"><a href="#四级标题" class="headerlink" title="四级标题"></a>四级标题</h4><h5 id="五级标题"><a href="#五级标题" class="headerlink" title="五级标题"></a>五级标题</h5><h6 id="六级标题"><a href="#六级标题" class="headerlink" title="六级标题"></a>六级标题</h6>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
          <category> java </category>
          
          <category> linux </category>
          
          <category> db </category>
          
          <category> 工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>多线程与高并发(基础知识)</title>
      <link href="/2019/08/18/juc/"/>
      <url>/2019/08/18/juc/</url>
      
        <content type="html"><![CDATA[<p><img src="/static/线程状态迁移图.png" alt="线程状态迁移图"></p>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
          <category> java </category>
          
          <category> linux </category>
          
          <category> db </category>
          
          <category> 工具 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>AOP之代理模式</title>
      <link href="/2019/08/18/Proxy/"/>
      <url>/2019/08/18/Proxy/</url>
      
        <content type="html"><![CDATA[<p>在我看来 代理模式 最常用 也最难理解</p><p>会得不难 , 难得不会, 在我看来现在理解了代理的运作模式也觉得没有以前想的那么复杂</p><p>代理模式说白了就是面向切面编程 AOP <strong>业务和实际切点代码分割</strong></p><p>那么重点就在于 如何使在最小修改业务代码的情况下 来完成切点的插入</p><p>首先实现一个业务接口 </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Movable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">move</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接口具体实现类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tank</span> <span class="keyword">implements</span> <span class="title">Movable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模拟坦克移动了一段儿时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Tank moving claclacla..."</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="keyword">new</span> Random().nextInt(<span class="number">10000</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个时候我们有一个新的需求需要在 这段业务前后加入某些逻辑 不管是日志还是权限</p><p>这个时候我们需要新建一个代理类 </p><p>实现 InvocationHandler 接口 然后实现具体的invoke方法</p><p>具体逻辑看下图</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimeProxy</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line">    Movable m;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TimeProxy</span><span class="params">(Movable m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.m = m;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"method start.."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"method stop.."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">//Arrays.stream(proxy.getClass().getMethods()).map(Method::getName).forEach(System.out::println);</span></span><br><span class="line"></span><br><span class="line">        before();</span><br><span class="line">        Object o = method.invoke(m, args);</span><br><span class="line">        after();</span><br><span class="line">        <span class="keyword">return</span> o;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最纠结的点可能是 这段代码 </p><p>method.invoke(m, args); </p><p>先放一边 我们看是怎么调用的</p><p>main函数调用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Tank tank = <span class="keyword">new</span> Tank();</span><br><span class="line"><span class="comment">//返回的是ASM生成的$Proxy0的方法  后续调用也是调用这个方法的move </span></span><br><span class="line">    Movable m = (Movable)Proxy.newProxyInstance(Tank.class.getClassLoader(),</span><br><span class="line">            <span class="keyword">new</span> Class[]&#123;Movable.class&#125;, <span class="comment">//tank.class.getInterfaces()</span></span><br><span class="line">            <span class="keyword">new</span> TimeProxy(tank)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    m.move();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们给Proxy 传了三个参数  分别是 </p><p>Tank.class.getClassLoader() </p><p>生成的代理对象$Proxy0 </p><p>我们传的是tank.class 实现的接口是movable </p><p>所以ASM生成的代理类对象$Proxy0 也会实现接口movable 同时也会实现里面的方法 move()</p><p>可以说 <strong>我们把 Movable 传进去告诉ASM 你们给我生成一个实现了Movable接口的类</strong> 让我来调用</p><p>new Class[]{Movable.class}</p><p>也可以写成</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tank.class.getInterfaces()</span><br></pre></td></tr></table></figure><p>reflection 通过二进制字节码分析类的属性和方法</p><p>就是拿到这个接口类的所有的属性和方法</p><p>不明白的话我举个例子 </p><p>就是 Tank这个类实现的接口是哪个接口类 你要告诉ASM</p><p>你也可以直接给我new出来 这个类 也可以通过 Tank拿到他的接口类</p><p>new TimeProxy(tank)</p><p>这个就是具体的实现类 </p><p>你具体要给这个接口的哪个实现类实现代理你要给ASM说</p><p>这三个参数涉及到 ASM newProxyInstance生成代理类对象的逻辑</p><p>可能会有点复杂在这里就不展开谈了</p>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>组合模式</title>
      <link href="/2019/08/12/compsite/"/>
      <url>/2019/08/12/compsite/</url>
      
        <content type="html"><![CDATA[<p>组合模式用来处理树状接口</p><p>处理树状结构本质上就是查看当前节点是否包含子节点</p><p>所以说只需要判断 <strong>当前节点下是否有子节点</strong> 然后循环遍历</p><p>做这个树状结构也只需要 一个节点抽象类  两个节点信息 (一个是下面有节点,一个是没节点的) </p><p>一个抽象类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">p</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>有两个类继承节点信息  区别就是一个类有子节点 一个没有</p><p>  没有子节点的如下图</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LeafNode</span> <span class="keyword">extends</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">    String content;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LeafNode</span><span class="params">(String content)</span> </span>&#123;<span class="keyword">this</span>.content = content;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">p</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>有子节点的如下如</p><p>有子节点 意味着需要维护一个list<node> </node></p><p>还需要一个add 方法来添加子节点</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BranchNode</span> <span class="keyword">extends</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">    List&lt;Node&gt; nodes = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BranchNode</span><span class="params">(String name)</span> </span>&#123;<span class="keyword">this</span>.name = name;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">p</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Node n)</span> </span>&#123;</span><br><span class="line">        nodes.add(n);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用的话就是</p><p>添加root节点</p><p>然后依次添加 大节点和小节点</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        BranchNode root = <span class="keyword">new</span> BranchNode(<span class="string">"root"</span>);</span><br><span class="line">        BranchNode chapter1 = <span class="keyword">new</span> BranchNode(<span class="string">"chapter1"</span>);</span><br><span class="line">        BranchNode chapter2 = <span class="keyword">new</span> BranchNode(<span class="string">"chapter2"</span>);</span><br><span class="line">        Node r1 = <span class="keyword">new</span> LeafNode(<span class="string">"r1"</span>);</span><br><span class="line">        Node c11 = <span class="keyword">new</span> LeafNode(<span class="string">"c11"</span>);</span><br><span class="line">        Node c12 = <span class="keyword">new</span> LeafNode(<span class="string">"c12"</span>);</span><br><span class="line">        BranchNode b21 = <span class="keyword">new</span> BranchNode(<span class="string">"section21"</span>);</span><br><span class="line">        Node c211 = <span class="keyword">new</span> LeafNode(<span class="string">"c211"</span>);</span><br><span class="line">        Node c212 = <span class="keyword">new</span> LeafNode(<span class="string">"c212"</span>);</span><br><span class="line"></span><br><span class="line">        root.add(chapter1);</span><br><span class="line">        root.add(chapter2);</span><br><span class="line">        root.add(r1);</span><br><span class="line">        chapter1.add(c11);</span><br><span class="line">        chapter1.add(c12);</span><br><span class="line">        chapter2.add(b21);</span><br><span class="line">        b21.add(c211);</span><br><span class="line">        b21.add(c212);</span><br><span class="line">  </span><br><span class="line"><span class="comment">// 遍历</span></span><br><span class="line">        tree(root, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">tree</span><span class="params">(Node b, <span class="keyword">int</span> depth)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;depth; i++) System.out.print(<span class="string">"--"</span>);</span><br><span class="line">        b.p();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(b <span class="keyword">instanceof</span> BranchNode) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Node n : ((BranchNode)b).nodes) &#123;</span><br><span class="line">                tree(n, depth + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>基于SLF4J MDC机制配合AOP实现日志的链路追踪</title>
      <link href="/2019/05/31/slf4jMDC/"/>
      <url>/2019/05/31/slf4jMDC/</url>
      
        <content type="html"><![CDATA[<h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><p>一个合格的项目必须要有日志来支撑,日志不但能记录输入输出,当系统有问题的时候我们还需要做线上问题的排查.</p><p>在一个正常的项目中日志里包含了各种各样的接口及其他无关的数据日志,那么我们如何快速定位单次请求中所有的日志呢 ?</p><h1 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h1><p>当我们设计一个系统日志的时候</p><p>首先我们需要解决以下几个问题</p><ol><li><p>哪些数据需要写进日志中</p></li><li><p>日志如何分类 按天还是按周</p></li><li><p>如何区分每次请求</p></li><li><p>请求参数及返回值需不需要打印</p></li><li><p>如何进行多环节配置</p></li></ol><h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><p>按照上面的问题我们来一个一个解决</p><p>主要思路是</p><ol><li><p>AOP 负责切入每个请求及参数打印</p></li><li><p>在进入 controller 之前打印本次请求的各种参数</p></li><li><p>MDC 添加 hashCode 来做参数校验</p></li><li><p>日志使用 logback 配置</p></li><li><p>日志按天分类,每天生成一个日志</p></li><li><p>利用 thread 来区分每次请求</p></li><li><p>springProfile 来做多环境配置</p></li></ol><p>aop 有两种<br>CGLIB,JDK 都是动态代理 今天不讨论这两者的区别 我使用的是 CGLIB</p><p>pom 中引入 SpringBoot 的 web 模块和使用 AOP 相关的依赖：</p><p>定义切面类，实现 web 层的日志切面</p><p>对所有的 web 请求做切面来记录日志</p><h1 id="第一种-AOP-上-logback-的输出"><a href="#第一种-AOP-上-logback-的输出" class="headerlink" title="第一种 AOP 上 logback 的输出"></a>第一种 AOP 上 logback 的输出</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收到请求，记录请求内容</span></span><br><span class="line">     ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">     <span class="keyword">if</span> (attributes != <span class="keyword">null</span> &amp;&amp; joinPoint != <span class="keyword">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">         HttpServletRequest request = attributes.getRequest();</span><br><span class="line"></span><br><span class="line">         <span class="comment">// 记录请求内容</span></span><br><span class="line">         log.info( <span class="string">"1. 对象请求的URL : "</span> + request.getRequestURL().toString());</span><br><span class="line">         log.info( <span class="string">"2. 请求方法名称 : "</span> + request.getMethod());</span><br><span class="line">         log.info( <span class="string">"3. 对方IP地址 : "</span> + request.getRemoteAddr());</span><br><span class="line">         log.info( <span class="string">"4. 运行的java类 : "</span> + joinPoint.getSignature().getDeclaringTypeName() + <span class="string">"."</span> + joinPoint.getSignature().getName());</span><br><span class="line">         <span class="keyword">try</span>&#123;</span><br><span class="line">             log.info(<span class="string">"5. 请求参数 : "</span> + JSONObject.toJSONString(joinPoint.getArgs() ));</span><br><span class="line">         &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">             log.info(<span class="string">"请求参数切点无法切入"</span>);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">     &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> CheckException(<span class="string">"网络请求出错, 请清空缓存重新尝试. "</span>);</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure><h1 id="第二种-request-HashCode-唯一标示"><a href="#第二种-request-HashCode-唯一标示" class="headerlink" title="第二种 request.HashCode 唯一标示"></a>第二种 request.HashCode 唯一标示</h1><p>在获得</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">log.info(request.hashCode()+ <span class="string">"5. 请求参数 : "</span> + JSONObject.toJSONString(joinPoint.getArgs() ));</span><br></pre></td></tr></table></figure><h1 id="第三种-基于-SLF4J-的-MDC-机制"><a href="#第三种-基于-SLF4J-的-MDC-机制" class="headerlink" title="第三种 基于 SLF4J 的 MDC 机制"></a>第三种 基于 SLF4J 的 MDC 机制</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">MDC.put(<span class="string">"THREAD_ID"</span>, <span class="string">"userId"</span>+ userService.getId() );</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%date [%thread] %-5level %logger&#123;80&#125;  %X&#123;THREAD_ID&#125; || %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="第四种-结合-HashCode-和-MDC"><a href="#第四种-结合-HashCode-和-MDC" class="headerlink" title="第四种 结合 HashCode 和 MDC"></a>第四种 结合 HashCode 和 MDC</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">MDC.put(<span class="string">"THREAD_ID"</span>, <span class="string">""</span>+request.hashCode());</span><br></pre></td></tr></table></figure><h1 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">06</span>-<span class="number">04</span> <span class="number">10</span>:<span class="number">14</span>:<span class="number">27</span>,<span class="number">743</span> [main] INFO  com.zwkj.zhxt.ZhxtApplication || Started ZhxtApplication in <span class="number">48.489</span> seconds (JVM running <span class="keyword">for</span> <span class="number">56.375</span>)</span><br><span class="line"><span class="number">2019</span>-<span class="number">06</span>-<span class="number">04</span> <span class="number">10</span>:<span class="number">15</span>:<span class="number">28</span>,<span class="number">310</span> [qtp1387878879-<span class="number">21</span>] INFO  com.zwkj.zhxt.common.ControllerAOP || <span class="number">1</span>. 对象请求的URL : http:<span class="comment">//localhost:8088/zhxtotc/sys-user/login</span></span><br><span class="line"><span class="number">2019</span>-<span class="number">06</span>-<span class="number">04</span> <span class="number">10</span>:<span class="number">15</span>:<span class="number">28</span>,<span class="number">313</span> [qtp1387878879-<span class="number">21</span>] INFO  com.zwkj.zhxt.common.ControllerAOP || <span class="number">2</span>. 请求方法名称 : POST</span><br><span class="line"><span class="number">2019</span>-<span class="number">06</span>-<span class="number">04</span> <span class="number">10</span>:<span class="number">15</span>:<span class="number">28</span>,<span class="number">314</span> [qtp1387878879-<span class="number">21</span>] INFO  com.zwkj.zhxt.common.ControllerAOP || <span class="number">3</span>. 对方IP地址 : <span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">1</span></span><br><span class="line"><span class="number">2019</span>-<span class="number">06</span>-<span class="number">04</span> <span class="number">10</span>:<span class="number">15</span>:<span class="number">28</span>,<span class="number">323</span> [qtp1387878879-<span class="number">21</span>] INFO  com.zwkj.zhxt.common.ControllerAOP || <span class="number">4</span>. 运行的java类 : com.zwkj.zhxt.controller.SysUserController.findSysUser</span><br><span class="line"><span class="number">2019</span>-<span class="number">06</span>-<span class="number">04</span> <span class="number">10</span>:<span class="number">15</span>:<span class="number">28</span>,<span class="number">585</span> [qtp1387878879-<span class="number">21</span>] INFO  com.zwkj.zhxt.common.ControllerAOP || <span class="number">2825564545</span>. 请求参数 : [&#123;<span class="string">"code"</span>:<span class="string">"string"</span>,<span class="string">"password"</span>:<span class="string">"123456"</span>,<span class="string">"phone"</span>:<span class="string">"string"</span>,<span class="string">"username"</span>:<span class="string">"admin12"</span>&#125;]</span><br><span class="line"> Time：<span class="number">168</span> ms - ID：com.zwkj.zhxt.mvc.sysuser.mapper.SysUserMapper.selectOne</span><br><span class="line">Execute SQL：SELECT id,username,password,nickname,role_id,create_time,update_time,delete_status,user_id FROM sys_user WHERE username = <span class="string">'admin12'</span> AND password = <span class="string">'4QrcOUm6Wau+VuBX8g+IPg=='</span></span><br><span class="line"></span><br><span class="line"><span class="number">2019</span>-<span class="number">06</span>-<span class="number">04</span> <span class="number">10</span>:<span class="number">15</span>:<span class="number">30</span>,<span class="number">860</span> [qtp1387878879-<span class="number">21</span>] INFO  com.zwkj.zhxt.common.ControllerAOP || <span class="meta">@Around</span>:结果是 :ResultBean com.zwkj.zhxt.controller.SysUserController.findSysUser(UserModel) use time: <span class="number">2551</span></span><br><span class="line"><span class="number">2019</span>-<span class="number">06</span>-<span class="number">04</span> <span class="number">10</span>:<span class="number">15</span>:<span class="number">30</span>,<span class="number">861</span> [qtp1387878879-<span class="number">21</span>] INFO  com.zwkj.zhxt.common.ControllerAOP || <span class="number">282556454</span>: 方法的返回值 : ResultBean(msg=success, code=<span class="number">0</span>, data=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJub3ciOiIxNTU5NjE0NTMwMjE2emh4dCIsImtleSI6InVzZXIxMiJ9.ae7ra7hvDSp5N6YfuGYzr8ULeq7Zr5OuC_4PbybqceY)</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">06</span>-<span class="number">04</span> <span class="number">10</span>:<span class="number">15</span>:<span class="number">41</span>,<span class="number">401</span> [qtp1387878879-<span class="number">19</span>] INFO  com.zwkj.zhxt.common.ControllerAOP || <span class="number">1</span>. 对象请求的URL : http:<span class="comment">//localhost:8088/zhxtotc/sys-user/login</span></span><br><span class="line"><span class="number">2019</span>-<span class="number">06</span>-<span class="number">04</span> <span class="number">10</span>:<span class="number">15</span>:<span class="number">41</span>,<span class="number">401</span> [qtp1387878879-<span class="number">19</span>] INFO  com.zwkj.zhxt.common.ControllerAOP || <span class="number">2</span>. 请求方法名称 : POST</span><br><span class="line"><span class="number">2019</span>-<span class="number">06</span>-<span class="number">04</span> <span class="number">10</span>:<span class="number">15</span>:<span class="number">41</span>,<span class="number">402</span> [qtp1387878879-<span class="number">19</span>] INFO  com.zwkj.zhxt.common.ControllerAOP || <span class="number">3</span>. 对方IP地址 : <span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">0</span>:<span class="number">1</span></span><br><span class="line"><span class="number">2019</span>-<span class="number">06</span>-<span class="number">04</span> <span class="number">10</span>:<span class="number">15</span>:<span class="number">41</span>,<span class="number">402</span> [qtp1387878879-<span class="number">19</span>] INFO  com.zwkj.zhxt.common.ControllerAOP || <span class="number">4</span>. 运行的java类 : com.zwkj.zhxt.controller.SysUserController.findSysUser</span><br><span class="line"><span class="number">2019</span>-<span class="number">06</span>-<span class="number">04</span> <span class="number">10</span>:<span class="number">15</span>:<span class="number">41</span>,<span class="number">402</span> [qtp1387878879-<span class="number">19</span>] INFO  com.zwkj.zhxt.common.ControllerAOP || <span class="number">2825564545</span>. 请求参数 : [&#123;<span class="string">"code"</span>:<span class="string">"string"</span>,<span class="string">"password"</span>:<span class="string">"123456"</span>,<span class="string">"phone"</span>:<span class="string">"string"</span>,<span class="string">"username"</span>:<span class="string">"admin12"</span>&#125;]</span><br><span class="line"> Time：<span class="number">151</span> ms - ID：com.zwkj.zhxt.mvc.sysuser.mapper.SysUserMapper.selectOne</span><br><span class="line">Execute SQL：SELECT id,username,password,nickname,role_id,create_time,update_time,delete_status,user_id FROM sys_user WHERE username = <span class="string">'admin12'</span> AND password = <span class="string">'4QrcOUm6Wau+VuBX8g+IPg=='</span></span><br></pre></td></tr></table></figure><blockquote><h1 id="literal-asterisks-转义"><a href="#literal-asterisks-转义" class="headerlink" title="\*literal asterisks\* 转义"></a>\*literal asterisks\* 转义</h1></blockquote><p>*literal asterisks*</p><blockquote><h1 id="MD-语法-加粗-加粗"><a href="#MD-语法-加粗-加粗" class="headerlink" title="MD 语法 加粗 **加粗**"></a>MD 语法 加粗 **加粗**</h1></blockquote><p><strong>比较粗</strong></p><blockquote><h1 id="MD-语法-斜体-斜体"><a href="#MD-语法-斜体-斜体" class="headerlink" title="MD 语法 斜体 *斜体*"></a>MD 语法 斜体 *斜体*</h1></blockquote><p><em>本来就是斜的</em></p><blockquote><h1 id="MD-语法-列表-1-2-3"><a href="#MD-语法-列表-1-2-3" class="headerlink" title="MD 语法 列表 1. 2. 3."></a>MD 语法 列表 1. 2. 3.</h1></blockquote><ol><li>ni shuo ni shi shui ?</li><li>ni bushi shuo ni me ?</li><li>wo xi huan de shi ni !</li></ol><blockquote><h1 id="MD-语法-列表-XXX-XXX-XXX"><a href="#MD-语法-列表-XXX-XXX-XXX" class="headerlink" title="MD 语法 列表 -XXX -XXX -XXX"></a>MD 语法 列表 -XXX -XXX -XXX</h1></blockquote><ul><li>wo bu shi yi ge haoren</li><li>na ni shi shen me ?</li><li>wo shi dog</li></ul><blockquote><h1 id="MD-语法-分割线-代表一条分割线"><a href="#MD-语法-分割线-代表一条分割线" class="headerlink" title="MD 语法 分割线 *** 代表一条分割线"></a>MD 语法 分割线 *** 代表一条分割线</h1></blockquote><hr><hr><hr><blockquote><h1 id="MD-语法-A-标签-A-标签显示的名称-链接地址"><a href="#MD-语法-A-标签-A-标签显示的名称-链接地址" class="headerlink" title="MD 语法 A 标签 [A 标签显示的名称](链接地址)"></a>MD 语法 A 标签 [A 标签显示的名称](链接地址)</h1></blockquote><p><a href="http://www.baidu.com" target="_blank" rel="noopener">baidu</a></p><blockquote><h1 id="MD-语法-图片-图片说明-图片地址"><a href="#MD-语法-图片-图片说明-图片地址" class="headerlink" title="MD 语法 图片 ![ 图片说明 ](图片地址)"></a>MD 语法 图片 ![ 图片说明 ](图片地址)</h1></blockquote><p><img src="/img/banner.jpg" alt="img"></p><blockquote><h1 id="MD-语法-编写代码-三个"><a href="#MD-语法-编写代码-三个" class="headerlink" title="MD 语法 编写代码 三个 `"></a>MD 语法 编写代码 三个 `</h1></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  <span class="title">print</span><span class="params">(<span class="string">'asd'</span>)</span></span></span><br><span class="line"><span class="function"><span class="title">test</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure><blockquote><h1 id="MD-语法-表格"><a href="#MD-语法-表格" class="headerlink" title="MD 语法 表格"></a>MD 语法 表格</h1></blockquote><table><thead><tr><th style="text-align:center">id</th><th style="text-align:center">select_type</th><th style="text-align:center">table</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">“SIMPLE”</td><td style="text-align:center">“professor”</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">“SIMPLE”</td><td style="text-align:center">“professor”</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">“SIMPLE”</td><td style="text-align:center">“professor”</td></tr></tbody></table><blockquote><h1 id="MD-语法-标题-一个-号是一级标题-依此类推"><a href="#MD-语法-标题-一个-号是一级标题-依此类推" class="headerlink" title="MD 语法 标题 一个#号是一级标题 依此类推"></a>MD 语法 标题 一个#号是一级标题 依此类推</h1></blockquote><h1 id="一级标题"><a href="#一级标题" class="headerlink" title="一级标题"></a>一级标题</h1><h2 id="二级标题"><a href="#二级标题" class="headerlink" title="二级标题"></a>二级标题</h2><h3 id="三级标题"><a href="#三级标题" class="headerlink" title="三级标题"></a>三级标题</h3><h4 id="四级标题"><a href="#四级标题" class="headerlink" title="四级标题"></a>四级标题</h4><h5 id="五级标题"><a href="#五级标题" class="headerlink" title="五级标题"></a>五级标题</h5><h6 id="六级标题"><a href="#六级标题" class="headerlink" title="六级标题"></a>六级标题</h6>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>spring-boot-ioc 解析</title>
      <link href="/2019/05/22/springBootIOC/"/>
      <url>/2019/05/22/springBootIOC/</url>
      
        <content type="html"><![CDATA[<p>内容过期</p>]]></content>
      
      
      <categories>
          
          <category> springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ioc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记一次慢sql的查询记录</title>
      <link href="/2019/05/13/sqlOptimize/"/>
      <url>/2019/05/13/sqlOptimize/</url>
      
        <content type="html"><![CDATA[<p>本质上来讲 sql优化和数据库优化是两种优化</p><p>数据库优化包含的种类较多 软件优化,硬件优化</p><p>理论上 单个mysql数据库能够支撑的是每秒2000的并发 极限是5000</p><p>当然本次不说数据库优化 先说sql优化</p><p>sql优化一般是针对单个业务进行优化</p><p>比如秒杀 系统的订单查询 (一般用redis 这里只是举个例子)</p><p>或者说是对excel表格进行分析插入数据库</p><p>等等各种各样的业务</p><p>当然一个简单的sql 可能就是这样的 </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">from</span> <span class="keyword">test</span> <span class="keyword">WHERE</span> ASSIGNEE_ = <span class="string">'user1'</span></span><br></pre></td></tr></table></figure><p>但在实际业务环境中可能并不是这样</p><p>实际会复杂很多 以及很多条件</p><p>当我们在处理这样的sql的时候 应该怎么去优化以及从哪里入手</p><h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><p>我们大家都是知道索引可以很好的帮我们来提高效率</p><p>但是具体怎么用 以及针对某个业务或者单条sql怎么优化</p><p>再说这些之前我们先针对SQL进行一些常识性优化  比如</p><h2 id="基本优化"><a href="#基本优化" class="headerlink" title="基本优化"></a>基本优化</h2><p><strong>WHERE 子句里面的列尽量被索引</strong></p><p><strong>尽量避免使用 “SELECT *”</strong></p><p><strong>如果用到分页 尽量使用物理分页 并非逻辑分页</strong></p><p><strong>join列尽量使用索引</strong></p><p><strong>order by 使用索引</strong></p><p>等等  </p><p>总之是<strong>为了避免全表扫描做出的各种操作</strong></p><p>大家应该发现索引的使用还是非常频繁的</p><p>那么具体某个sql使用了哪些索引 以及进行了什么处理操作</p><h1 id="EXPLAIN-优化"><a href="#EXPLAIN-优化" class="headerlink" title="EXPLAIN 优化"></a>EXPLAIN 优化</h1><p>我们可以用  EXPLAIN 关键字去查看执行计划</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> professor a</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (</span><br><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> sys_attend b</span><br><span class="line"><span class="keyword">WHERE</span> a.id = b.professor_id</span><br><span class="line"><span class="keyword">AND</span> b.<span class="string">`type`</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">AND</span> b.table_id = <span class="number">93353728</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">AND</span> a.polling_status = <span class="number">1</span></span><br><span class="line"><span class="keyword">AND</span> a.status = <span class="number">1</span></span><br><span class="line"><span class="keyword">AND</span> (a.Member_category = <span class="number">1</span></span><br><span class="line"><span class="keyword">OR</span> a.Member_category = <span class="number">3</span>)</span><br><span class="line"><span class="keyword">AND</span> (organization_category <span class="keyword">IN</span> (<span class="number">4</span>, <span class="number">7</span>)</span><br><span class="line"><span class="keyword">OR</span> organization_categoryvice <span class="keyword">IN</span> (<span class="number">4</span>, <span class="number">7</span>))</span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">0</span>, <span class="number">2</span></span><br></pre></td></tr></table></figure><p>这张表里大概有这么几个字段</p><ol><li><p>id 执行顺序 可以重复</p><ul><li>id相同则从上往下执行</li><li>id从大到小执行</li></ul></li><li><p>select_type 搜索类型 一共有十一种 具体可以看这篇博客<a href="https://blog.csdn.net/y1193329479/article/details/78821126#27_DEPENDENT_SUBQUERY_134" target="_blank" rel="noopener">SQL_explain操作解释</a> 这里就简单的介绍常见的几种 </p><ul><li><p>第一种也是最常见到的一种 SIMPLE 简单的select查询,查询中不包含子查询或者union;</p></li><li><p>PRIMARY:查询中若包含任何复杂的子查询,最外层查询则被标记; 就是刚刚的优先级最外层则会显示PRIMARY</p></li><li><p>SUBQUERY:在select或者where列表中包含了子查询;</p></li></ul></li></ol><ol start="3"><li><p>type 显示的是访问类型，一般我们优化sql就是着重优化这个 , 是较为重要的一个指标，结果值从好到坏依次是：<br>system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL。 一般来说，得保证查询至少达到range级别，最好能达到ref。 那么怎么能达到这个级别呢 </p><ul><li><p>ref:非唯一性索引扫描,返回匹配某个单独值得所有行,本质上也是一种索引访问,它返回所有匹配某个单独值的行,然而,它可能会找到多个符合条件的行,所以它应该属于查找和扫描的混合体;</p></li><li><p>range:只检索给定范围的行,使用一个索引来选择行,key列显示使用哪个索引,一般就是在你的where语句中出现了between,&lt;,&gt;,in等的查询；这种范围索引扫描比全表扫描要好,因为它只需要开始于索引的某一个点,结束于另一个点,不用扫描全部索引; 之前说的避免全表扫描就是为了这样</p></li></ul></li></ol><ol start="4"><li><p>possible_keys:显示可能会被应用到这张表的索引,一个或者多个;查询涉及到的字段上若存在索引,则该索引将被列出,但不一定被查询实际使用到;</p></li><li><p>key:实际使用到的索引.如果为null,则没有使用索引;查询中若使用了覆盖索引,则该索引仅出现在key列表中;</p></li><li><p>key_len:表示索引中使用的字节数,可通过该列计算查询中使用的索引的长度,在不损失精确性的情况下,长度越短越好; key_len显示的值为索引字段的最大可能长度,并非实际使用长度,即key_len是根据表定义计算而得,不是通过表内检索出的;</p></li><li><p>ref:显示索引的哪一列被使用了,如果可能的话,是一个常数,哪些列或常量别用于查找索引列上的值;</p></li><li><p>rows:根据表统计信息及索引选用情况,大致估算出找到所需的记录所需要读取的行数;</p></li><li><p>Extra:包含不适合在其它列中显示但十分重要的额外信息:</p><ul><li>对于这个消息栏里展示的东西有很多 一般是你的sql违反的数据库相对应的算法,他认为你的不合理</li><li>在这里就不详细解释了 当大家出现后可以百度相对应的信息 <a href="https://blog.csdn.net/poxiaonie/article/details/77757471" target="_blank" rel="noopener">MySQL中explain执行计划中额外信息字段(Extra)详解</a></li></ul></li></ol><p>那么根据这些信息我们可以查到需要优化哪些地方</p><p>说完 explain 我们可以再说说 explain extended + show warnings </p><p>在执行explain extended  之后我们在 show warnings 可以看到在数据库中我们sql的执行方式, 我们可以在这个基础上再次进行优化</p><p>我们可以看到sql的执行方式，对于分析sql还是很有帮助的。</p><p>( 8 ) SELECT ( 9 ) DISTINCT ( 11 ) &lt; Top Num &gt; &lt; select list &gt; </p><p>( 1 ) FROM [ left_table ] </p><p>( 3 ) &lt; join_type &gt; JOIN &lt; right_table &gt; </p><p>( 2 ) ON &lt; join_condition &gt; </p><p>( 4 ) WHERE &lt; where_condition &gt; </p><p>( 5 ) GROUP BY &lt; group_by_list &gt; </p><p>( 6 ) WITH &lt; CUBE | RollUP &gt; </p><p>( 7 ) HAVING &lt; having_condition &gt; </p><p>( 10 ) ORDER BY &lt; order_by_list &gt;</p><p>从优先级我们可以看出为什么order by 排序在 group by 之前不生效了</p><p>之前那条sql之后后数据库warnings的执行方式是下面这样的<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">`zwkj_zhxt`</span>.<span class="string">`a`</span>.<span class="string">`id`</span> <span class="keyword">AS</span> <span class="string">`id`</span>,</span><br><span class="line">        <span class="string">`zwkj_zhxt`</span>.<span class="string">`a`</span>.<span class="string">`name`</span> <span class="keyword">AS</span> <span class="string">`name`</span>,</span><br><span class="line">        <span class="string">`zwkj_zhxt`</span>.<span class="string">`a`</span>.<span class="string">`sex`</span> <span class="keyword">AS</span> <span class="string">`sex`</span>,</span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`zwkj_zhxt`</span>.<span class="string">`professor`</span> <span class="string">`a`</span></span><br><span class="line"><span class="keyword">WHERE</span> ((<span class="string">`zwkj_zhxt`</span>.<span class="string">`a`</span>.<span class="string">`status`</span> = <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">AND</span> (<span class="string">`zwkj_zhxt`</span>.<span class="string">`a`</span>.<span class="string">`polling_status`</span> = <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">AND</span> (<span class="keyword">not</span>(<span class="keyword">exists</span>(<span class="comment">/* select#2 */</span><span class="keyword">SELECT</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`zwkj_zhxt`</span>.<span class="string">`sys_attend`</span> <span class="string">`b`</span></span><br><span class="line"><span class="keyword">WHERE</span> ((<span class="string">`zwkj_zhxt`</span>.<span class="string">`b`</span>.<span class="string">`table_id`</span> = <span class="number">93353728</span>)</span><br><span class="line">        <span class="keyword">AND</span> (<span class="string">`zwkj_zhxt`</span>.<span class="string">`b`</span>.<span class="string">`sex`</span> = <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">AND</span> (<span class="string">`zwkj_zhxt`</span>.<span class="string">`a`</span>.<span class="string">`id`</span> = <span class="string">`zwkj_zhxt`</span>.<span class="string">`b`</span>.<span class="string">`professor_id`</span>)))))</span><br><span class="line">        <span class="keyword">AND</span> ((<span class="string">`zwkj_zhxt`</span>.<span class="string">`a`</span>.<span class="string">`name`</span> = <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">OR</span> (<span class="string">`zwkj_zhxt`</span>.<span class="string">`a`</span>.<span class="string">`name`</span> = <span class="number">3</span>))</span><br><span class="line">        <span class="keyword">AND</span> ((<span class="string">`zwkj_zhxt`</span>.<span class="string">`a`</span>.<span class="string">`sex`</span> <span class="keyword">IN</span> (<span class="number">4</span>,<span class="number">7</span>))</span><br><span class="line">        <span class="keyword">OR</span> (<span class="string">`zwkj_zhxt`</span>.<span class="string">`a`</span>.<span class="string">`sex`</span> <span class="keyword">IN</span> (<span class="number">4</span>,<span class="number">7</span>)))) <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">2</span></span><br></pre></td></tr></table></figure></p><p>从上面还可以看出 and 的优先级 总是高于 or </p><p>但有一点需要注意的是 exteneded得到的sql并不是 最终优化执行的sql<br>这一点可以在官方文档中得到确认<a href="https://dev.mysql.com/doc/refman/8.0/en/explain-extended.html" target="_blank" rel="noopener">Extended EXPLAIN Output Format</a><br>但从优化的角度上来讲也能帮助我们.</p><p>一般企业数据库的优化 基本上是</p><p>配硬件+差不多的sql优化+分布式+分库分表+读写分离</p><p>等等 反正一系列的操作 基本满足80%的业务场景</p><p>当然我们优化个别业务需要根据实际场景来优化</p><p>如果确实说需要高级别的维护和优化 公司会有相对应的运维或者DB来做很少需要开发者担心</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
          <category> db </category>
          
      </categories>
      
      
        <tags>
            
            <tag> db </tag>
            
            <tag> sql </tag>
            
            <tag> 优化 </tag>
            
            <tag> 数据库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>launchctl自动化脚本</title>
      <link href="/2019/04/18/macLaunchctl/"/>
      <url>/2019/04/18/macLaunchctl/</url>
      
        <content type="html"><![CDATA[<p>启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">launchctl start con.hki.zhxtgit.plist</span><br></pre></td></tr></table></figure></p><p>查找<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">launchctl list | grep &apos;con&apos;</span><br></pre></td></tr></table></figure></p><p>加载<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">launchctl load -w con.hki.zhxtgit.plist</span><br></pre></td></tr></table></figure></p><p>卸载<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">launchctl unload con.hki.zhxtgit.plist</span><br></pre></td></tr></table></figure></p><p>校验语法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plutil -lint  com.hki.zhxtgit.plist</span><br></pre></td></tr></table></figure></p><p>plist文件<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">"1.0"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>Disabled<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">false</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>KeepAlive<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">false</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>Label<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>con.hki.zhxtgit.plist<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>ProgramArguments<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>/Documents/shell/zhxtgit.sh<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>RunAtLoad<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">false</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>StandardErrorPath<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>/Documents/shell/run.log<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>StandardOutPath<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>/Documents/shell/run.err<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>StartCalendarInterval<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>Hour<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">integer</span>&gt;</span>15<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>Minute<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">integer</span>&gt;</span>5<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 自动化脚本 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git stash 在多分支下的使用</title>
      <link href="/2019/03/08/git_stash/"/>
      <url>/2019/03/08/git_stash/</url>
      
        <content type="html"><![CDATA[<h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h1><p>stash命令叫暂存 平常开发很多情况都会遇到 开发一半的代码线上环境要紧急修复个bug这个时候我们可以把代码暂存起来</p><p>常用的有</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">gsta=<span class="string">'git stash save'</span></span><br><span class="line"></span><br><span class="line">gstaa=<span class="string">'git stash apply'</span></span><br><span class="line"></span><br><span class="line">gstc=<span class="string">'git stash clear'</span></span><br><span class="line"></span><br><span class="line">gstd=<span class="string">'git stash drop'</span></span><br><span class="line"></span><br><span class="line">gstl=<span class="string">'git stash list'</span></span><br><span class="line"></span><br><span class="line">gstp=<span class="string">'git stash pop'</span></span><br><span class="line"></span><br><span class="line">gsts=<span class="string">'git stash show --text'</span></span><br></pre></td></tr></table></figure><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>这一段时间频繁在各个分支上开发及修改bug导致用到的stash命令挺多的</p><p>最近出现一个挺让我纠结的问题就是 在各个分支下stash存放的栈是一样的所以在dev分支下和master分支下你保存的数据都是一个地方 </p><p>如果你在dev 下save了stash 然后切换master分支你仍然可以apply到你刚刚在dev下保存的代码</p><p>下面我们看具体代码</p><h1 id="2-出现原因"><a href="#2-出现原因" class="headerlink" title="2. 出现原因"></a>2. 出现原因</h1><p>现在我们文件下有两个文档 123 和 abc </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">master &gt; ll</span><br><span class="line">-rw-r--r--  1 apple  staff    21B  4 23 15:30 123.txt</span><br><span class="line">-rw-r--r--  1 apple  staff    66B 10 29 10:44 abc.txt</span><br></pre></td></tr></table></figure><p>现在我们删除一个</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">master &gt; rm -rf abc.txt</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r--  1 apple  staff    21B  4 23 15:30 123.txt</span><br></pre></td></tr></table></figure><p>不提交当前代码 stash保存起来</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">master &gt; git stash save <span class="string">"master save"</span></span><br><span class="line">Saved working directory and index state On master: master save</span><br></pre></td></tr></table></figure><p>切换到生产分支</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">master &gt; git checkout prod</span><br><span class="line">切换到分支 <span class="string">'prod'</span></span><br><span class="line">prod &gt; ll</span><br><span class="line">total 16</span><br><span class="line">-rw-r--r--  1 apple  staff    21B  4 23 15:30 123.txt</span><br><span class="line">-rw-r--r--  1 apple  staff   121B  4 23 16:11 abc.txt</span><br></pre></td></tr></table></figure><p>再次修改代码 并且stash保存</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> prod &gt; vi 123.txt</span><br><span class="line"> prod &gt; git stash save <span class="string">"prod save"</span></span><br><span class="line">Saved working directory and index state On prod: prod save</span><br></pre></td></tr></table></figure><p>切换分支查看stash list</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">master &gt; git checkout master</span><br><span class="line">切换到分支 <span class="string">'master'</span></span><br><span class="line">master &gt; git stash list</span><br><span class="line">stash@&#123;0&#125;: On prod: prod save</span><br><span class="line">stash@&#123;1&#125;: On master: master save</span><br></pre></td></tr></table></figure><p>这个时候显示出了两个保存栈 分别是我在master和prod上保存的代码</p><p>如果这个时候你直接git stash apply 会使用最近的一个 也就是你在prod下保存的代码而不是你master的代码</p><h1 id="3-优化使用"><a href="#3-优化使用" class="headerlink" title="3. 优化使用"></a>3. 优化使用</h1><p>Stash 有两种保存方式 一种是带消息保存和不带消息保存 上面我演示的是带消息所以能看出来我保存的是哪个分支</p><p>所以在使用satsh的时候最好带上当前保存的一个标记语 这样方便我们下次使用的时候拉取</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git stash save <span class="string">"markword"</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Quartz cron语法规则及demo</title>
      <link href="/2018/12/29/quartzCron/"/>
      <url>/2018/12/29/quartzCron/</url>
      
        <content type="html"><![CDATA[<p>测试在线地址</p><p><a href="http://cron.qqe2.com/" target="_blank" rel="noopener">http://cron.qqe2.com/</a> </p><p>下面是一些demo</p><p>每天凌晨2点  0 0 2 <em> </em> ?和每天隔一小时 0 <em> </em>/1 <em> </em> ?</p><p>例1：每隔5秒执行一次：<em>/5 </em> <em> </em> * ?</p><p>例2：每隔5分执行一次：0 <em>/5 </em> <em> </em> ?</p><p>在26分、29分、33分执行一次：0 26,29,33 <em> </em> * ?</p><p>例3：每天半夜12点30分执行一次：0 30 0 <em> </em> ? （注意日期域为0不是24）</p><p>每天凌晨1点执行一次：0 0 1 <em> </em> ?</p><p>每天上午10：15执行一次： 0 15 10 ? <em> </em> 或 0 15 10 <em> </em> ? 或 0 15 10 <em> </em> ? *</p><p>每天中午十二点执行一次：0 0 12 <em> </em> ?</p><p>每天14点到14：59分，每1分钟执行一次：0 <em> 14 </em> * ?</p><p>每天14点到14：05分，每1分钟执行一次：0 0-5 14 <em> </em> ?</p><p>每天14点到14：55分，每5分钟执行一次：0 0/5 14 <em> </em> ?</p><p>每天14点到14：55分，和18点到18点55分，每5分钟执行一次：0 0/5 14,18 <em> </em> ?</p><p>每天18点执行一次：0 0 18 <em> </em> ?</p><p>每天18点、22点执行一次：0 0 18,22 <em> </em> ?</p><p>每天7点到23点，每整点执行一次：0 0 7-23 <em> </em> ?</p><p>每个整点执行一次：0 0 0/1 <em> </em> ?</p><p>每天凌晨2点  0 0 2 <em> </em> ?和每天隔一小时 0 <em> </em>/1 <em> </em> ?</p><p>例1：每隔5秒执行一次：<em>/5 </em> <em> </em> * ?</p><p>例2：每隔5分执行一次：0 <em>/5 </em> <em> </em> ?</p><p>在26分、29分、33分执行一次：0 26,29,33 <em> </em> * ?</p><p>例3：每天半夜12点30分执行一次：0 30 0 <em> </em> ? （注意日期域为0不是24）</p><p>每天凌晨1点执行一次：0 0 1 <em> </em> ?</p><p>每天上午10：15执行一次： 0 15 10 ? <em> </em> 或 0 15 10 <em> </em> ? 或 0 15 10 <em> </em> ? *</p><p>每天中午十二点执行一次：0 0 12 <em> </em> ?</p><p>每天14点到14：59分，每1分钟执行一次：0 <em> 14 </em> * ?</p><p>每天14点到14：05分，每1分钟执行一次：0 0-5 14 <em> </em> ?</p><p>每天14点到14：55分，每5分钟执行一次：0 0/5 14 <em> </em> ?</p><p>每天14点到14：55分，和18点到18点55分，每5分钟执行一次：0 0/5 14,18 <em> </em> ?</p><p>每天18点执行一次：0 0 18 <em> </em> ?</p><p>每天18点、22点执行一次：0 0 18,22 <em> </em> ?</p><p>每天7点到23点，每整点执行一次：0 0 7-23 <em> </em> ?</p><p>每个整点执行一次：0 0 0/1 <em> </em> ?</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>异步的观察者模式处理后台任务</title>
      <link href="/2018/10/08/ApplicationEvent/"/>
      <url>/2018/10/08/ApplicationEvent/</url>
      
        <content type="html"><![CDATA[<p>收到任务说要做一个后台监听文件上传接口 </p><p>如果有docx文档 需要将任务放在后台进程中</p><p>将docx文档转换成pdf文档</p><p>首先文档转换不是我们今天要讲的内容 稍后我会开一章来讲</p><p>事件监听在spring boot里还是比较容易实现的 有以下几点需要注意</p><ul><li>vo实体需要继承 ApplicationEvent</li><li>实现接口ApplicationListener里的onApplicationEvent方法</li><li>使用applicationContext的publishEvent来发布事件</li><li>最后继承AsyncUncaughtExceptionHandler添加异步报错控制</li></ul><p>新建实体 因为我这里只用到 id 所以只需要传入id即可<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: ZHANG.HAO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordToPdfEvent</span> <span class="keyword">extends</span> <span class="title">ApplicationEvent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Integer id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WordToPdfEvent</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(id);</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>这里需要写你的后台监听到事件后要做的内容 我的是转换文档<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: ZHANG.HAO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">handleListener</span> <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">WordToPdfEvent</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(WordToPdfEvent wordToPdfEvent)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>异步发布事件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: ZHANG.HAO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">executorAsyncTask</span><span class="params">(List&lt;SysFile&gt; list)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">            list.forEach(SysFile -&gt; &#123;</span><br><span class="line">                applicationContext.publishEvent(<span class="keyword">new</span> WordToPdfEvent(SysFile.getId()));</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置后台异步exception<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后台异步exception</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: ZHANG.HAO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAsyncUncaughtExceptionHandler</span> <span class="keyword">implements</span> <span class="title">AsyncUncaughtExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ISysLogService sysLogService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleUncaughtException</span><span class="params">(Throwable ex, Method method, Object... params)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"handleUncaughtException "</span>);</span><br><span class="line"></span><br><span class="line">        StringJoiner sjr = <span class="keyword">new</span> StringJoiner(<span class="string">","</span>, <span class="string">"["</span>, <span class="string">"]"</span>);</span><br><span class="line">        sjr.add(<span class="string">"Exception Cause - "</span> + ex.getMessage()) ;</span><br><span class="line">        sjr.add(<span class="string">"Method name - "</span> + method.getName()) ;</span><br><span class="line">        <span class="keyword">for</span> (Object param : params) &#123;</span><br><span class="line">            sjr.add(<span class="string">"Parameter value - "</span> + param) ;</span><br><span class="line">        &#125;</span><br><span class="line">         sysLogService.save(<span class="keyword">new</span> SysLog(-<span class="number">99</span>,sjr.toString()));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>配置异步连接池<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ZHANG.HAO</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2019-09-09 18:34</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncConfig</span> <span class="keyword">implements</span> <span class="title">AsyncConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Executor <span class="title">getAsyncExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ThreadPoolTaskExecutor executor = <span class="keyword">new</span> ThreadPoolTaskExecutor();</span><br><span class="line">        executor.setCorePoolSize(<span class="number">17</span>);</span><br><span class="line">        executor.setMaxPoolSize(<span class="number">42</span>);</span><br><span class="line">        executor.setQueueCapacity(<span class="number">11</span>);</span><br><span class="line">        executor.setThreadNamePrefix(<span class="string">"WordToPdfExecutor-"</span>);</span><br><span class="line">        executor.initialize();</span><br><span class="line">        <span class="keyword">return</span> executor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AsyncUncaughtExceptionHandler <span class="title">getAsyncUncaughtExceptionHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyAsyncUncaughtExceptionHandler();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> 模板 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lombok的应用</title>
      <link href="/2018/09/02/lombok/"/>
      <url>/2018/09/02/lombok/</url>
      
        <content type="html"><![CDATA[<p>eclipse下<br>下载jar<br>运行jar。<br>Java -jar  lombok.jar<br>选择要安装的路径</p><p>Clean 项目</p><p>其实一般情况下都有插件管理中心可以下载<br>idea 下直接去plugins 里下载安装</p><p>在项目中添加 lombok<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;lombok.version&gt;1.16.20&lt;/lombok.version&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;lombok.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p><p>下面是使用的基本用法  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">• al：用在局部变量前面，相当于将变量声明为final</span><br><span class="line"></span><br><span class="line">• @NonNull：给方法参数增加这个注解会自动在方法内对该参数进行是否为空的校验，如果为空，则抛出NPE（NullPointerException）</span><br><span class="line"></span><br><span class="line">• @Cleanup：自动管理资源，用在局部变量之前，在当前变量范围内即将执行完毕退出之前会自动清理资源，自动生成try-finally这样的代码来关闭流</span><br><span class="line"></span><br><span class="line">• @Getter/@Setter：用在属性上，再也不用自己手写setter和getter方法了，还可以指定访问范围</span><br><span class="line"></span><br><span class="line">• @ToString：用在类上，可以自动覆写toString方法，当然还可以加其他参数，例如@ToString(exclude=”id”)排除id属性，或者@ToString(callSuper=true, includeFieldNames=true)调用父类的toString方法，包含所有属性</span><br><span class="line"></span><br><span class="line">• @EqualsAndHashCode：用在类上，自动生成equals方法和hashCode方法</span><br><span class="line"></span><br><span class="line">• @NoArgsConstructor, @RequiredArgsConstructor and @AllArgsConstructor：用在类上，自动生成无参构造和使用所有参数的构造函数以及把所有@NonNull属性作为参数的构造函数，如果指定staticName = “of”参数，同时还会生成一个返回类对象的静态工厂方法，比使用构造函数方便很多</span><br><span class="line"></span><br><span class="line">• @Data：注解在类上，相当于同时使用了@ToString、@EqualsAndHashCode、@Getter、@Setter和@RequiredArgsConstrutor这些注解，对于POJO类十分有用</span><br><span class="line"></span><br><span class="line">• @Value：用在类上，是@Data的不可变形式，相当于为属性添加final声明，只提供getter方法，而不提供setter方法</span><br><span class="line"></span><br><span class="line">• @Builder：用在类、构造器、方法上，为你提供复杂的builder APIs，让你可以像如下方式一样调用Person.builder().name(&quot;Adam Savage&quot;).city(&quot;San Francisco&quot;).job(&quot;Mythbusters&quot;).job(&quot;Unchained Reaction&quot;).build();更多说明参考Builder</span><br><span class="line"></span><br><span class="line">• @SneakyThrows：自动抛受检异常，而无需显式在方法上使用throws语句</span><br><span class="line"></span><br><span class="line">• @Synchronized：用在方法上，将方法声明为同步的，并自动加锁，而锁对象是一个私有的属性$lock或$LOCK，而java中的synchronized关键字锁对象是this，锁在this或者自己的类对象上存在副作用，就是你不能阻止非受控代码去锁this或者类对象，这可能会导致竞争条件或者其它线程错误</span><br><span class="line"></span><br><span class="line">• @Getter(lazy=true)：可以替代经典的Double Check Lock样板代码</span><br><span class="line"></span><br><span class="line">• @Log：根据不同的注解生成不同类型的log对象，但是实例名称都是log，有六种可选实现类</span><br><span class="line"></span><br><span class="line">  ○ @CommonsLog Creates log = org.apache.commons.logging.LogFactory.getLog(LogExample.class);</span><br><span class="line"></span><br><span class="line">○ @Log Creates log = java.util.logging.Logger.getLogger(LogExample.class.getName());</span><br><span class="line"></span><br><span class="line">○ @Log4j Creates log = org.apache.log4j.Logger.getLogger(LogExample.class);</span><br><span class="line"></span><br><span class="line">○ @Log4j2 Creates log = org.apache.logging.log4j.LogManager.getLogger(LogExample.class);</span><br><span class="line"></span><br><span class="line">○ @Slf4j Creates log = org.slf4j.LoggerFactory.getLogger(LogExample.class);</span><br><span class="line"></span><br><span class="line">○ @XSlf4j Creates log = org.slf4j.ext.XLoggerFactory.getXLogger(LogExample.class);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>linux开放端口</title>
      <link href="/2018/05/18/linuxPort/"/>
      <url>/2018/05/18/linuxPort/</url>
      
        <content type="html"><![CDATA[<p>文件local<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/sysconfig/iptables</span><br></pre></td></tr></table></figure></p><p>添加</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 5236 -j ACCEPT</span><br></pre></td></tr></table></figure><p>生效<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service iptables restart</span><br></pre></td></tr></table></figure></p><p>-A RH-Firewall-1-INPUT -m state –state NEW -m tcp -p tcp –dport 3000:5000 -j ACCEPT</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>记一次ftp并发导致的bug</title>
      <link href="/2018/04/20/threadLocal/"/>
      <url>/2018/04/20/threadLocal/</url>
      
        <content type="html"><![CDATA[<p>ThreadLocal 适用于如下两种场景</p><ul><li><p>每个线程需要有自己单独的实例</p></li><li><p>实例需要在多个方法中共享，但不希望被多线程共享</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">private ThreadLocal&lt;FTPClient&gt; ftpClientThreadLocal = new ThreadLocal&lt;FTPClient&gt;();</span><br><span class="line"></span><br><span class="line">private FTPClient getFTPClient()  &#123;</span><br><span class="line">if (ftpClientThreadLocal.get() != null &amp;&amp; ftpClientThreadLocal.get().isConnected()) &#123;</span><br><span class="line">return ftpClientThreadLocal.get();</span><br><span class="line">&#125;else&#123;</span><br><span class="line">FTPClient ftpClient = new FTPClient(); //构造一个FtpClient实例</span><br><span class="line"></span><br><span class="line">ftpClient.setControlEncoding(&quot;UTF-8&quot;);</span><br><span class="line">//ftpClient.completePendingCommand();</span><br><span class="line"></span><br><span class="line">ftpClient.enterLocalPassiveMode();</span><br><span class="line">//ftpClient.enterLocalActiveMode();</span><br><span class="line">ftpClient.setBufferSize(1024*2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">loginFtp(ftpClient);</span><br><span class="line"></span><br><span class="line">try &#123;</span><br><span class="line">ftpClient.setFileType(FTPClient.BINARY_FILE_TYPE);</span><br><span class="line">&#125; catch (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ftpClientThreadLocal.set(ftpClient);</span><br><span class="line">return ftpClient;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FTPClient ftpClient = getFTPClient();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 并发 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM 调优</title>
      <link href="/2018/04/08/jvmOptimize/"/>
      <url>/2018/04/08/jvmOptimize/</url>
      
        <content type="html"><![CDATA[<p>参数查看可以打开本地jdk下的<br>jconsole<br>查看</p><ul><li>可以先查看下本地的jdk环境是client 还是server<br>可以根据java -version 查看<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apple@appletekiMacBook-Air  ~  java -version</span><br><span class="line">java version "1.8.0_181"</span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_181-b13)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.181-b13, mixed mode)</span><br></pre></td></tr></table></figure></li></ul><p>如果是client jar包启动还可以加上 -server 这样启动虽然会慢点 但是效率会高很多</p><ul><li>其他的优化点 </li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=128m -Xms1024m -Xmx1024m -Xmn256m -Xss256k -XX:SurvivorRatio=8 -XX:+UseConcMarkSweepGC</span><br></pre></td></tr></table></figure><p>我在这边简单说一下：<br>-XX:MetaspaceSize=128m （元空间默认大小）<br>-XX:MaxMetaspaceSize=128m （元空间最大大小）<br>-Xms1024m （堆最大大小）<br>-Xmx1024m （堆默认大小）<br>-Xmn256m （新生代大小）<br>-Xss256k （棧最大深度大小）<br>-XX:SurvivorRatio=8 （新生代分区比例 8:2）<br>-XX:+UseConcMarkSweepGC （指定使用的垃圾收集器，这里使用CMS收集器）<br>-XX:+PrintGCDetails （打印详细的GC日志）</p><p>知识点：<br>JDK8之后把-XX:PermSize 和 -XX:MaxPermGen移除了，取而代之的是<br>-XX:MetaspaceSize=128m （元空间默认大小）<br>-XX:MaxMetaspaceSize=128m （元空间最大大小）<br>JDK 8开始把类的元数据放到本地化的堆内存(native heap)中，这一块区域就叫Metaspace，中文名叫元空间。<br>使用本地化的内存有什么好处呢？最直接的表现就是java.lang.OutOfMemoryError: PermGen 空间问题将不复存在，因为默认的类的元数据分配只受本地内存大小的限制，也就是说本地内存剩余多少，理论上Metaspace就可以有多大（貌似容量还与操作系统的虚拟内存有关？这里不太清楚），这解决了空间不足的问题。不过，让Metaspace变得无限大显然是不现实的，因此我们也要限制Metaspace的大小：使用-XX:MaxMetaspaceSize参数来指定Metaspace区域的大小。JVM默认在运行时根据需要动态地设置MaxMetaspaceSize的大小。</p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>乐扣刷题2 两数相加</title>
      <link href="/2017/11/18/leetcode2/"/>
      <url>/2017/11/18/leetcode2/</url>
      
        <content type="html"><![CDATA[<p>大概思路都在下面备注里</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * public class ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) &#123; val = x; &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">addTwoNumbers</span><span class="params">(ListNode l1, ListNode l2)</span> </span>&#123;</span><br><span class="line">        ListNode a = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">        ListNode p = l1, q = l2,curr = a;</span><br><span class="line">        <span class="keyword">int</span> carry = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(p != <span class="keyword">null</span> || q != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> x = (p != <span class="keyword">null</span>) ? p.val : <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> y = (q != <span class="keyword">null</span>) ? q.val : <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> sum = carry + x + y;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 只能是0 或者 1</span></span><br><span class="line">            carry = sum / <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//读取个位数 加入next</span></span><br><span class="line">            curr.next = <span class="keyword">new</span> ListNode(sum % <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 激活下一位</span></span><br><span class="line">            curr = curr.next;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 赋值两个链表</span></span><br><span class="line">            <span class="keyword">if</span>(p != <span class="keyword">null</span>) p = p.next;</span><br><span class="line">            <span class="keyword">if</span>(q != <span class="keyword">null</span>) q = q.next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当最后大于1 但是while不会循环 所以需要给new一个listNode来补充 比如 11 99 110 用来最后添加这个1的</span></span><br><span class="line">        <span class="keyword">if</span>(carry &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            curr.next = <span class="keyword">new</span> ListNode(carry);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> a.next;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>乐扣刷题3 无重复的最长字符串</title>
      <link href="/2017/11/18/leetcode3/"/>
      <url>/2017/11/18/leetcode3/</url>
      
        <content type="html"><![CDATA[<p>//给定一个字符串，请你找出其中不含有重复字符的 最长子串 的长度。<br>//<br>// 示例 1:<br>//<br>// 输入: “abcabcbb”<br>//输出: 3<br>//解释: 因为无重复字符的最长子串是 “abc”，所以其长度为 3。<br>//<br>//<br>// 示例 2:<br>//<br>// 输入: “bbbbb”<br>//输出: 1<br>//解释: 因为无重复字符的最长子串是 “b”，所以其长度为 1。<br>//<br>//<br>// 示例 3:<br>//<br>// 输入: “pwwkew”<br>//输出: 3<br>//解释: 因为无重复字符的最长子串是 “wke”，所以其长度为 3。<br>//     请注意，你的答案必须是 子串 的长度，”pwke” 是一个子序列，不是子串。<br>//<br>// Related Topics 哈希表 双指针 字符串 Sliding Window</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lengthOfLongestSubstring</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">int</span> n = s.length(), ans = <span class="number">0</span>;</span><br><span class="line">       <span class="comment">//创建map窗口,i为左区间，j为右区间，右边界移动</span></span><br><span class="line">       Map&lt;Character, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>, i = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line"></span><br><span class="line">           <span class="comment">// 如果窗口中包含当前字符，</span></span><br><span class="line">           <span class="keyword">if</span> (map.containsKey(s.charAt(j))) &#123;</span><br><span class="line"></span><br><span class="line">               <span class="comment">//当找到相同的数据</span></span><br><span class="line">               i = Math.max(map.get(s.charAt(j)), i);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//比对当前无重复字段长度和储存的长度，选最大值并替换</span></span><br><span class="line">           <span class="comment">//取的[i,j]长度 +1 是因为从0开始的</span></span><br><span class="line">           ans = Math.max(ans, j - i + <span class="number">1</span>);</span><br><span class="line">           <span class="comment">// 将当前字符为key，下一个索引为value放入map中</span></span><br><span class="line">           <span class="comment">// value为j+1是为了当出现重复字符时，i直接跳到上个相同字符的下一个位置，if中取值就不用+1了</span></span><br><span class="line">           map.put(s.charAt(j), j+<span class="number">1</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> ans;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>门面模式和调停者模式</title>
      <link href="/2017/01/27/facade&amp;mediator/"/>
      <url>/2017/01/27/facade&amp;mediator/</url>
      
        <content type="html"><![CDATA[<h1 id="facade-mediator"><a href="#facade-mediator" class="headerlink" title="facade mediator"></a>facade mediator</h1><h2 id="对外-门面模式"><a href="#对外-门面模式" class="headerlink" title="对外 门面模式"></a>对外 门面模式</h2><h2 id="对内-调停者模式"><a href="#对内-调停者模式" class="headerlink" title="对内 调停者模式"></a>对内 调停者模式</h2><h3 id="著名的消息中间件就是这个思路"><a href="#著名的消息中间件就是这个思路" class="headerlink" title="著名的消息中间件就是这个思路"></a>著名的消息中间件就是这个思路</h3><h2 id="案例"><a href="#案例" class="headerlink" title="案例 :"></a>案例 :</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> facade;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FacadePattern</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Facade f=<span class="keyword">new</span> Facade();</span><br><span class="line">        f.method();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//外观角色</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Facade</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SubSystem01 obj1=<span class="keyword">new</span> SubSystem01();</span><br><span class="line">    <span class="keyword">private</span> SubSystem02 obj2=<span class="keyword">new</span> SubSystem02();</span><br><span class="line">    <span class="keyword">private</span> SubSystem03 obj3=<span class="keyword">new</span> SubSystem03();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span></span>&#123;</span><br><span class="line">        obj1.method1();</span><br><span class="line">        obj2.method2();</span><br><span class="line">        obj3.method3();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//子系统角色</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubSystem01</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">method1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"子系统01的method1()被调用！"</span>);</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//子系统角色</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubSystem02</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">method2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"子系统02的method2()被调用！"</span>);</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//子系统角色</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubSystem03</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">method3</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"子系统03的method3()被调用！"</span>);</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参考资料: <a href="http://c.biancheng.net/view/1369.html" target="_blank" rel="noopener">http://c.biancheng.net/view/1369.html</a></p>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
          <category> java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>benchmark测试</title>
      <link href="/2016/06/01/banchmark/"/>
      <url>/2016/06/01/banchmark/</url>
      
        <content type="html"><![CDATA[<p>benchmark测试</p><p>apache旗下的一个软件可以测试</p><p>19年 用</p><p>jmeter </p>]]></content>
      
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> other </tag>
            
            <tag> linux </tag>
            
            <tag> db </tag>
            
            <tag> 工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>局域网共享文件夹如何换用户名登陆</title>
      <link href="/2015/10/08/windows01/"/>
      <url>/2015/10/08/windows01/</url>
      
        <content type="html"><![CDATA[<p>你在运行里输入 CMD<br>在命令提示符中输入：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net use * /delete</span><br></pre></td></tr></table></figure><p>OR</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net use * /del /y</span><br></pre></td></tr></table></figure><p>然后它会问你是否要删除网络连接，按 Y，回车即可。</p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 共享文件夹 </tag>
            
            <tag> 登陆 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>swagger生成项目离线文档</title>
      <link href="/2015/10/08/swaggerTodoc/"/>
      <url>/2015/10/08/swaggerTodoc/</url>
      
        <content type="html"><![CDATA[<p>最近需要写项目文档来记录下把swagger转换成adoc 然后根据adoc的格式依次转换成 pdf html </p><p>首先导入 swagger包<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- swagger start --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.battcn<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.5-RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!----&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.battcn<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-vue-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springfox.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>导入转换插件  注意两个路径<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.swagger2markup<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger2markup-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">swaggerInput</span>&gt;</span>http://localhost:8088/zhxtotc/v2/api-docs<span class="tag">&lt;/<span class="name">swaggerInput</span>&gt;</span><span class="comment">&lt;!---swagger-api-json路径--&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">outputFile</span>&gt;</span>src/docs/asciidoc/generated/swagger<span class="tag">&lt;/<span class="name">outputFile</span>&gt;</span><span class="comment">&lt;!---生成路径--&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">config</span>&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">swagger2markup.markupLanguage</span>&gt;</span>ASCIIDOC<span class="tag">&lt;/<span class="name">swagger2markup.markupLanguage</span>&gt;</span><span class="comment">&lt;!--生成格式--&gt;</span></span><br><span class="line">                   <span class="tag">&lt;/<span class="name">config</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.asciidoctor<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>asciidoctor-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                   <span class="comment">&lt;!--asciidoc文件目录--&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">sourceDirectory</span>&gt;</span>src/docs/asciidoc/generated<span class="tag">&lt;/<span class="name">sourceDirectory</span>&gt;</span></span><br><span class="line">                   <span class="comment">&lt;!---生成html的路径--&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>docs/asciidoc/html<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">backend</span>&gt;</span>html<span class="tag">&lt;/<span class="name">backend</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">sourceHighlighter</span>&gt;</span>coderay<span class="tag">&lt;/<span class="name">sourceHighlighter</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">attributes</span>&gt;</span></span><br><span class="line">                       <span class="comment">&lt;!--导航栏在左--&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">toc</span>&gt;</span>left<span class="tag">&lt;/<span class="name">toc</span>&gt;</span></span><br><span class="line">                       <span class="comment">&lt;!--显示层级数--&gt;</span></span><br><span class="line">                       <span class="comment">&lt;!--&lt;toclevels&gt;3&lt;/toclevels&gt;--&gt;</span></span><br><span class="line">                       <span class="comment">&lt;!--自动打数字序号--&gt;</span></span><br><span class="line">                       <span class="tag">&lt;<span class="name">sectnums</span>&gt;</span>true<span class="tag">&lt;/<span class="name">sectnums</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;/<span class="name">attributes</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> swagger </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell 传递参数</title>
      <link href="/2015/10/08/shellArgs/"/>
      <url>/2015/10/08/shellArgs/</url>
      
        <content type="html"><![CDATA[<p>脚本内获取参数的格式为：$n。n 代表一个数字，1 为执行脚本的第一个参数，2 为执行脚本的第二个参数，以此类推……</p><p>新建shell<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">echo &quot;Shell 传递参数实例！&quot;;</span><br><span class="line">echo &quot;执行的文件名：$0&quot;;</span><br><span class="line">echo &quot;第一个参数为：$1&quot;;</span><br><span class="line">echo &quot;第二个参数为：$2&quot;;</span><br><span class="line">echo &quot;第三个参数为：$3&quot;;</span><br></pre></td></tr></table></figure></p><p>调用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./test.sh 1 2 3</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>maven多环境配置文件</title>
      <link href="/2015/10/08/mavenProfileSpringboot/"/>
      <url>/2015/10/08/mavenProfileSpringboot/</url>
      
        <content type="html"><![CDATA[<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 多环境配置文件激活属性---开发、测试、生产</span></span><br><span class="line"><span class="string">spring.profiles.active=@activatedProperties@</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 测试环境 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>test<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">profiles.active</span>&gt;</span>test<span class="tag">&lt;/<span class="name">profiles.active</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 本地开发环境 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 默认环境为开发环境 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">profiles.active</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">profiles.active</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure><p>// 2019/11/22 测试不需要这个<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 打包后的名字(test.war) --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 打包时要把mapper.xml也打进去！ --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 资源根目录排除各环境的配置，使用单独的资源目录来指定 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>test/*<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>dev/*<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources/$&#123;profiles.active&#125;<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>如果先远程部署后本地启动需要先maven install</p><p>// 没有-P 选择默认的<br>mvn clean package -Pdev  -Dmaven.test.skip=true</p><p>// 命令优先度高<br>java -jar  /xxx/xxx.jar  –spring.profiles.active=dev </p><p>yml环境下有些区别 @换成#</p><p>详细情况可以参考 <a href="https://blog.csdn.net/colton_null/article/details/82145467" target="_blank" rel="noopener">SpringBoot + Maven实现多环境动态切换yml配置及配置文件拆分</a></p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bfg工具 清除git 历史记录</title>
      <link href="/2015/10/08/bfg/"/>
      <url>/2015/10/08/bfg/</url>
      
        <content type="html"><![CDATA[<p>下载jar包<br><a href="https://search.maven.org/classic/remote_content?g=com.madgag&amp;a=bfg&amp;v=LATEST" target="_blank" rel="noopener">下载地址</a></p><p>下载好后在你的根目录下执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar bfg.jar --strip-blobs-bigger-than 100M /你的项目地址</span><br></pre></td></tr></table></figure></p><p>回到你的项目目录执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reflog expire --expire=now --all &amp;&amp; git gc --prune=now --aggressive</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo基本命令</title>
      <link href="/2015/05/02/hexoShell/"/>
      <url>/2015/05/02/hexoShell/</url>
      
        <content type="html"><![CDATA[<p>本地部署验证<br>hexo s -g</p><p>清理并生成<br>hexo clean &amp;&amp; hexo g</p><p>远程部署<br>hexo d</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浅析HTTP及lvs</title>
      <link href="/2015/05/02/HTTP/"/>
      <url>/2015/05/02/HTTP/</url>
      
        <content type="html"><![CDATA[<h1 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h1><h2 id="七层协议"><a href="#七层协议" class="headerlink" title="七层协议"></a>七层协议</h2><h3 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h3><ul><li>用户态   - 浏览器 -生成各种 HTTP/1.1  只需要写好规则</li></ul><h3 id="表示层"><a href="#表示层" class="headerlink" title="表示层"></a>表示层</h3><h3 id="会话层"><a href="#会话层" class="headerlink" title="会话层"></a>会话层</h3><h3 id="传输控制层-相当于操作系统的接口"><a href="#传输控制层-相当于操作系统的接口" class="headerlink" title="传输控制层 (相当于操作系统的接口)"></a>传输控制层 (相当于操作系统的接口)</h3><ul><li><p>给内核态 socket</p><ul><li>一台主机拥有的端口号是65535个</li></ul></li><li><p>tcp协议 (可靠协议)</p><ul><li><p>三次握手 之后建立资源消耗</p><ul><li>开辟资源后返回给应用层来 传输数据 操作</li></ul></li><li><p>四次挥手</p><ul><li>要求双方都发送一个分开链接和接受一次分开的包</li></ul></li><li><p>tcp 是 基于下一跳的规则 每个节点只需要记录下一个节点的地址</p></li><li>组织TCP协议的包然后发送给网络层 并且在当前阻塞住</li></ul></li><li><p>udp协议</p></li></ul><h3 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h3><ul><li>netstat</li><li><p>TCP/IP</p><ul><li>拿到包之后 通过本地的ip地址寻找相对于的路由表</li><li>route -n<br>ip 和 Genmask(子网掩码)   按位与运算  得到 Destination 找到(gateWay)网关</li></ul></li></ul><h3 id="链路层"><a href="#链路层" class="headerlink" title="链路层"></a>链路层</h3><ul><li><p>TCP/IP</p><ul><li><p>找到mac 地址  封装包给下一层</p><ul><li>arp -a  </li></ul></li></ul></li></ul><h3 id="物理层"><a href="#物理层" class="headerlink" title="物理层"></a>物理层</h3><ul><li><p>三层确定对方地址 </p><ul><li>源mac地址 -&gt; 目标mac地址 (会不停地找下一跳  所以会变)</li><li>源IP地址 -&gt; 目标IP地址</li><li>源端口号 -&gt; 目标端口号</li><li><p>建立连接的包</p><ul><li><p>sync</p><ul><li><p>sync/ack</p><ul><li>ack</li></ul></li></ul></li></ul></li><li><p>断开连接的包</p><ul><li>finl</li></ul></li></ul></li></ul><h2 id="七层协议出去之后"><a href="#七层协议出去之后" class="headerlink" title="七层协议出去之后"></a>七层协议出去之后</h2><p>基于lvs的三种模式</p><h3 id="D-NAT"><a href="#D-NAT" class="headerlink" title="D-NAT"></a>D-NAT</h3><ul><li>出去的时候肯定是 CIP 和 VIP 去寻找下一跳</li><li>然后会找到具体的VIP地址来确定DIP</li><li>最后访问RIP 回去的时候按照原路返回</li></ul><h3 id="DR模式-基于两层"><a href="#DR模式-基于两层" class="headerlink" title="DR模式 基于两层"></a>DR模式 基于两层</h3><ul><li><p>CIP -&gt; VIP -&gt; DIP -&gt; RIP -&gt; VIP(对外隐藏)</p><ul><li>出去的时候肯定是 CIP 和 VIP 去寻找下一跳</li><li>然后会找到具体的VIP地址来确定DIP</li><li>在找到DIP的地址之后会封装一个  ( CIP VIP | RIP @ MAC  ) 的包</li><li>最后访问RIP 然后RIP根据包里面的CIP来返回数据</li></ul></li><li><p>路由器ip地址由 运营商提供 -&gt; 去寻找VIP<br>出去的时候为了防止同一局域网出去的ip一样会在路由器内部生成一个私有的端口号来区别</p></li><li>速度快, 成本低, 负载和RS要在同一局域网</li></ul><h3 id="TUN隧道技术"><a href="#TUN隧道技术" class="headerlink" title="TUN隧道技术"></a>TUN隧道技术</h3><ul><li>vpn &amp; 翻墙软件</li></ul><h2 id="LVS"><a href="#LVS" class="headerlink" title="LVS"></a>LVS</h2><p>主备</p><h2 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h2><p> nginx 和server建立三次连接<br> lvs 和nginx 建立通讯</p><p>七层协议每层都有相对应的规范</p>]]></content>
      
      
      <categories>
          
          <category> 前端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
